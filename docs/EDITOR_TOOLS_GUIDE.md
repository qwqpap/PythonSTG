# pystg ç¼–è¾‘å™¨å·¥å…·æŒ‡å—

> æœ¬æ–‡æ¡£ä»‹ç» pystg é™„å¸¦çš„ä¸‰ä¸ªå¯è§†åŒ–ç¼–è¾‘å™¨å·¥å…·çš„å®‰è£…ã€å¯åŠ¨å’Œä½¿ç”¨æ–¹æ³•ã€‚

---

## ç›®å½•

1. [æ¦‚è§ˆ](#1-æ¦‚è§ˆ)
2. [ä¾èµ–å®‰è£…](#2-ä¾èµ–å®‰è£…)
3. [ç»Ÿä¸€å¯åŠ¨å™¨](#3-ç»Ÿä¸€å¯åŠ¨å™¨)
4. [å¼¹å¹•åˆ«åç®¡ç†å™¨](#4-å¼¹å¹•åˆ«åç®¡ç†å™¨)
5. [çº¹ç†èµ„äº§ç¼–è¾‘å™¨](#5-çº¹ç†èµ„äº§ç¼–è¾‘å™¨)
6. [è‡ªæœºç¼–è¾‘å™¨](#6-è‡ªæœºç¼–è¾‘å™¨)
7. [å…±äº«æ¨¡å—è¯´æ˜](#7-å…±äº«æ¨¡å—è¯´æ˜)
8. [å¸¸è§é—®é¢˜](#8-å¸¸è§é—®é¢˜)

---

## 1. æ¦‚è§ˆ

pystg æä¾›ä¸‰ä¸ª PyQt5 å¯è§†åŒ–ç¼–è¾‘å™¨ï¼Œç”¨äºç®¡ç†æ¸¸æˆèµ„äº§é…ç½®ï¼š

| å·¥å…· | æ–‡ä»¶ | ç”¨é€” |
|------|------|------|
| **å¼¹å¹•åˆ«åç®¡ç†å™¨** | `tools/bullet_alias_manager.py` | ç®¡ç†å¼¹å¹•ç±»å‹+é¢œè‰²â†’ç²¾çµçš„æ˜ å°„ |
| **çº¹ç†èµ„äº§ç¼–è¾‘å™¨** | `tools/asset_manager_qt.py` | ç¼–è¾‘ç²¾çµå›¾é›†è£åˆ‡åŒºåŸŸã€åŠ¨ç”»å¸§ã€æ¿€å…‰é…ç½® |
| **è‡ªæœºç¼–è¾‘å™¨** | `tools/player_editor.py` | ç¼–è¾‘è‡ªæœºåŠ¨ç”»ã€å°„å‡»ç±»å‹ã€å­æœºé…ç½® |

æ­¤å¤–è¿˜æœ‰ä¸€ä¸ª**ç»Ÿä¸€å¯åŠ¨å™¨**ï¼ˆ`tools/editor_launcher.py`ï¼‰ï¼Œå¯ä»¥ä»ä¸€ä¸ªçª—å£æ‰“å¼€ä»¥ä¸Šæ‰€æœ‰ç¼–è¾‘å™¨ã€‚

æ‰€æœ‰ç¼–è¾‘å™¨å…±äº«ç»Ÿä¸€æš—è‰²ä¸»é¢˜ï¼ˆCatppuccin Mochaï¼‰ï¼Œå…¬å…±ä»£ç ä½äº `tools/editor_common.py`ã€‚

### æ–‡ä»¶ç»“æ„

```
tools/
â”œâ”€â”€ editor_launcher.py          # ç»Ÿä¸€å¯åŠ¨å™¨
â”œâ”€â”€ editor_common.py            # å…±äº«æ¨¡å—ï¼ˆä¸»é¢˜ã€ç¼“å­˜ã€æ•°æ®åŠ è½½ï¼‰
â”œâ”€â”€ bullet_alias_manager.py     # å¼¹å¹•åˆ«åç®¡ç†å™¨
â”œâ”€â”€ asset_manager_qt.py         # çº¹ç†èµ„äº§ç¼–è¾‘å™¨
â””â”€â”€ player_editor.py            # è‡ªæœºç¼–è¾‘å™¨
```

---

## 2. ä¾èµ–å®‰è£…

æ‰€æœ‰ç¼–è¾‘å™¨éƒ½éœ€è¦ **PyQt5**ï¼š

```bash
pip install PyQt5
```

çº¹ç†èµ„äº§ç¼–è¾‘å™¨è¿˜ä¾èµ–å¼•æ“æ¨¡å—ï¼ˆ`src/resource/unified_texture.py`ï¼‰ï¼Œæ— éœ€é¢å¤–å®‰è£…ä½†éœ€è¦ç¡®ä¿é¡¹ç›®ç›®å½•å®Œæ•´ã€‚

---

## 3. ç»Ÿä¸€å¯åŠ¨å™¨

### å¯åŠ¨

```bash
python tools/editor_launcher.py
```

### åŠŸèƒ½

å¯åŠ¨å™¨æä¾›ä¸‰ä¸ªå·¥å…·å¡ç‰‡ï¼Œç‚¹å‡»å³å¯å¯åŠ¨å¯¹åº”ç¼–è¾‘å™¨ï¼š

- ğŸ¯ **å¼¹å¹•åˆ«å** â€” æ‰“å¼€å¼¹å¹•åˆ«åç®¡ç†å™¨
- ğŸ–¼ï¸ **çº¹ç†ç¼–è¾‘** â€” æ‰“å¼€çº¹ç†èµ„äº§ç¼–è¾‘å™¨
- âœˆï¸ **è‡ªæœºç¼–è¾‘** â€” æ‰“å¼€è‡ªæœºç¼–è¾‘å™¨

æ¯ä¸ªç¼–è¾‘å™¨åœ¨ç‹¬ç«‹è¿›ç¨‹ä¸­è¿è¡Œï¼Œå…³é—­å¯åŠ¨å™¨ä¸ä¼šå½±å“å·²æ‰“å¼€çš„ç¼–è¾‘å™¨ã€‚

!!! tip "ç›´æ¥å¯åŠ¨"
    ä½ ä¹Ÿå¯ä»¥è·³è¿‡å¯åŠ¨å™¨ï¼Œç›´æ¥è¿è¡Œå„ç¼–è¾‘å™¨çš„ Python è„šæœ¬ã€‚

---

## 4. å¼¹å¹•åˆ«åç®¡ç†å™¨

### å¯åŠ¨

```bash
python tools/bullet_alias_manager.py
```

### æ˜¯ä»€ä¹ˆï¼Ÿ

å¼¹å¹•åˆ«åç®¡ç†å™¨ç”¨æ¥å»ºç«‹**å¼¹å¹•ç±»å‹ + é¢œè‰² â†’ ç²¾çµåç§°**çš„æ˜ å°„å…³ç³»ã€‚

åœ¨ pystg çš„å…³å¡è„šæœ¬ä¸­ï¼Œå‘å°„å¼¹å¹•æ—¶ä½¿ç”¨çš„æ˜¯æŠ½è±¡åç§°ï¼š

```python
# å…³å¡è„šæœ¬ä¸­çš„å¼¹å¹•å‘å°„
ctx.spawn_bullet(x, y, speed, angle, bullet_type="ball_m", color="red")
```

å¼•æ“éœ€è¦çŸ¥é“ `ball_m` + `red` å¯¹åº”å“ªä¸ªå…·ä½“çš„ç²¾çµå›¾ï¼ˆå¦‚ `ball_mid1`ï¼‰ã€‚
è¿™ä¸ªæ˜ å°„å…³ç³»å­˜å‚¨åœ¨ `assets/bullet_aliases.json` ä¸­ï¼Œç”±æœ¬å·¥å…·ç®¡ç†ã€‚

### ç•Œé¢å¸ƒå±€
![ç•Œé¢å¸ƒå±€](name_sc-1.png)


### æ ¼å­çŠ¶æ€

ç½‘æ ¼ä¸­æ¯ä¸ªæ ¼å­ï¼ˆSpriteCellï¼‰ä»£è¡¨ä¸€ä¸ª (å¼¹å¹•ç±»å‹, é¢œè‰²) ç»„åˆï¼Œæœ‰ä¸‰ç§çŠ¶æ€ï¼š

| çŠ¶æ€ | è¾¹æ¡†é¢œè‰² | å«ä¹‰ |
|------|----------|------|
| ğŸŸ¢ ç»¿è‰² | å·²åˆ†é…ï¼Œå¯¹åº”ç²¾çµå­˜åœ¨ | æ­£å¸¸å·¥ä½œ |
| ğŸŸ¡ é»„è‰² | å·²åˆ†é…ï¼Œä½†ç²¾çµæ‰¾ä¸åˆ°ï¼ˆæ˜¾ç¤ºâš ï¼‰ | é…ç½®äº†åç§°ä½†å›¾é›†ä¸­æ²¡æœ‰è¿™ä¸ªç²¾çµ |
| ğŸ”´ çº¢è‰² | æœªåˆ†é…ï¼ˆæ˜¾ç¤ºâ€”ï¼‰ | è¿˜æ²¡æœ‰æ˜ å°„ï¼Œéœ€è¦æ‰‹åŠ¨è®¾ç½® |

### åŸºæœ¬æ“ä½œ

#### åˆ†é…ç²¾çµ

1. **å·¦é”®ç‚¹å‡»**ä»»æ„æ ¼å­ â†’ å¼¹å‡º**ç²¾çµé€‰å–å™¨**
2. åœ¨é€‰å–å™¨ä¸­å¯ä»¥ï¼š
    - ä½¿ç”¨æœç´¢æ¡†æŒ‰åç§°è¿‡æ»¤
    - ä½¿ç”¨ä¸‹æ‹‰æ¡†æŒ‰å›¾é›†è¿‡æ»¤
    - æµè§ˆç¼©ç•¥å›¾ç½‘æ ¼
3. **åŒå‡»**ç¼©ç•¥å›¾ â†’ å¿«é€Ÿç¡®è®¤é€‰æ‹©
4. æˆ–è€…å…ˆ**å•å‡»**é€‰ä¸­ï¼Œå†ç‚¹"ç¡®å®š"

#### æ¸…é™¤åˆ†é…

- **å³é”®ç‚¹å‡»**æ ¼å­ â†’ å¼¹å‡ºèœå• â†’ "æ¸…é™¤æ­¤æ ¼å­"

#### æ·»åŠ å¼¹å¹•ç±»å‹

- å·¥å…·æ  "æ·»åŠ ç±»å‹" â†’ è¾“å…¥æ–°çš„åˆ«åï¼ˆå¦‚ `my_bullet`ï¼‰
- æ–°ç±»å‹ä¼šå‡ºç°åœ¨ç½‘æ ¼æœ€åä¸€è¡Œï¼Œæ‰€æœ‰é¢œè‰²åˆå§‹ä¸ºæœªåˆ†é…

#### æ·»åŠ é¢œè‰²

- å·¥å…·æ  "æ·»åŠ é¢œè‰²" â†’ è¾“å…¥æ–°é¢œè‰²åï¼ˆå¦‚ `pink`ï¼‰
- æ–°é¢œè‰²ä¼šæ·»åŠ ä¸ºç½‘æ ¼çš„æ–°åˆ—

#### åˆ é™¤å¼¹å¹•ç±»å‹ / é¢œè‰²

- èœå• "ç¼–è¾‘" â†’ "åˆ é™¤å¼¹å¹•ç±»å‹..." / "åˆ é™¤é¢œè‰²..."
- é€‰æ‹©è¦åˆ é™¤çš„é¡¹ç›®åç¡®è®¤

#### éªŒè¯

- å·¥å…·æ  "éªŒè¯" æˆ–èœå• "ç¼–è¾‘" â†’ "éªŒè¯æ‰€æœ‰"
- æ£€æŸ¥æ‰€æœ‰å·²åˆ†é…çš„ç²¾çµåæ˜¯å¦åœ¨å›¾é›†ä¸­å­˜åœ¨
- ç»“æœæ˜¾ç¤ºåœ¨å¼¹çª—ä¸­

#### ä¿å­˜

- å·¥å…·æ  ğŸ’¾ / èœå• "æ–‡ä»¶" â†’ "ä¿å­˜" / `Ctrl+S`
- ä¿å­˜åˆ° `assets/bullet_aliases.json`
- å…³é—­çª—å£æ—¶å¦‚æœ‰æœªä¿å­˜ä¿®æ”¹ä¼šæç¤º

### ç²¾çµé€‰å–å™¨

å¼¹å‡ºçš„ç²¾çµé€‰å–å™¨æä¾›æ‰€æœ‰å¯ç”¨ç²¾çµçš„å¯è§†åŒ–æµè§ˆï¼š

```
â”Œâ”€ é€‰æ‹©ç²¾çµ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                      â”‚
â”‚  ğŸ” [æœç´¢æ¡†: ball_mid          ]     â”‚
â”‚  ğŸ“ [å›¾é›†è¿‡æ»¤: å…¨éƒ¨ â–¼          ]     â”‚
â”‚                                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”¬...       â”‚
â”‚  â”‚spr1â”‚spr2â”‚spr3â”‚spr4â”‚spr5â”‚...       â”‚
â”‚  â”œâ”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”¤          â”‚
â”‚  â”‚spr6â”‚spr7â”‚spr8â”‚spr9â”‚ ...â”‚          â”‚
â”‚  â””â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”´â”€â”€â”€â”€â”˜          â”‚
â”‚                                      â”‚
â”‚        [  ç¡®å®š  ] [  å–æ¶ˆ  ]         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

- æ¯è¡Œ 10 ä¸ªç¼©ç•¥å›¾ï¼ˆ64Ã—64 åƒç´ ï¼‰
- é¼ æ ‡æ‚¬åœæ˜¾ç¤ºç²¾çµåç§°å’Œæ‰€å±å›¾é›†
- å·²åœ¨å½“å‰æ ¼å­ä¸­é€‰ä¸­çš„ç²¾çµä¼šé«˜äº®æ ‡è®°

### è¾“å‡ºæ–‡ä»¶æ ¼å¼

ä¿å­˜çš„ `assets/bullet_aliases.json` æ ¼å¼å¦‚ä¸‹ï¼š

```json
{
  "version": "1.0",
  "mapping": {
    "ball_m": {
      "red": "ball_mid1",
      "blue": "ball_mid2",
      "green": "ball_mid3",
      "purple": "ball_mid4",
      "orange": "ball_mid5",
      "darkblue": "ball_mid6",
      "white": "ball_mid7",
      "yellow": "ball_mid8"
    },
    "ball_s": {
      "red": "ball_small1",
      "darkred": "ball_small2",
      "blue": "ball_small3",
      ...
    }
  }
}
```

### ä¸å¼•æ“çš„å…³ç³»

å¼•æ“çš„ `StageContext`ï¼ˆä½äº `src/game/stage/context.py`ï¼‰åœ¨é¦–æ¬¡å®ä¾‹åŒ–æ—¶è‡ªåŠ¨åŠ è½½æ­¤æ–‡ä»¶ï¼š

```python
class StageContext:
    BULLET_ALIAS_TABLE: Dict[str, Dict[str, str]] = {}

    @classmethod
    def load_bullet_aliases(cls, path="assets/bullet_aliases.json"):
        # è¯»å– JSON å¹¶å¡«å…… BULLET_ALIAS_TABLE
        ...

    def _resolve_sprite_id(self, bullet_type: str, color: str) -> str:
        # 1. ä¼˜å…ˆæŸ¥ BULLET_ALIAS_TABLE
        type_entry = self.BULLET_ALIAS_TABLE.get(bullet_type)
        if type_entry:
            sprite = type_entry.get(color)
            if sprite:
                return sprite
        # 2. å›é€€åˆ°æ—§çš„ BULLET_TYPE_MAP + COLOR_MAP
        ...
```

!!! note "å…¼å®¹æ€§"
    å³ä½¿ `bullet_aliases.json` ä¸å­˜åœ¨ï¼Œå¼•æ“ä¹Ÿä¼šå›é€€åˆ°å†…ç½®çš„ `BULLET_TYPE_MAP` / `COLOR_MAP` ç¡¬ç¼–ç æ˜ å°„ã€‚
    æ–°å¢çš„å¼¹å¹•ç±»å‹ï¼ˆå¦‚ `arrow_s`, `grain_a`, `kite` ç­‰ï¼‰åªèƒ½é€šè¿‡ JSON åˆ«åè¡¨ä½¿ç”¨ã€‚

### ä¸ºä»€ä¹ˆä¸åŒç±»å‹çš„é¢œè‰²æ•°ä¸åŒï¼Ÿ

ä¸åŒå¼¹å¹•ä½¿ç”¨ä¸åŒæ•°é‡çš„ç²¾çµå˜ä½“ï¼ˆ æ²¿ç”¨**LuaSTG è§„èŒƒ**ï¼‰ï¼š

- **8 è‰²**ç±»å‹ï¼ˆå¦‚ `ball_m`, `knife`, `star_l`ï¼‰ï¼šred, blue, green, purple, orange, darkblue, white, yellow
- **16 è‰²**ç±»å‹ï¼ˆå¦‚ `ball_s`, `star_s`, `square`, `grain_*`ï¼‰ï¼šåœ¨ 8 è‰²åŸºç¡€ä¸Šå¢åŠ  darkred, darkblue, darkgreen, darkpurple, darkorange, darkyellow, cyan, darkcyan, black

åç¼€ç¼–å·ï¼ˆå¦‚ `ball_mid1`, `ball_mid2`...ï¼‰åœ¨ä¸åŒç±»å‹ä¸­**ä¸ä¸€å®šå¯¹åº”ç›¸åŒé¢œè‰²**ï¼Œæ‰€ä»¥éœ€è¦è¿™ä¸ªå·¥å…·æ¥é€ç±»å‹ç®¡ç†æ˜ å°„ã€‚

---

## 5. çº¹ç†èµ„äº§ç¼–è¾‘å™¨

### å¯åŠ¨

```bash
python tools/asset_manager_qt.py
```

### åŠŸèƒ½æ¦‚è¿°

çº¹ç†èµ„äº§ç¼–è¾‘å™¨ç›´æ¥é›†æˆæ¸¸æˆå¼•æ“çš„ `UnifiedTextureManager`ï¼Œå¯ä»¥ç¼–è¾‘æ‰€æœ‰ç±»å‹çš„ç²¾çµèµ„äº§ã€‚

#### æ”¯æŒçš„èµ„äº§ç±»å‹

| ç±»åˆ« | è·¯å¾„ | è¯´æ˜ |
|------|------|------|
| å­å¼¹ | `assets/images/bullet/` | å­å¼¹ç²¾çµå›¾é›† |
| æ¿€å…‰ | `assets/images/laser/` | æ¿€å…‰çº¹ç†ï¼ˆhead/body/tail ä¸‰æ®µå¼ï¼‰ |
| ç©å®¶ | `assets/images/player/` | è‡ªæœºç²¾çµ |
| æ•Œäºº | `assets/images/enemy/` | æ•Œæœºç²¾çµ |
| é“å…· | `assets/images/item/` | é“å…·ç²¾çµ |
| èƒŒæ™¯ | `assets/images/background/` | å…³å¡èƒŒæ™¯ |
| UI | `assets/images/ui/` | ç•Œé¢å…ƒç´  |

#### ä¸»è¦åŠŸèƒ½

- **ç²¾çµè£åˆ‡ç¼–è¾‘**ï¼šåœ¨çº¹ç†å›¾é›†ä¸Šå¯è§†åŒ–é€‰å–ç²¾çµåŒºåŸŸï¼ˆrectï¼‰
- **ä¸­å¿ƒç‚¹é…ç½®**ï¼šè®¾å®šç²¾çµæ—‹è½¬/æ¸²æŸ“ä¸­å¿ƒç‚¹
- **ç¢°æ’åŠå¾„**ï¼šé…ç½®ç¢°æ’æ£€æµ‹çš„åœ†å½¢åŠå¾„
- **åŠ¨ç”»å¸§ç¼–è¾‘**ï¼šç®¡ç†åºåˆ—å¸§åŠ¨ç”»
- **æ¿€å…‰ä¸‰æ®µé¢„è§ˆ**ï¼šhead / body / tail ä¸‰æ®µå¼æ¿€å…‰çš„å¯è§†åŒ–é¢„è§ˆ
- **16 è‰²å˜ä½“ç»„ç®¡ç†**ï¼šç®¡ç†å¼¹å¹•é¢œè‰²å˜ä½“ç»„
- **å®æ—¶é¢„è§ˆ**ï¼šæ‰€æœ‰ä¿®æ”¹å³æ—¶æ˜¾ç¤ºæ•ˆæœ

#### æ•°æ®å­˜å‚¨

æ¯ä¸ªå›¾é›†ç›®å½•ä¸‹çš„ JSON æ–‡ä»¶ï¼ˆå¦‚ `assets/images/bullet/bullet1.json`ï¼‰å­˜å‚¨ç²¾çµå®šä¹‰ï¼š

```json
{
  "__image_filename": "bullet1.png",
  "sprites": {
    "ball_mid1": {
      "rect": [0, 0, 32, 32],
      "center": [16, 16],
      "radius": 8,
      "rotate": false
    },
    ...
  }
}
```

!!! warning "ä¿®æ”¹ç«‹å³ç”Ÿæ•ˆ"
    çº¹ç†ç¼–è¾‘å™¨çš„ä¿å­˜ç›´æ¥å†™å…¥å¼•æ“ä½¿ç”¨çš„ JSON é…ç½®æ–‡ä»¶ï¼Œä¿®æ”¹åé‡å¯æ¸¸æˆå³å¯çœ‹åˆ°æ•ˆæœã€‚

---

## 6. è‡ªæœºç¼–è¾‘å™¨

### å¯åŠ¨

```bash
python tools/player_editor.py
```

### åŠŸèƒ½æ¦‚è¿°

è‡ªæœºç¼–è¾‘å™¨ç”¨äºé…ç½®ç©å®¶è§’è‰²çš„å„é¡¹å±æ€§ã€‚

#### ä¸»è¦åŠŸèƒ½

- **åŠ¨ç”»çŠ¶æ€æœº**ï¼šç¼–è¾‘ç©ºé—² / å·¦ç§» / å³ç§» / ç‰¹æ®ŠåŠ¨ç”»çŠ¶æ€åŠåˆ‡æ¢è§„åˆ™
- **ç²¾çµå¸§é¢„è§ˆ**ï¼šå®æ—¶é¢„è§ˆåŠ¨ç”»å¸§åºåˆ—
- **å°„å‡»ç±»å‹**ï¼šé…ç½®ä¸»æ­¦å™¨å’Œå‰¯æ­¦å™¨çš„å¼¹å¹•å‘å°„å‚æ•°
- **å­æœºï¼ˆOptionï¼‰é…ç½®**ï¼šè®¾å®šå­æœºä½ç½®ã€åŠ¨ç”»ã€æ”»å‡»è¡Œä¸º
- **ç§»åŠ¨å‚æ•°**ï¼šå¸¸é€Ÿ / ä½é€Ÿç§»åŠ¨é€Ÿåº¦é…ç½®

#### æ•°æ®å­˜å‚¨

è‡ªæœºé…ç½®ä½äº `assets/players/<è§’è‰²å>/config.json`ï¼š

```
assets/players/
â”œâ”€â”€ reimu/
â”‚   â”œâ”€â”€ config.json       # è§’è‰²é…ç½®ï¼ˆåŠ¨ç”»ã€å°„å‡»ã€å­æœºç­‰ï¼‰
â”‚   â””â”€â”€ reimu.png         # è§’è‰²ç²¾çµå›¾
â””â”€â”€ sakuya/
    â”œâ”€â”€ config.json
    â””â”€â”€ sakuya.png
```

---

## 7. å…±äº«æ¨¡å—è¯´æ˜

`tools/editor_common.py` æä¾›ä»¥ä¸‹å…±ç”¨åŠŸèƒ½ï¼š

### è·¯å¾„å¸¸é‡

```python
PROJECT_ROOT     # é¡¹ç›®æ ¹ç›®å½•
ASSET_ROOT       # assets/ ç›®å½•
BULLET_IMAGE_DIR # assets/images/bullet/ ç›®å½•
BULLET_ALIASES_PATH  # assets/bullet_aliases.json è·¯å¾„
PLAYERS_ROOT     # assets/players/ ç›®å½•
```

### ç»Ÿä¸€æš—è‰²ä¸»é¢˜

```python
from tools.editor_common import DARK_THEME, apply_dark_theme

# æ–¹å¼1ï¼šç›´æ¥è®¾ç½® stylesheet
widget.setStyleSheet(DARK_THEME)

# æ–¹å¼2ï¼šä½¿ç”¨è¾…åŠ©å‡½æ•°
apply_dark_theme(widget)
```

ä¸»é¢˜åŸºäº **Catppuccin Mocha** é…è‰²æ–¹æ¡ˆï¼Œè¦†ç›–äº† QMainWindowã€QDialogã€QMenuã€QPushButtonã€QTableWidgetã€QTreeWidgetã€QLineEditã€QComboBoxã€QScrollBar ç­‰å¸¸ç”¨æ§ä»¶ã€‚

### ç²¾çµæ•°æ®åŠ è½½

```python
from tools.editor_common import (
    SpriteEntry,
    load_all_bullet_sprites,
    get_all_sprite_names,
    get_sprite_entry_map,
)

# åŠ è½½æ‰€æœ‰å­å¼¹å›¾é›†
atlases = load_all_bullet_sprites()
# atlases = {"bullet1": [SpriteEntry(...), ...], "bullet2": [...]}

# è·å–æ‰€æœ‰ç²¾çµåï¼ˆé›†åˆï¼‰
all_names = get_all_sprite_names(atlases)

# è·å– nameâ†’entry æ˜ å°„
entries = get_sprite_entry_map(atlases)
```

`SpriteEntry` æ•°æ®ç±»ï¼š

```python
@dataclass
class SpriteEntry:
    name: str               # ç²¾çµåç§°ï¼Œå¦‚ "ball_mid1"
    atlas: str              # æ‰€å±å›¾é›†åï¼Œå¦‚ "bullet1"
    texture_path: str       # çº¹ç† PNG å®Œæ•´è·¯å¾„
    rect: (int,int,int,int) # è£åˆ‡åŒºåŸŸ (x, y, w, h)
    center: (float, float)  # ä¸­å¿ƒç‚¹åç§»
    radius: float           # ç¢°æ’åŠå¾„
    rotate: bool            # æ˜¯å¦æ—‹è½¬
```

### QPixmap ç¼“å­˜

```python
from tools.editor_common import PixmapCache

# é¢„åŠ è½½æ‰€æœ‰ç²¾çµï¼ˆå»ºè®®åœ¨ QApplication åˆ›å»ºåè°ƒç”¨ï¼‰
PixmapCache.ensure_all_loaded(atlases)

# è·å–ç²¾çµçš„ QPixmap
pixmap = PixmapCache.get_sprite(sprite_entry)

# æŒ‰åç§°è·å–ï¼ˆéœ€å…ˆåŠ è½½ï¼‰
pixmap = PixmapCache.get_sprite_by_name("ball_mid1")

# åˆ›å»ºå ä½ç¬¦
placeholder = PixmapCache.make_placeholder(size=32, text="?")
```

### åˆ«å JSON è¯»å†™

```python
from tools.editor_common import (
    load_bullet_aliases,
    save_bullet_aliases,
    generate_default_aliases,
)

# è¯»å–
mapping = load_bullet_aliases()
# mapping = {"ball_m": {"red": "ball_mid1", ...}, ...}

# è‡ªåŠ¨ç”Ÿæˆåˆå§‹æ˜ å°„
atlases = load_all_bullet_sprites()
mapping = generate_default_aliases(atlases)

# ä¿å­˜
save_bullet_aliases(mapping)
```

---

## 8. å¸¸è§é—®é¢˜

### å¯åŠ¨æŠ¥é”™ ModuleNotFoundError: No module named 'PyQt5'

å®‰è£… PyQt5ï¼š

```bash
pip install PyQt5
```

### å¼¹å¹•åˆ«åç®¡ç†å™¨æ‰“å¼€åç½‘æ ¼æ˜¯ç©ºçš„

å¯èƒ½åŸå› ï¼š

1. `assets/bullet_aliases.json` ä¸å­˜åœ¨ â€” å·¥å…·ä¼šè‡ªåŠ¨æ ¹æ®å®é™…ç²¾çµç”Ÿæˆé»˜è®¤æ˜ å°„
2. `assets/images/bullet/` ç›®å½•ä¸‹æ²¡æœ‰ JSON é…ç½®æˆ– PNG å›¾ç‰‡
3. ç¡®ä¿ä»é¡¹ç›®æ ¹ç›®å½•å¯åŠ¨ï¼Œæˆ–ä½¿ç”¨ç»å¯¹è·¯å¾„

### ä¿å­˜åæ¸¸æˆæ²¡æœ‰ç”Ÿæ•ˆ

å¼•æ“åœ¨ `StageContext` é¦–æ¬¡å®ä¾‹åŒ–æ—¶åŠ è½½åˆ«åè¡¨ã€‚ç¡®è®¤ï¼š

1. å…³å¡è„šæœ¬é‡Œä½¿ç”¨çš„ `bullet_type` å’Œ `color` åç§°ä¸ JSON ä¸­ä¸€è‡´
2. é‡æ–°å¯åŠ¨æ¸¸æˆï¼ˆåˆ«åè¡¨åœ¨è¿›ç¨‹å¯åŠ¨æ—¶åŠ è½½ï¼Œä¸ä¼šçƒ­é‡è½½ï¼‰

### çº¹ç†ç¼–è¾‘å™¨åŠ è½½å¤±è´¥

çº¹ç†ç¼–è¾‘å™¨ä¾èµ–å¼•æ“çš„ `UnifiedTextureManager`ã€‚ç¡®ä¿ `src/resource/unified_texture.py` å­˜åœ¨ä¸”æ²¡æœ‰è¯­æ³•é”™è¯¯ã€‚

### å¦‚ä½•æ·»åŠ å…¨æ–°çš„å¼¹å¹•ç±»å‹ï¼Ÿ

1. åœ¨çº¹ç†ç¼–è¾‘å™¨ä¸­ä¸ºæ–°ç²¾çµå›¾é›†æ·»åŠ è£åˆ‡å®šä¹‰
2. åœ¨å¼¹å¹•åˆ«åç®¡ç†å™¨ä¸­ç‚¹å‡» "æ·»åŠ ç±»å‹"ï¼Œè¾“å…¥æ–°çš„åˆ«å
3. é€é¢œè‰²ç‚¹å‡»æ ¼å­ï¼Œåœ¨ç²¾çµé€‰å–å™¨ä¸­é€‰æ‹©å¯¹åº”ç²¾çµ
4. ä¿å­˜ â†’ åœ¨å…³å¡è„šæœ¬ä¸­å³å¯ä½¿ç”¨æ–°ç±»å‹å

### å¦‚ä½•æ‰©å±•ç¼–è¾‘å™¨ï¼Ÿ

å¦‚æœéœ€è¦åˆ›å»ºæ–°çš„ç¼–è¾‘å™¨å·¥å…·ï¼š

1. åœ¨ `tools/` ä¸‹åˆ›å»ºæ–°çš„ `.py` æ–‡ä»¶
2. å¯¼å…¥ `editor_common` ä½¿ç”¨å…±äº«ä¸»é¢˜å’Œå·¥å…·å‡½æ•°
3. åœ¨ `editor_launcher.py` ä¸­æ·»åŠ ä¸€å¼ æ–°çš„ `ToolCard`

```python
from tools.editor_common import DARK_THEME, apply_dark_theme, PROJECT_ROOT

class MyEditor(QMainWindow):
    def __init__(self):
        super().__init__()
        apply_dark_theme(self)
        ...
```
