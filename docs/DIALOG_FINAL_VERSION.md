# å¯¹è¯ç³»ç»Ÿæœ€ç»ˆç‰ˆæœ¬ - å®Œå…¨é›†æˆ âœ…

## ğŸ‰ å®Œæˆçš„å·¥ä½œ

### 1. ç®€åŒ– API - é¢å‘è¿‡ç¨‹
ä¸å†éœ€è¦å¤æ‚çš„ DialogPhase ç¬¦å¡å’Œå¤–éƒ¨å¯¹è¯æ–‡ä»¶ï¼Œç›´æ¥åœ¨å…³å¡æµç¨‹ä¸­å†™å¯¹è¯ï¼š

```python
async def run(self):
    # Boss æˆ˜å‰å¯¹è¯ - å°±åƒå†™å‰§æœ¬ä¸€æ ·ç®€å•
    await self.play_dialogue([
        ("Hinanawi_Tenshi", "left", "ä½ å°±æ˜¯æŒæ¡æ ¸èåˆåŠ›é‡çš„åœ°ç‹±é¸¦å—ï¼Ÿ"),
        ("Reiuji_Utsuho", "right", "æ²¡é”™ï¼æˆ‘æ˜¯çµä¹Œè·¯ç©ºï¼"),
        ("Reiuji_Utsuho", "right", "ä½ è¿™ä¸ªå¤©ç•Œçš„ä»»æ€§å°å§ï¼Œæ¥åœ°åº•åšä»€ä¹ˆï¼Ÿ"),
        ("Hinanawi_Tenshi", "left", "å½“ç„¶æ˜¯æ¥ä¿®è¡Œçš„ï¼æ­£å¥½æ‹¿ä½ ç»ƒç»ƒæ‰‹ï¼"),
        ("Reiuji_Utsuho", "right", "å“¼å“¼ï¼Œé‚£å°±è®©ä½ è§è¯†ä¸€ä¸‹æ ¸èåˆçš„å¨åŠ›ï¼"),
    ])

    await self.run_boss(self.boss)
```

### 2. è‡ªåŠ¨æ¸²æŸ“ - å·²é›†æˆ
å¯¹è¯æ¡†ä¼šè‡ªåŠ¨æ˜¾ç¤ºåœ¨å±å¹•åº•éƒ¨ï¼ŒåŒ…æ‹¬ï¼š
- âœ… åŠé€æ˜é»‘è‰²èƒŒæ™¯
- âœ… è§’è‰²åï¼ˆé»„è‰²ï¼‰
- âœ… å¯¹è¯æ–‡æœ¬ï¼ˆç™½è‰²ï¼‰
- âœ… æ‰“å­—æœºæ•ˆæœï¼ˆæ¯3å¸§ä¸€ä¸ªå­—ç¬¦ï¼‰
- âœ… è‡ªåŠ¨æ¢è¡Œ
- âœ… "[æŒ‰ Z ç»§ç»­]" æç¤º

### 3. æ¸²æŸ“é›†æˆä½ç½®
**å·²åœ¨ main.py æ·»åŠ æ¸²æŸ“ä»£ç **ï¼š

```python
# main.py ç¬¬ 306-311 è¡Œ
if stage_manager.current_stage:
    dialog_renderer = stage_manager.current_stage.get_dialog_renderer()
    if dialog_renderer:
        dialog_renderer.render(screen)
```

å¯¹è¯æ¡†åœ¨ UI å±‚ä¹‹åæ¸²æŸ“ï¼Œç¡®ä¿æ˜¾ç¤ºåœ¨æœ€ä¸Šå±‚ã€‚

## ğŸ“ ä¿®æ”¹çš„æ–‡ä»¶

### æ ¸å¿ƒå®ç°
1. **src/game/stage/stage_base.py**
   - æ·»åŠ  `play_dialogue()` æ–¹æ³• - ç®€åŒ–çš„å¯¹è¯ API
   - æ·»åŠ  `_current_dialog_renderer` å˜é‡
   - æ·»åŠ  `get_dialog_renderer()` æ–¹æ³•

2. **src/game/stage/simple_dialog_renderer.py**
   - ç®€åŒ–æ–‡æœ¬æ¸²æŸ“å™¨ï¼ˆå·²å­˜åœ¨ï¼‰

3. **main.py**
   - æ·»åŠ å¯¹è¯æ¸²æŸ“è°ƒç”¨ï¼ˆç¬¬ 306-311 è¡Œï¼‰

### Stage 1 æ›´æ–°
4. **game_content/stages/stage1/stage_script.py**
   - ç§»é™¤å¤æ‚çš„ `dialog()` å¯¼å…¥
   - ç§»é™¤ Boss.phases ä¸­çš„ dialog é˜¶æ®µ
   - åœ¨ run() ä¸­ä½¿ç”¨ `play_dialogue()` ç›´æ¥ç¼–å†™å¯¹è¯

## ğŸ® å¦‚ä½•ä½¿ç”¨

### åŸºæœ¬ç”¨æ³•

```python
class MyStage(StageScript):
    async def run(self):
        # ç®€å•å¯¹è¯
        await self.play_dialogue([
            ("è§’è‰²å", "left", "æ–‡æœ¬"),
            ("è§’è‰²å", "right", "æ–‡æœ¬"),
        ])

        # å¸¦æ°”æ³¡æ ·å¼çš„è¯¦ç»†å¯¹è¯
        await self.play_dialogue([
            {
                "character": "Hinanawi_Tenshi",
                "position": "left",
                "text": "ä½ å¥½ï¼",
                "balloon_style": 1  # æ ·å¼ 1-8
            }
        ])
```

### å¯¹è¯æ ¼å¼

| å‚æ•° | ç±»å‹ | è¯´æ˜ |
|------|------|------|
| character | str | è§’è‰²åï¼ˆå¦‚ "Hinanawi_Tenshi"ï¼‰ |
| position | str | ä½ç½® "left" æˆ– "right" |
| text | str | å¯¹è¯æ–‡æœ¬ |
| balloon_style | int | æ°”æ³¡æ ·å¼ 1-8ï¼ˆå¯é€‰ï¼Œé»˜è®¤ 1ï¼‰ |

## ğŸ”§ å½“å‰æ•ˆæœ

### è¿è¡Œæ¸¸æˆå
1. âœ… è¿›å…¥ Stage 1
2. âœ… æ‰“è´¥é“ä¸­ Boss å
3. âœ… å±å¹•åº•éƒ¨è‡ªåŠ¨æ˜¾ç¤ºå¯¹è¯æ¡†
4. âœ… å¯¹è¯é€å­—æ˜¾ç¤ºï¼ˆæ‰“å­—æœºæ•ˆæœï¼‰
5. âœ… æ¯å¥è¯æ˜¾ç¤ºä¸€æ®µæ—¶é—´åè‡ªåŠ¨åˆ°ä¸‹ä¸€å¥
6. âœ… å…¨éƒ¨å¯¹è¯ç»“æŸåè¿›å…¥ Boss æˆ˜

### æ§åˆ¶å°è¾“å‡º

```
[å¯¹è¯] Hinanawi_Tenshi (left): ä½ å°±æ˜¯æŒæ¡æ ¸èåˆåŠ›é‡çš„åœ°ç‹±é¸¦å—ï¼Ÿ
[å¯¹è¯] Reiuji_Utsuho (right): æ²¡é”™ï¼æˆ‘æ˜¯çµä¹Œè·¯ç©ºï¼
[å¯¹è¯] Reiuji_Utsuho (right): ä½ è¿™ä¸ªå¤©ç•Œçš„ä»»æ€§å°å§ï¼Œæ¥åœ°åº•åšä»€ä¹ˆï¼Ÿ
[å¯¹è¯] Hinanawi_Tenshi (left): å½“ç„¶æ˜¯æ¥ä¿®è¡Œçš„ï¼æ­£å¥½æ‹¿ä½ ç»ƒç»ƒæ‰‹ï¼
[å¯¹è¯] Reiuji_Utsuho (right): å“¼å“¼ï¼Œé‚£å°±è®©ä½ è§è¯†ä¸€ä¸‹æ ¸èåˆçš„å¨åŠ›ï¼
[å¯¹è¯] å¯¹è¯ç»“æŸ
```

## ğŸ¯ æœªæ¥ä¼˜åŒ–

### å½“å‰å·²å®ç° âœ…
- [x] ç®€åŒ– APIï¼ˆ3 è¡Œä»£ç ï¼‰
- [x] è‡ªåŠ¨æ¸²æŸ“ï¼ˆé›†æˆåˆ° main.pyï¼‰
- [x] æ‰“å­—æœºæ•ˆæœ
- [x] åŠé€æ˜èƒŒæ™¯
- [x] è§’è‰²åæ˜¾ç¤º
- [x] è‡ªåŠ¨æ¢è¡Œ

### æœªæ¥å¢å¼º ğŸš€
- [ ] æ°”æ³¡çº¹ç†ï¼ˆ8ç§æ ·å¼ï¼‰
- [ ] è§’è‰²ç«‹ç»˜ï¼ˆæ·¡å…¥æ·¡å‡ºï¼‰
- [ ] è¾“å…¥å¤„ç†ï¼ˆæŒ‰é”®è·³è¿‡ï¼‰
- [ ] éŸ³æ•ˆç³»ç»Ÿï¼ˆå¯¹è¯å‡ºç°éŸ³ã€æ–‡å­—éŸ³ï¼‰
- [ ] æ›´å¤šæ°”æ³¡æ ·å¼å’Œæ•ˆæœ

## ğŸ’¡ ä¼˜åŠ¿

### å¯¹æ¯”ä¹‹å‰çš„å¤æ‚æ–¹å¼

**ä¹‹å‰éœ€è¦**:
1. åˆ›å»ºç‹¬ç«‹çš„å¯¹è¯æ•°æ®æ–‡ä»¶
2. å®šä¹‰ DialogSequence å’Œ DialogSentence
3. å¯¼å…¥å¯¹è¯åˆ° stage_script.py
4. ä½¿ç”¨ dialog() å‡½æ•°æ’å…¥åˆ° Boss.phases
5. æ‰‹åŠ¨é›†æˆæ¸²æŸ“

**ç°åœ¨åªéœ€**:
1. åœ¨ run() ä¸­å†™ 3 è¡Œä»£ç 
2. å¯¹è¯è‡ªåŠ¨æ¸²æŸ“åˆ°å±å¹•

**ä»£ç å‡å°‘**: ä» ~50 è¡Œåˆ†æ•£åœ¨ 4 ä¸ªæ–‡ä»¶ â†’ 3 è¡Œåœ¨ 1 ä¸ªæ–‡ä»¶

## ğŸ“ æ›´æ–°è¯´æ˜

### ä»æ—§æ–¹å¼è¿ç§»

å¦‚æœä½ å·²ç»æœ‰æ—§çš„å¯¹è¯ä»£ç ï¼š

**æ—§ä»£ç **:
```python
from game_content.stages.stage1.dialogue.boss_dialogue import pre_boss_dialogue
from src.game.stage.boss_base import dialog

boss = BossDef(
    phases=[
        dialog(pre_boss_dialogue),  # âŒ åˆ é™¤è¿™è¡Œ
        nonspell(...),
    ]
)
```

**æ–°ä»£ç **:
```python
# ä¸éœ€è¦å¯¼å…¥å¯¹è¯æ•°æ®

boss = BossDef(
    phases=[
        nonspell(...),  # ç›´æ¥ä»ç¬¦å¡å¼€å§‹
    ]
)

async def run(self):
    # åœ¨æµç¨‹ä¸­ç›´æ¥å†™å¯¹è¯
    await self.play_dialogue([
        ("è§’è‰²", "ä½ç½®", "æ–‡æœ¬"),
    ])
    await self.run_boss(self.boss)
```

---

**ç°åœ¨å¯åŠ¨æ¸¸æˆå°±èƒ½çœ‹åˆ°å®Œæ•´çš„å¯¹è¯æ•ˆæœäº†ï¼** ğŸ®âœ¨
