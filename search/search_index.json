{"config":{"lang":["en"],"separator":"[\\s\\u200b\\u3000\\-\u3001\u3002\uff0c\uff0e\uff1f\uff01\uff1b]+","pipeline":["stemmer"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"pystg \u6587\u6863","text":"<p>Python \u4e1c\u65b9 Project \u98ce\u683c\u5f39\u5e55\u5c04\u51fb\u6e38\u620f\u5f15\u64ce\u3002</p>"},{"location":"#_1","title":"\u7ed9\u5185\u5bb9\u5f00\u53d1\u8005","text":"<p>\u60f3\u5199\u5f39\u5e55\u3001\u505a\u5173\u5361\uff1f\u53ea\u9700\u8981\u770b\u8fd9\u4e9b\uff1a</p> \u6587\u6863 \u5185\u5bb9 \u5feb\u901f\u5f00\u59cb \u73af\u5883\u642d\u5efa\u3001\u8fd0\u884c\u6e38\u620f\u3001\u9879\u76ee\u7ed3\u6784 \u5f39\u5e55\u811a\u672c\u5f00\u53d1\u6307\u5357 \u7b26\u5361\u3001\u6ce2\u6b21\u3001\u654c\u4eba\u3001Boss \u7684\u7f16\u5199\u65b9\u6cd5\u548c\u5b8c\u6574 API \u654c\u4eba\u9884\u8bbe\u7cfb\u7edf \u7528 JSON \u9884\u8bbe\u5feb\u901f\u521b\u5efa\u6742\u5175"},{"location":"#_2","title":"\u7ed9\u5f15\u64ce\u5f00\u53d1\u8005","text":"<p>\u60f3\u4e86\u89e3\u6216\u4fee\u6539\u5f15\u64ce\u672c\u8eab\uff1f</p> \u6587\u6863 \u5185\u5bb9 \u67b6\u6784\u6982\u89c8 \u5f15\u64ce\u5206\u5c42\u3001\u6a21\u5757\u4f9d\u8d56\u3001\u6838\u5fc3\u6570\u636e\u6d41 \u7eb9\u7406\u8d44\u4ea7\u7cfb\u7edf \u56fe\u96c6\u52a0\u8f7d\u3001\u7cbe\u7075\u5b9a\u4e49\u3001\u52a8\u753b\u914d\u7f6e \u7f16\u8f91\u5668\u5de5\u5177 \u5f39\u5e55\u522b\u540d\u7ba1\u7406\u5668\u3001\u7eb9\u7406\u7f16\u8f91\u5668\u3001\u81ea\u673a\u7f16\u8f91\u5668"},{"location":"#_3","title":"\u6280\u672f\u6808","text":"<ul> <li>pygame-ce + ModernGL \u2014 \u6e32\u67d3</li> <li>Numba \u2014 \u5b50\u5f39\u6c60 JIT \u52a0\u901f</li> <li>Python async/await \u2014 \u534f\u7a0b\u9a71\u52a8\u7684\u5f39\u5e55\u811a\u672c</li> <li>PyQt5 \u2014 \u7f16\u8f91\u5668\u5de5\u5177</li> </ul>"},{"location":"#_4","title":"\u6e90\u7801","text":"<ul> <li>GitHub: qwqpap/PythonSTG</li> </ul>"},{"location":"EDITOR_TOOLS_GUIDE/","title":"pystg \u7f16\u8f91\u5668\u5de5\u5177\u6307\u5357","text":"<p>\u672c\u6587\u6863\u4ecb\u7ecd pystg \u9644\u5e26\u7684\u4e09\u4e2a\u53ef\u89c6\u5316\u7f16\u8f91\u5668\u5de5\u5177\u7684\u5b89\u88c5\u3001\u542f\u52a8\u548c\u4f7f\u7528\u65b9\u6cd5\u3002</p>"},{"location":"EDITOR_TOOLS_GUIDE/#_1","title":"\u76ee\u5f55","text":"<ol> <li>\u6982\u89c8</li> <li>\u4f9d\u8d56\u5b89\u88c5</li> <li>\u7edf\u4e00\u542f\u52a8\u5668</li> <li>\u5f39\u5e55\u522b\u540d\u7ba1\u7406\u5668</li> <li>\u7eb9\u7406\u8d44\u4ea7\u7f16\u8f91\u5668</li> <li>\u81ea\u673a\u7f16\u8f91\u5668</li> <li>\u5171\u4eab\u6a21\u5757\u8bf4\u660e</li> <li>\u5e38\u89c1\u95ee\u9898</li> </ol>"},{"location":"EDITOR_TOOLS_GUIDE/#1","title":"1. \u6982\u89c8","text":"<p>pystg \u63d0\u4f9b\u4e09\u4e2a PyQt5 \u53ef\u89c6\u5316\u7f16\u8f91\u5668\uff0c\u7528\u4e8e\u7ba1\u7406\u6e38\u620f\u8d44\u4ea7\u914d\u7f6e\uff1a</p> \u5de5\u5177 \u6587\u4ef6 \u7528\u9014 \u5f39\u5e55\u522b\u540d\u7ba1\u7406\u5668 <code>tools/bullet_alias_manager.py</code> \u7ba1\u7406\u5f39\u5e55\u7c7b\u578b+\u989c\u8272\u2192\u7cbe\u7075\u7684\u6620\u5c04 \u7eb9\u7406\u8d44\u4ea7\u7f16\u8f91\u5668 <code>tools/asset_manager_qt.py</code> \u7f16\u8f91\u7cbe\u7075\u56fe\u96c6\u88c1\u5207\u533a\u57df\u3001\u52a8\u753b\u5e27\u3001\u6fc0\u5149\u914d\u7f6e \u81ea\u673a\u7f16\u8f91\u5668 <code>tools/player_editor.py</code> \u7f16\u8f91\u81ea\u673a\u52a8\u753b\u3001\u5c04\u51fb\u7c7b\u578b\u3001\u5b50\u673a\u914d\u7f6e <p>\u6b64\u5916\u8fd8\u6709\u4e00\u4e2a\u7edf\u4e00\u542f\u52a8\u5668\uff08<code>tools/editor_launcher.py</code>\uff09\uff0c\u53ef\u4ee5\u4ece\u4e00\u4e2a\u7a97\u53e3\u6253\u5f00\u4ee5\u4e0a\u6240\u6709\u7f16\u8f91\u5668\u3002</p> <p>\u6240\u6709\u7f16\u8f91\u5668\u5171\u4eab\u7edf\u4e00\u6697\u8272\u4e3b\u9898\uff08Catppuccin Mocha\uff09\uff0c\u516c\u5171\u4ee3\u7801\u4f4d\u4e8e <code>tools/editor_common.py</code>\u3002</p>"},{"location":"EDITOR_TOOLS_GUIDE/#_2","title":"\u6587\u4ef6\u7ed3\u6784","text":"<pre><code>tools/\n\u251c\u2500\u2500 editor_launcher.py          # \u7edf\u4e00\u542f\u52a8\u5668\n\u251c\u2500\u2500 editor_common.py            # \u5171\u4eab\u6a21\u5757\uff08\u4e3b\u9898\u3001\u7f13\u5b58\u3001\u6570\u636e\u52a0\u8f7d\uff09\n\u251c\u2500\u2500 bullet_alias_manager.py     # \u5f39\u5e55\u522b\u540d\u7ba1\u7406\u5668\n\u251c\u2500\u2500 asset_manager_qt.py         # \u7eb9\u7406\u8d44\u4ea7\u7f16\u8f91\u5668\n\u2514\u2500\u2500 player_editor.py            # \u81ea\u673a\u7f16\u8f91\u5668\n</code></pre>"},{"location":"EDITOR_TOOLS_GUIDE/#2","title":"2. \u4f9d\u8d56\u5b89\u88c5","text":"<p>\u6240\u6709\u7f16\u8f91\u5668\u90fd\u9700\u8981 PyQt5\uff1a</p> <pre><code>pip install PyQt5\n</code></pre> <p>\u7eb9\u7406\u8d44\u4ea7\u7f16\u8f91\u5668\u8fd8\u4f9d\u8d56\u5f15\u64ce\u6a21\u5757\uff08<code>src/resource/unified_texture.py</code>\uff09\uff0c\u65e0\u9700\u989d\u5916\u5b89\u88c5\u4f46\u9700\u8981\u786e\u4fdd\u9879\u76ee\u76ee\u5f55\u5b8c\u6574\u3002</p>"},{"location":"EDITOR_TOOLS_GUIDE/#3","title":"3. \u7edf\u4e00\u542f\u52a8\u5668","text":""},{"location":"EDITOR_TOOLS_GUIDE/#_3","title":"\u542f\u52a8","text":"<pre><code>python tools/editor_launcher.py\n</code></pre>"},{"location":"EDITOR_TOOLS_GUIDE/#_4","title":"\u529f\u80fd","text":"<p>\u542f\u52a8\u5668\u63d0\u4f9b\u4e09\u4e2a\u5de5\u5177\u5361\u7247\uff0c\u70b9\u51fb\u5373\u53ef\u542f\u52a8\u5bf9\u5e94\u7f16\u8f91\u5668\uff1a</p> <ul> <li>\ud83c\udfaf \u5f39\u5e55\u522b\u540d \u2014 \u6253\u5f00\u5f39\u5e55\u522b\u540d\u7ba1\u7406\u5668</li> <li>\ud83d\uddbc\ufe0f \u7eb9\u7406\u7f16\u8f91 \u2014 \u6253\u5f00\u7eb9\u7406\u8d44\u4ea7\u7f16\u8f91\u5668</li> <li>\u2708\ufe0f \u81ea\u673a\u7f16\u8f91 \u2014 \u6253\u5f00\u81ea\u673a\u7f16\u8f91\u5668</li> </ul> <p>\u6bcf\u4e2a\u7f16\u8f91\u5668\u5728\u72ec\u7acb\u8fdb\u7a0b\u4e2d\u8fd0\u884c\uff0c\u5173\u95ed\u542f\u52a8\u5668\u4e0d\u4f1a\u5f71\u54cd\u5df2\u6253\u5f00\u7684\u7f16\u8f91\u5668\u3002</p> <p>\u76f4\u63a5\u542f\u52a8</p> <p>\u4f60\u4e5f\u53ef\u4ee5\u8df3\u8fc7\u542f\u52a8\u5668\uff0c\u76f4\u63a5\u8fd0\u884c\u5404\u7f16\u8f91\u5668\u7684 Python \u811a\u672c\u3002</p>"},{"location":"EDITOR_TOOLS_GUIDE/#4","title":"4. \u5f39\u5e55\u522b\u540d\u7ba1\u7406\u5668","text":""},{"location":"EDITOR_TOOLS_GUIDE/#_5","title":"\u542f\u52a8","text":"<pre><code>python tools/bullet_alias_manager.py\n</code></pre>"},{"location":"EDITOR_TOOLS_GUIDE/#_6","title":"\u662f\u4ec0\u4e48\uff1f","text":"<p>\u5f39\u5e55\u522b\u540d\u7ba1\u7406\u5668\u7528\u6765\u5efa\u7acb\u5f39\u5e55\u7c7b\u578b + \u989c\u8272 \u2192 \u7cbe\u7075\u540d\u79f0\u7684\u6620\u5c04\u5173\u7cfb\u3002</p> <p>\u5728 pystg \u7684\u5173\u5361\u811a\u672c\u4e2d\uff0c\u53d1\u5c04\u5f39\u5e55\u65f6\u4f7f\u7528\u7684\u662f\u62bd\u8c61\u540d\u79f0\uff1a</p> <pre><code># \u5173\u5361\u811a\u672c\u4e2d\u7684\u5f39\u5e55\u53d1\u5c04\nctx.spawn_bullet(x, y, speed, angle, bullet_type=\"ball_m\", color=\"red\")\n</code></pre> <p>\u5f15\u64ce\u9700\u8981\u77e5\u9053 <code>ball_m</code> + <code>red</code> \u5bf9\u5e94\u54ea\u4e2a\u5177\u4f53\u7684\u7cbe\u7075\u56fe\uff08\u5982 <code>ball_mid1</code>\uff09\u3002 \u8fd9\u4e2a\u6620\u5c04\u5173\u7cfb\u5b58\u50a8\u5728 <code>assets/bullet_aliases.json</code> \u4e2d\uff0c\u7531\u672c\u5de5\u5177\u7ba1\u7406\u3002</p>"},{"location":"EDITOR_TOOLS_GUIDE/#_7","title":"\u754c\u9762\u5e03\u5c40","text":""},{"location":"EDITOR_TOOLS_GUIDE/#_8","title":"\u683c\u5b50\u72b6\u6001","text":"<p>\u7f51\u683c\u4e2d\u6bcf\u4e2a\u683c\u5b50\uff08SpriteCell\uff09\u4ee3\u8868\u4e00\u4e2a (\u5f39\u5e55\u7c7b\u578b, \u989c\u8272) \u7ec4\u5408\uff0c\u6709\u4e09\u79cd\u72b6\u6001\uff1a</p> \u72b6\u6001 \u8fb9\u6846\u989c\u8272 \u542b\u4e49 \ud83d\udfe2 \u7eff\u8272 \u5df2\u5206\u914d\uff0c\u5bf9\u5e94\u7cbe\u7075\u5b58\u5728 \u6b63\u5e38\u5de5\u4f5c \ud83d\udfe1 \u9ec4\u8272 \u5df2\u5206\u914d\uff0c\u4f46\u7cbe\u7075\u627e\u4e0d\u5230\uff08\u663e\u793a\u26a0\uff09 \u914d\u7f6e\u4e86\u540d\u79f0\u4f46\u56fe\u96c6\u4e2d\u6ca1\u6709\u8fd9\u4e2a\u7cbe\u7075 \ud83d\udd34 \u7ea2\u8272 \u672a\u5206\u914d\uff08\u663e\u793a\u2014\uff09 \u8fd8\u6ca1\u6709\u6620\u5c04\uff0c\u9700\u8981\u624b\u52a8\u8bbe\u7f6e"},{"location":"EDITOR_TOOLS_GUIDE/#_9","title":"\u57fa\u672c\u64cd\u4f5c","text":""},{"location":"EDITOR_TOOLS_GUIDE/#_10","title":"\u5206\u914d\u7cbe\u7075","text":"<ol> <li>\u5de6\u952e\u70b9\u51fb\u4efb\u610f\u683c\u5b50 \u2192 \u5f39\u51fa\u7cbe\u7075\u9009\u53d6\u5668</li> <li>\u5728\u9009\u53d6\u5668\u4e2d\u53ef\u4ee5\uff1a<ul> <li>\u4f7f\u7528\u641c\u7d22\u6846\u6309\u540d\u79f0\u8fc7\u6ee4</li> <li>\u4f7f\u7528\u4e0b\u62c9\u6846\u6309\u56fe\u96c6\u8fc7\u6ee4</li> <li>\u6d4f\u89c8\u7f29\u7565\u56fe\u7f51\u683c</li> </ul> </li> <li>\u53cc\u51fb\u7f29\u7565\u56fe \u2192 \u5feb\u901f\u786e\u8ba4\u9009\u62e9</li> <li>\u6216\u8005\u5148\u5355\u51fb\u9009\u4e2d\uff0c\u518d\u70b9\"\u786e\u5b9a\"</li> </ol>"},{"location":"EDITOR_TOOLS_GUIDE/#_11","title":"\u6e05\u9664\u5206\u914d","text":"<ul> <li>\u53f3\u952e\u70b9\u51fb\u683c\u5b50 \u2192 \u5f39\u51fa\u83dc\u5355 \u2192 \"\u6e05\u9664\u6b64\u683c\u5b50\"</li> </ul>"},{"location":"EDITOR_TOOLS_GUIDE/#_12","title":"\u6dfb\u52a0\u5f39\u5e55\u7c7b\u578b","text":"<ul> <li>\u5de5\u5177\u680f \"\u6dfb\u52a0\u7c7b\u578b\" \u2192 \u8f93\u5165\u65b0\u7684\u522b\u540d\uff08\u5982 <code>my_bullet</code>\uff09</li> <li>\u65b0\u7c7b\u578b\u4f1a\u51fa\u73b0\u5728\u7f51\u683c\u6700\u540e\u4e00\u884c\uff0c\u6240\u6709\u989c\u8272\u521d\u59cb\u4e3a\u672a\u5206\u914d</li> </ul>"},{"location":"EDITOR_TOOLS_GUIDE/#_13","title":"\u6dfb\u52a0\u989c\u8272","text":"<ul> <li>\u5de5\u5177\u680f \"\u6dfb\u52a0\u989c\u8272\" \u2192 \u8f93\u5165\u65b0\u989c\u8272\u540d\uff08\u5982 <code>pink</code>\uff09</li> <li>\u65b0\u989c\u8272\u4f1a\u6dfb\u52a0\u4e3a\u7f51\u683c\u7684\u65b0\u5217</li> </ul>"},{"location":"EDITOR_TOOLS_GUIDE/#_14","title":"\u5220\u9664\u5f39\u5e55\u7c7b\u578b / \u989c\u8272","text":"<ul> <li>\u83dc\u5355 \"\u7f16\u8f91\" \u2192 \"\u5220\u9664\u5f39\u5e55\u7c7b\u578b...\" / \"\u5220\u9664\u989c\u8272...\"</li> <li>\u9009\u62e9\u8981\u5220\u9664\u7684\u9879\u76ee\u540e\u786e\u8ba4</li> </ul>"},{"location":"EDITOR_TOOLS_GUIDE/#_15","title":"\u9a8c\u8bc1","text":"<ul> <li>\u5de5\u5177\u680f \"\u9a8c\u8bc1\" \u6216\u83dc\u5355 \"\u7f16\u8f91\" \u2192 \"\u9a8c\u8bc1\u6240\u6709\"</li> <li>\u68c0\u67e5\u6240\u6709\u5df2\u5206\u914d\u7684\u7cbe\u7075\u540d\u662f\u5426\u5728\u56fe\u96c6\u4e2d\u5b58\u5728</li> <li>\u7ed3\u679c\u663e\u793a\u5728\u5f39\u7a97\u4e2d</li> </ul>"},{"location":"EDITOR_TOOLS_GUIDE/#_16","title":"\u4fdd\u5b58","text":"<ul> <li>\u5de5\u5177\u680f \ud83d\udcbe / \u83dc\u5355 \"\u6587\u4ef6\" \u2192 \"\u4fdd\u5b58\" / <code>Ctrl+S</code></li> <li>\u4fdd\u5b58\u5230 <code>assets/bullet_aliases.json</code></li> <li>\u5173\u95ed\u7a97\u53e3\u65f6\u5982\u6709\u672a\u4fdd\u5b58\u4fee\u6539\u4f1a\u63d0\u793a</li> </ul>"},{"location":"EDITOR_TOOLS_GUIDE/#_17","title":"\u7cbe\u7075\u9009\u53d6\u5668","text":"<p>\u5f39\u51fa\u7684\u7cbe\u7075\u9009\u53d6\u5668\u63d0\u4f9b\u6240\u6709\u53ef\u7528\u7cbe\u7075\u7684\u53ef\u89c6\u5316\u6d4f\u89c8\uff1a</p> <pre><code>\u250c\u2500 \u9009\u62e9\u7cbe\u7075 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                                      \u2502\n\u2502  \ud83d\udd0d [\u641c\u7d22\u6846: ball_mid          ]     \u2502\n\u2502  \ud83d\udcc1 [\u56fe\u96c6\u8fc7\u6ee4: \u5168\u90e8 \u25bc          ]     \u2502\n\u2502                                      \u2502\n\u2502  \u250c\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u252c...       \u2502\n\u2502  \u2502spr1\u2502spr2\u2502spr3\u2502spr4\u2502spr5\u2502...       \u2502\n\u2502  \u251c\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2524          \u2502\n\u2502  \u2502spr6\u2502spr7\u2502spr8\u2502spr9\u2502 ...\u2502          \u2502\n\u2502  \u2514\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2518          \u2502\n\u2502                                      \u2502\n\u2502        [  \u786e\u5b9a  ] [  \u53d6\u6d88  ]         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <ul> <li>\u6bcf\u884c 10 \u4e2a\u7f29\u7565\u56fe\uff0864\u00d764 \u50cf\u7d20\uff09</li> <li>\u9f20\u6807\u60ac\u505c\u663e\u793a\u7cbe\u7075\u540d\u79f0\u548c\u6240\u5c5e\u56fe\u96c6</li> <li>\u5df2\u5728\u5f53\u524d\u683c\u5b50\u4e2d\u9009\u4e2d\u7684\u7cbe\u7075\u4f1a\u9ad8\u4eae\u6807\u8bb0</li> </ul>"},{"location":"EDITOR_TOOLS_GUIDE/#_18","title":"\u8f93\u51fa\u6587\u4ef6\u683c\u5f0f","text":"<p>\u4fdd\u5b58\u7684 <code>assets/bullet_aliases.json</code> \u683c\u5f0f\u5982\u4e0b\uff1a</p> <pre><code>{\n  \"version\": \"1.0\",\n  \"mapping\": {\n    \"ball_m\": {\n      \"red\": \"ball_mid1\",\n      \"blue\": \"ball_mid2\",\n      \"green\": \"ball_mid3\",\n      \"purple\": \"ball_mid4\",\n      \"orange\": \"ball_mid5\",\n      \"darkblue\": \"ball_mid6\",\n      \"white\": \"ball_mid7\",\n      \"yellow\": \"ball_mid8\"\n    },\n    \"ball_s\": {\n      \"red\": \"ball_small1\",\n      \"darkred\": \"ball_small2\",\n      \"blue\": \"ball_small3\",\n      ...\n    }\n  }\n}\n</code></pre>"},{"location":"EDITOR_TOOLS_GUIDE/#_19","title":"\u4e0e\u5f15\u64ce\u7684\u5173\u7cfb","text":"<p>\u5f15\u64ce\u7684 <code>StageContext</code>\uff08\u4f4d\u4e8e <code>src/game/stage/context.py</code>\uff09\u5728\u9996\u6b21\u5b9e\u4f8b\u5316\u65f6\u81ea\u52a8\u52a0\u8f7d\u6b64\u6587\u4ef6\uff1a</p> <pre><code>class StageContext:\n    BULLET_ALIAS_TABLE: Dict[str, Dict[str, str]] = {}\n\n    @classmethod\n    def load_bullet_aliases(cls, path=\"assets/bullet_aliases.json\"):\n        # \u8bfb\u53d6 JSON \u5e76\u586b\u5145 BULLET_ALIAS_TABLE\n        ...\n\n    def _resolve_sprite_id(self, bullet_type: str, color: str) -&gt; str:\n        # 1. \u4f18\u5148\u67e5 BULLET_ALIAS_TABLE\n        type_entry = self.BULLET_ALIAS_TABLE.get(bullet_type)\n        if type_entry:\n            sprite = type_entry.get(color)\n            if sprite:\n                return sprite\n        # 2. \u56de\u9000\u5230\u65e7\u7684 BULLET_TYPE_MAP + COLOR_MAP\n        ...\n</code></pre> <p>\u517c\u5bb9\u6027</p> <p>\u5373\u4f7f <code>bullet_aliases.json</code> \u4e0d\u5b58\u5728\uff0c\u5f15\u64ce\u4e5f\u4f1a\u56de\u9000\u5230\u5185\u7f6e\u7684 <code>BULLET_TYPE_MAP</code> / <code>COLOR_MAP</code> \u786c\u7f16\u7801\u6620\u5c04\u3002 \u65b0\u589e\u7684\u5f39\u5e55\u7c7b\u578b\uff08\u5982 <code>arrow_s</code>, <code>grain_a</code>, <code>kite</code> \u7b49\uff09\u53ea\u80fd\u901a\u8fc7 JSON \u522b\u540d\u8868\u4f7f\u7528\u3002</p>"},{"location":"EDITOR_TOOLS_GUIDE/#_20","title":"\u4e3a\u4ec0\u4e48\u4e0d\u540c\u7c7b\u578b\u7684\u989c\u8272\u6570\u4e0d\u540c\uff1f","text":"<p>\u4e0d\u540c\u5f39\u5e55\u4f7f\u7528\u4e0d\u540c\u6570\u91cf\u7684\u7cbe\u7075\u53d8\u4f53\uff08 \u6cbf\u7528LuaSTG \u89c4\u8303\uff09\uff1a</p> <ul> <li>8 \u8272\u7c7b\u578b\uff08\u5982 <code>ball_m</code>, <code>knife</code>, <code>star_l</code>\uff09\uff1ared, blue, green, purple, orange, darkblue, white, yellow</li> <li>16 \u8272\u7c7b\u578b\uff08\u5982 <code>ball_s</code>, <code>star_s</code>, <code>square</code>, <code>grain_*</code>\uff09\uff1a\u5728 8 \u8272\u57fa\u7840\u4e0a\u589e\u52a0 darkred, darkblue, darkgreen, darkpurple, darkorange, darkyellow, cyan, darkcyan, black</li> </ul> <p>\u540e\u7f00\u7f16\u53f7\uff08\u5982 <code>ball_mid1</code>, <code>ball_mid2</code>...\uff09\u5728\u4e0d\u540c\u7c7b\u578b\u4e2d\u4e0d\u4e00\u5b9a\u5bf9\u5e94\u76f8\u540c\u989c\u8272\uff0c\u6240\u4ee5\u9700\u8981\u8fd9\u4e2a\u5de5\u5177\u6765\u9010\u7c7b\u578b\u7ba1\u7406\u6620\u5c04\u3002</p>"},{"location":"EDITOR_TOOLS_GUIDE/#5","title":"5. \u7eb9\u7406\u8d44\u4ea7\u7f16\u8f91\u5668","text":""},{"location":"EDITOR_TOOLS_GUIDE/#_21","title":"\u542f\u52a8","text":"<pre><code>python tools/asset_manager_qt.py\n</code></pre>"},{"location":"EDITOR_TOOLS_GUIDE/#_22","title":"\u529f\u80fd\u6982\u8ff0","text":"<p>\u7eb9\u7406\u8d44\u4ea7\u7f16\u8f91\u5668\u76f4\u63a5\u96c6\u6210\u6e38\u620f\u5f15\u64ce\u7684 <code>UnifiedTextureManager</code>\uff0c\u53ef\u4ee5\u7f16\u8f91\u6240\u6709\u7c7b\u578b\u7684\u7cbe\u7075\u8d44\u4ea7\u3002</p>"},{"location":"EDITOR_TOOLS_GUIDE/#_23","title":"\u652f\u6301\u7684\u8d44\u4ea7\u7c7b\u578b","text":"\u7c7b\u522b \u8def\u5f84 \u8bf4\u660e \u5b50\u5f39 <code>assets/images/bullet/</code> \u5b50\u5f39\u7cbe\u7075\u56fe\u96c6 \u6fc0\u5149 <code>assets/images/laser/</code> \u6fc0\u5149\u7eb9\u7406\uff08head/body/tail \u4e09\u6bb5\u5f0f\uff09 \u73a9\u5bb6 <code>assets/images/player/</code> \u81ea\u673a\u7cbe\u7075 \u654c\u4eba <code>assets/images/enemy/</code> \u654c\u673a\u7cbe\u7075 \u9053\u5177 <code>assets/images/item/</code> \u9053\u5177\u7cbe\u7075 \u80cc\u666f <code>assets/images/background/</code> \u5173\u5361\u80cc\u666f UI <code>assets/images/ui/</code> \u754c\u9762\u5143\u7d20"},{"location":"EDITOR_TOOLS_GUIDE/#_24","title":"\u4e3b\u8981\u529f\u80fd","text":"<ul> <li>\u7cbe\u7075\u88c1\u5207\u7f16\u8f91\uff1a\u5728\u7eb9\u7406\u56fe\u96c6\u4e0a\u53ef\u89c6\u5316\u9009\u53d6\u7cbe\u7075\u533a\u57df\uff08rect\uff09</li> <li>\u4e2d\u5fc3\u70b9\u914d\u7f6e\uff1a\u8bbe\u5b9a\u7cbe\u7075\u65cb\u8f6c/\u6e32\u67d3\u4e2d\u5fc3\u70b9</li> <li>\u78b0\u649e\u534a\u5f84\uff1a\u914d\u7f6e\u78b0\u649e\u68c0\u6d4b\u7684\u5706\u5f62\u534a\u5f84</li> <li>\u52a8\u753b\u5e27\u7f16\u8f91\uff1a\u7ba1\u7406\u5e8f\u5217\u5e27\u52a8\u753b</li> <li>\u6fc0\u5149\u4e09\u6bb5\u9884\u89c8\uff1ahead / body / tail \u4e09\u6bb5\u5f0f\u6fc0\u5149\u7684\u53ef\u89c6\u5316\u9884\u89c8</li> <li>16 \u8272\u53d8\u4f53\u7ec4\u7ba1\u7406\uff1a\u7ba1\u7406\u5f39\u5e55\u989c\u8272\u53d8\u4f53\u7ec4</li> <li>\u5b9e\u65f6\u9884\u89c8\uff1a\u6240\u6709\u4fee\u6539\u5373\u65f6\u663e\u793a\u6548\u679c</li> </ul>"},{"location":"EDITOR_TOOLS_GUIDE/#_25","title":"\u6570\u636e\u5b58\u50a8","text":"<p>\u6bcf\u4e2a\u56fe\u96c6\u76ee\u5f55\u4e0b\u7684 JSON \u6587\u4ef6\uff08\u5982 <code>assets/images/bullet/bullet1.json</code>\uff09\u5b58\u50a8\u7cbe\u7075\u5b9a\u4e49\uff1a</p> <pre><code>{\n  \"__image_filename\": \"bullet1.png\",\n  \"sprites\": {\n    \"ball_mid1\": {\n      \"rect\": [0, 0, 32, 32],\n      \"center\": [16, 16],\n      \"radius\": 8,\n      \"rotate\": false\n    },\n    ...\n  }\n}\n</code></pre> <p>\u4fee\u6539\u7acb\u5373\u751f\u6548</p> <p>\u7eb9\u7406\u7f16\u8f91\u5668\u7684\u4fdd\u5b58\u76f4\u63a5\u5199\u5165\u5f15\u64ce\u4f7f\u7528\u7684 JSON \u914d\u7f6e\u6587\u4ef6\uff0c\u4fee\u6539\u540e\u91cd\u542f\u6e38\u620f\u5373\u53ef\u770b\u5230\u6548\u679c\u3002</p>"},{"location":"EDITOR_TOOLS_GUIDE/#6","title":"6. \u81ea\u673a\u7f16\u8f91\u5668","text":""},{"location":"EDITOR_TOOLS_GUIDE/#_26","title":"\u542f\u52a8","text":"<pre><code>python tools/player_editor.py\n</code></pre>"},{"location":"EDITOR_TOOLS_GUIDE/#_27","title":"\u529f\u80fd\u6982\u8ff0","text":"<p>\u81ea\u673a\u7f16\u8f91\u5668\u7528\u4e8e\u914d\u7f6e\u73a9\u5bb6\u89d2\u8272\u7684\u5404\u9879\u5c5e\u6027\u3002</p>"},{"location":"EDITOR_TOOLS_GUIDE/#_28","title":"\u4e3b\u8981\u529f\u80fd","text":"<ul> <li>\u52a8\u753b\u72b6\u6001\u673a\uff1a\u7f16\u8f91\u7a7a\u95f2 / \u5de6\u79fb / \u53f3\u79fb / \u7279\u6b8a\u52a8\u753b\u72b6\u6001\u53ca\u5207\u6362\u89c4\u5219</li> <li>\u7cbe\u7075\u5e27\u9884\u89c8\uff1a\u5b9e\u65f6\u9884\u89c8\u52a8\u753b\u5e27\u5e8f\u5217</li> <li>\u5c04\u51fb\u7c7b\u578b\uff1a\u914d\u7f6e\u4e3b\u6b66\u5668\u548c\u526f\u6b66\u5668\u7684\u5f39\u5e55\u53d1\u5c04\u53c2\u6570</li> <li>\u5b50\u673a\uff08Option\uff09\u914d\u7f6e\uff1a\u8bbe\u5b9a\u5b50\u673a\u4f4d\u7f6e\u3001\u52a8\u753b\u3001\u653b\u51fb\u884c\u4e3a</li> <li>\u79fb\u52a8\u53c2\u6570\uff1a\u5e38\u901f / \u4f4e\u901f\u79fb\u52a8\u901f\u5ea6\u914d\u7f6e</li> </ul>"},{"location":"EDITOR_TOOLS_GUIDE/#_29","title":"\u6570\u636e\u5b58\u50a8","text":"<p>\u81ea\u673a\u914d\u7f6e\u4f4d\u4e8e <code>assets/players/&lt;\u89d2\u8272\u540d&gt;/config.json</code>\uff1a</p> <pre><code>assets/players/\n\u251c\u2500\u2500 reimu/\n\u2502   \u251c\u2500\u2500 config.json       # \u89d2\u8272\u914d\u7f6e\uff08\u52a8\u753b\u3001\u5c04\u51fb\u3001\u5b50\u673a\u7b49\uff09\n\u2502   \u2514\u2500\u2500 reimu.png         # \u89d2\u8272\u7cbe\u7075\u56fe\n\u2514\u2500\u2500 sakuya/\n    \u251c\u2500\u2500 config.json\n    \u2514\u2500\u2500 sakuya.png\n</code></pre>"},{"location":"EDITOR_TOOLS_GUIDE/#7","title":"7. \u5171\u4eab\u6a21\u5757\u8bf4\u660e","text":"<p><code>tools/editor_common.py</code> \u63d0\u4f9b\u4ee5\u4e0b\u5171\u7528\u529f\u80fd\uff1a</p>"},{"location":"EDITOR_TOOLS_GUIDE/#_30","title":"\u8def\u5f84\u5e38\u91cf","text":"<pre><code>PROJECT_ROOT     # \u9879\u76ee\u6839\u76ee\u5f55\nASSET_ROOT       # assets/ \u76ee\u5f55\nBULLET_IMAGE_DIR # assets/images/bullet/ \u76ee\u5f55\nBULLET_ALIASES_PATH  # assets/bullet_aliases.json \u8def\u5f84\nPLAYERS_ROOT     # assets/players/ \u76ee\u5f55\n</code></pre>"},{"location":"EDITOR_TOOLS_GUIDE/#_31","title":"\u7edf\u4e00\u6697\u8272\u4e3b\u9898","text":"<pre><code>from tools.editor_common import DARK_THEME, apply_dark_theme\n\n# \u65b9\u5f0f1\uff1a\u76f4\u63a5\u8bbe\u7f6e stylesheet\nwidget.setStyleSheet(DARK_THEME)\n\n# \u65b9\u5f0f2\uff1a\u4f7f\u7528\u8f85\u52a9\u51fd\u6570\napply_dark_theme(widget)\n</code></pre> <p>\u4e3b\u9898\u57fa\u4e8e Catppuccin Mocha \u914d\u8272\u65b9\u6848\uff0c\u8986\u76d6\u4e86 QMainWindow\u3001QDialog\u3001QMenu\u3001QPushButton\u3001QTableWidget\u3001QTreeWidget\u3001QLineEdit\u3001QComboBox\u3001QScrollBar \u7b49\u5e38\u7528\u63a7\u4ef6\u3002</p>"},{"location":"EDITOR_TOOLS_GUIDE/#_32","title":"\u7cbe\u7075\u6570\u636e\u52a0\u8f7d","text":"<pre><code>from tools.editor_common import (\n    SpriteEntry,\n    load_all_bullet_sprites,\n    get_all_sprite_names,\n    get_sprite_entry_map,\n)\n\n# \u52a0\u8f7d\u6240\u6709\u5b50\u5f39\u56fe\u96c6\natlases = load_all_bullet_sprites()\n# atlases = {\"bullet1\": [SpriteEntry(...), ...], \"bullet2\": [...]}\n\n# \u83b7\u53d6\u6240\u6709\u7cbe\u7075\u540d\uff08\u96c6\u5408\uff09\nall_names = get_all_sprite_names(atlases)\n\n# \u83b7\u53d6 name\u2192entry \u6620\u5c04\nentries = get_sprite_entry_map(atlases)\n</code></pre> <p><code>SpriteEntry</code> \u6570\u636e\u7c7b\uff1a</p> <pre><code>@dataclass\nclass SpriteEntry:\n    name: str               # \u7cbe\u7075\u540d\u79f0\uff0c\u5982 \"ball_mid1\"\n    atlas: str              # \u6240\u5c5e\u56fe\u96c6\u540d\uff0c\u5982 \"bullet1\"\n    texture_path: str       # \u7eb9\u7406 PNG \u5b8c\u6574\u8def\u5f84\n    rect: (int,int,int,int) # \u88c1\u5207\u533a\u57df (x, y, w, h)\n    center: (float, float)  # \u4e2d\u5fc3\u70b9\u504f\u79fb\n    radius: float           # \u78b0\u649e\u534a\u5f84\n    rotate: bool            # \u662f\u5426\u65cb\u8f6c\n</code></pre>"},{"location":"EDITOR_TOOLS_GUIDE/#qpixmap","title":"QPixmap \u7f13\u5b58","text":"<pre><code>from tools.editor_common import PixmapCache\n\n# \u9884\u52a0\u8f7d\u6240\u6709\u7cbe\u7075\uff08\u5efa\u8bae\u5728 QApplication \u521b\u5efa\u540e\u8c03\u7528\uff09\nPixmapCache.ensure_all_loaded(atlases)\n\n# \u83b7\u53d6\u7cbe\u7075\u7684 QPixmap\npixmap = PixmapCache.get_sprite(sprite_entry)\n\n# \u6309\u540d\u79f0\u83b7\u53d6\uff08\u9700\u5148\u52a0\u8f7d\uff09\npixmap = PixmapCache.get_sprite_by_name(\"ball_mid1\")\n\n# \u521b\u5efa\u5360\u4f4d\u7b26\nplaceholder = PixmapCache.make_placeholder(size=32, text=\"?\")\n</code></pre>"},{"location":"EDITOR_TOOLS_GUIDE/#json","title":"\u522b\u540d JSON \u8bfb\u5199","text":"<pre><code>from tools.editor_common import (\n    load_bullet_aliases,\n    save_bullet_aliases,\n    generate_default_aliases,\n)\n\n# \u8bfb\u53d6\nmapping = load_bullet_aliases()\n# mapping = {\"ball_m\": {\"red\": \"ball_mid1\", ...}, ...}\n\n# \u81ea\u52a8\u751f\u6210\u521d\u59cb\u6620\u5c04\natlases = load_all_bullet_sprites()\nmapping = generate_default_aliases(atlases)\n\n# \u4fdd\u5b58\nsave_bullet_aliases(mapping)\n</code></pre>"},{"location":"EDITOR_TOOLS_GUIDE/#8","title":"8. \u5e38\u89c1\u95ee\u9898","text":""},{"location":"EDITOR_TOOLS_GUIDE/#modulenotfounderror-no-module-named-pyqt5","title":"\u542f\u52a8\u62a5\u9519 ModuleNotFoundError: No module named 'PyQt5'","text":"<p>\u5b89\u88c5 PyQt5\uff1a</p> <pre><code>pip install PyQt5\n</code></pre>"},{"location":"EDITOR_TOOLS_GUIDE/#_33","title":"\u5f39\u5e55\u522b\u540d\u7ba1\u7406\u5668\u6253\u5f00\u540e\u7f51\u683c\u662f\u7a7a\u7684","text":"<p>\u53ef\u80fd\u539f\u56e0\uff1a</p> <ol> <li><code>assets/bullet_aliases.json</code> \u4e0d\u5b58\u5728 \u2014 \u5de5\u5177\u4f1a\u81ea\u52a8\u6839\u636e\u5b9e\u9645\u7cbe\u7075\u751f\u6210\u9ed8\u8ba4\u6620\u5c04</li> <li><code>assets/images/bullet/</code> \u76ee\u5f55\u4e0b\u6ca1\u6709 JSON \u914d\u7f6e\u6216 PNG \u56fe\u7247</li> <li>\u786e\u4fdd\u4ece\u9879\u76ee\u6839\u76ee\u5f55\u542f\u52a8\uff0c\u6216\u4f7f\u7528\u7edd\u5bf9\u8def\u5f84</li> </ol>"},{"location":"EDITOR_TOOLS_GUIDE/#_34","title":"\u4fdd\u5b58\u540e\u6e38\u620f\u6ca1\u6709\u751f\u6548","text":"<p>\u5f15\u64ce\u5728 <code>StageContext</code> \u9996\u6b21\u5b9e\u4f8b\u5316\u65f6\u52a0\u8f7d\u522b\u540d\u8868\u3002\u786e\u8ba4\uff1a</p> <ol> <li>\u5173\u5361\u811a\u672c\u91cc\u4f7f\u7528\u7684 <code>bullet_type</code> \u548c <code>color</code> \u540d\u79f0\u4e0e JSON \u4e2d\u4e00\u81f4</li> <li>\u91cd\u65b0\u542f\u52a8\u6e38\u620f\uff08\u522b\u540d\u8868\u5728\u8fdb\u7a0b\u542f\u52a8\u65f6\u52a0\u8f7d\uff0c\u4e0d\u4f1a\u70ed\u91cd\u8f7d\uff09</li> </ol>"},{"location":"EDITOR_TOOLS_GUIDE/#_35","title":"\u7eb9\u7406\u7f16\u8f91\u5668\u52a0\u8f7d\u5931\u8d25","text":"<p>\u7eb9\u7406\u7f16\u8f91\u5668\u4f9d\u8d56\u5f15\u64ce\u7684 <code>UnifiedTextureManager</code>\u3002\u786e\u4fdd <code>src/resource/unified_texture.py</code> \u5b58\u5728\u4e14\u6ca1\u6709\u8bed\u6cd5\u9519\u8bef\u3002</p>"},{"location":"EDITOR_TOOLS_GUIDE/#_36","title":"\u5982\u4f55\u6dfb\u52a0\u5168\u65b0\u7684\u5f39\u5e55\u7c7b\u578b\uff1f","text":"<ol> <li>\u5728\u7eb9\u7406\u7f16\u8f91\u5668\u4e2d\u4e3a\u65b0\u7cbe\u7075\u56fe\u96c6\u6dfb\u52a0\u88c1\u5207\u5b9a\u4e49</li> <li>\u5728\u5f39\u5e55\u522b\u540d\u7ba1\u7406\u5668\u4e2d\u70b9\u51fb \"\u6dfb\u52a0\u7c7b\u578b\"\uff0c\u8f93\u5165\u65b0\u7684\u522b\u540d</li> <li>\u9010\u989c\u8272\u70b9\u51fb\u683c\u5b50\uff0c\u5728\u7cbe\u7075\u9009\u53d6\u5668\u4e2d\u9009\u62e9\u5bf9\u5e94\u7cbe\u7075</li> <li>\u4fdd\u5b58 \u2192 \u5728\u5173\u5361\u811a\u672c\u4e2d\u5373\u53ef\u4f7f\u7528\u65b0\u7c7b\u578b\u540d</li> </ol>"},{"location":"EDITOR_TOOLS_GUIDE/#_37","title":"\u5982\u4f55\u6269\u5c55\u7f16\u8f91\u5668\uff1f","text":"<p>\u5982\u679c\u9700\u8981\u521b\u5efa\u65b0\u7684\u7f16\u8f91\u5668\u5de5\u5177\uff1a</p> <ol> <li>\u5728 <code>tools/</code> \u4e0b\u521b\u5efa\u65b0\u7684 <code>.py</code> \u6587\u4ef6</li> <li>\u5bfc\u5165 <code>editor_common</code> \u4f7f\u7528\u5171\u4eab\u4e3b\u9898\u548c\u5de5\u5177\u51fd\u6570</li> <li>\u5728 <code>editor_launcher.py</code> \u4e2d\u6dfb\u52a0\u4e00\u5f20\u65b0\u7684 <code>ToolCard</code></li> </ol> <pre><code>from tools.editor_common import DARK_THEME, apply_dark_theme, PROJECT_ROOT\n\nclass MyEditor(QMainWindow):\n    def __init__(self):\n        super().__init__()\n        apply_dark_theme(self)\n        ...\n</code></pre>"},{"location":"ENEMY_PRESET_SYSTEM/","title":"\u654c\u4eba\u9884\u8bbe\u7cfb\u7edf\u6587\u6863","text":""},{"location":"ENEMY_PRESET_SYSTEM/#_2","title":"\u6982\u8ff0","text":"<p>\u672c\u9879\u76ee\u5b9e\u73b0\u4e86\u7c7b\u4f3c LuaSTG \u7684\u654c\u4eba\u9884\u8bbe\u7cfb\u7edf\uff08style system\uff09\uff0c\u901a\u8fc7\u9884\u5148\u5b9a\u4e49\u7684\u914d\u7f6e\u6587\u4ef6\u5feb\u901f\u521b\u5efa\u5177\u6709\u7279\u5b9a\u5916\u89c2\u548c\u884c\u4e3a\u7684\u654c\u4eba\u3002\u8fd9\u4e2a\u7cfb\u7edf\u5c06\u5916\u89c2\u914d\u7f6e\u548c\u884c\u4e3a\u7f16\u5199\u89e3\u8026\uff0c\u8ba9\u5185\u5bb9\u521b\u4f5c\u66f4\u52a0\u9ad8\u6548\u3002</p>"},{"location":"ENEMY_PRESET_SYSTEM/#_3","title":"\u6838\u5fc3\u6982\u5ff5","text":""},{"location":"ENEMY_PRESET_SYSTEM/#_4","title":"\u4e09\u79cd\u9884\u8bbe\u7c7b\u578b","text":"<ol> <li>\u654c\u4eba\u9884\u8bbe\uff08Enemy Presets\uff09</li> <li>\u5b9a\u4e49\u654c\u4eba\u7684\u5916\u89c2\u3001\u751f\u547d\u503c\u3001\u5f97\u5206\u7b49\u57fa\u7840\u5c5e\u6027</li> <li>\u7c7b\u4f3c LuaSTG \u7684 style \u53c2\u6570\uff081-18\u6570\u5b57ID\uff09</li> <li> <p>\u793a\u4f8b\uff1a<code>fairy_red</code>, <code>orb_blue</code>, <code>ghost_fire_red</code></p> </li> <li> <p>\u884c\u4e3a\u9884\u8bbe\uff08Behavior Presets\uff09</p> </li> <li>\u5b9a\u4e49\u654c\u4eba\u7684\u884c\u52a8\u6a21\u5f0f\uff08\u8fdb\u573a-\u5c04\u51fb-\u79bb\u5f00\u7b49\uff09</li> <li>\u53ef\u590d\u7528\u7684\u884c\u4e3a\u6d41\u7a0b</li> <li> <p>\u793a\u4f8b\uff1a<code>rush_in_shoot_leave</code>, <code>side_pass_shoot</code>, <code>dive_attack</code></p> </li> <li> <p>\u653b\u51fb\u9884\u8bbe\uff08Attack Presets\uff09</p> </li> <li>\u5b9a\u4e49\u5f39\u5e55\u53d1\u5c04\u6a21\u5f0f</li> <li>\u53ef\u7ec4\u5408\u7684\u653b\u51fb\u65b9\u5f0f</li> <li>\u793a\u4f8b\uff1a<code>burst_8way</code>, <code>aimed_3shot</code>, <code>spiral_dense</code></li> </ol>"},{"location":"ENEMY_PRESET_SYSTEM/#_5","title":"\u4f7f\u7528\u65b9\u5f0f","text":""},{"location":"ENEMY_PRESET_SYSTEM/#1","title":"\u65b9\u5f0f1: \u9884\u8bbe + \u81ea\u5b9a\u4e49\u884c\u4e3a\uff08\u6700\u7075\u6d3b\uff09","text":"<pre><code>from src.game.stage.preset_enemy import PresetEnemy\n\nclass CustomRedFairy(PresetEnemy):\n    preset_id = \"fairy_red\"  # \u6307\u5b9a\u9884\u8bbeID\n\n    async def run(self):\n        # \u81ea\u5b9a\u4e49\u884c\u4e3a\u903b\u8f91\n        await self.move_to(self.x, 0.3, duration=60)\n\n        # \u4f7f\u7528\u9884\u8bbe\u7684\u9ed8\u8ba4\u53c2\u6570\n        self.fire_circle(\n            count=8,\n            speed=self.defaults['move_speed'],\n            bullet_type=self.defaults['bullet_type'],\n            color=self.defaults['bullet_color']\n        )\n\n        await self.wait(60)\n        await self.move_to(self.x, -0.2, duration=60)\n</code></pre> <p>\u4f18\u70b9\uff1a\u5b8c\u5168\u81ea\u5b9a\u4e49\u884c\u4e3a\uff0c\u540c\u65f6\u4eab\u53d7\u9884\u8bbe\u7684\u5916\u89c2\u914d\u7f6e \u9002\u7528\u573a\u666f\uff1a\u9700\u8981\u72ec\u7279\u884c\u4e3a\u7684\u654c\u4eba</p>"},{"location":"ENEMY_PRESET_SYSTEM/#2","title":"\u65b9\u5f0f2: \u9884\u8bbe + \u884c\u4e3a\u9884\u8bbe\uff08\u6700\u7b80\u5355\uff09","text":"<pre><code>from src.game.stage.preset_enemy import PresetEnemy\n\nclass AutoRedFairy(PresetEnemy):\n    preset_id = \"fairy_red\"\n    behavior_preset = \"rush_in_shoot_leave\"\n    # \u65e0\u9700\u5199 run() \u65b9\u6cd5\uff01\n</code></pre> <p>\u4f18\u70b9\uff1a\u4e00\u884c\u4ee3\u7801\u521b\u5efa\u654c\u4eba\uff0c\u96f6\u884c\u4e3a\u4ee3\u7801 \u9002\u7528\u573a\u666f\uff1a\u6807\u51c6\u7684\u6742\u5175\u654c\u4eba</p>"},{"location":"ENEMY_PRESET_SYSTEM/#3","title":"\u65b9\u5f0f3: \u52a8\u6001\u521b\u5efa\uff08\u6700\u9002\u5408\u7f16\u8f91\u5668\uff09","text":"<pre><code>from src.game.stage.preset_enemy import create_preset_enemy\n\n# \u5728\u7f16\u8f91\u5668\u4e2d\u6839\u636e\u7528\u6237\u9009\u62e9\u52a8\u6001\u521b\u5efa\nEnemyClass = create_preset_enemy(\n    preset_id=\"fairy_blue\",\n    behavior=\"side_pass_shoot\",\n    overrides={\"hp\": 50, \"score\": 200}  # \u53ef\u9009\uff1a\u8986\u76d6\u9ed8\u8ba4\u503c\n)\n\nenemy = EnemyClass()\n</code></pre> <p>\u4f18\u70b9\uff1a\u8fd0\u884c\u65f6\u52a8\u6001\u521b\u5efa\uff0c\u9002\u5408\u7f16\u8f91\u5668/\u5de5\u5177\u4f7f\u7528 \u9002\u7528\u573a\u666f\uff1a\u53ef\u89c6\u5316\u7f16\u8f91\u5668\u3001\u5173\u5361\u751f\u6210\u5668</p>"},{"location":"ENEMY_PRESET_SYSTEM/#_6","title":"\u914d\u7f6e\u6587\u4ef6\u7ed3\u6784","text":"<p>\u914d\u7f6e\u6587\u4ef6\u4f4d\u7f6e\uff1a<code>assets/configs/enemy_presets.json</code></p>"},{"location":"ENEMY_PRESET_SYSTEM/#_7","title":"\u654c\u4eba\u9884\u8bbe\u793a\u4f8b","text":"<pre><code>{\n  \"fairy_red\": {\n    \"name\": \"\u7ea2\u8272\u5996\u7cbe\",\n    \"sprite\": \"enemy_fairy_red\",\n    \"hp\": 30,\n    \"score\": 100,\n    \"hitbox_radius\": 0.02,\n    \"drop\": \"power_small\",\n    \"defaults\": {\n      \"bullet_type\": \"ball_s\",\n      \"bullet_color\": \"red\",\n      \"move_speed\": 2.0,\n      \"fire_rate\": 20\n    }\n  }\n}\n</code></pre>"},{"location":"ENEMY_PRESET_SYSTEM/#_8","title":"\u884c\u4e3a\u9884\u8bbe\u793a\u4f8b","text":"<pre><code>{\n  \"rush_in_shoot_leave\": {\n    \"name\": \"\u51b2\u5165-\u5c04\u51fb-\u79bb\u5f00\",\n    \"description\": \"\u4ece\u5c4f\u5e55\u9876\u90e8\u98de\u5165\uff0c\u505c\u987f\u5c04\u51fb\uff0c\u7136\u540e\u98de\u51fa\",\n    \"phases\": [\n      {\"action\": \"move_to\", \"params\": {\"target\": \"y=0.3\", \"duration\": 60}},\n      {\"action\": \"shoot_burst\", \"params\": {\"count\": 3, \"interval\": 20}},\n      {\"action\": \"move_to\", \"params\": {\"target\": \"y=-0.2\", \"duration\": 60}}\n    ]\n  }\n}\n</code></pre>"},{"location":"ENEMY_PRESET_SYSTEM/#_9","title":"\u5de5\u5177\u811a\u672c","text":""},{"location":"ENEMY_PRESET_SYSTEM/#_10","title":"\u5217\u51fa\u6240\u6709\u9884\u8bbe","text":"<pre><code>python tools/enemy/list_presets.py\n</code></pre> <p>\u8f93\u51fa\uff1a</p> <pre><code>==============================================================\n  \u53ef\u7528\u7684\u654c\u4eba\u9884\u8bbe\n==============================================================\n  \u2022 fairy_red           \u2192 \u7ea2\u8272\u5996\u7cbe (HP:30, \u5f97\u5206:100)\n  \u2022 fairy_blue          \u2192 \u84dd\u8272\u5996\u7cbe (HP:30, \u5f97\u5206:100)\n  \u2022 orb_red             \u2192 \u7ea2\u8272\u5e7d\u7075\u7403 (HP:50, \u5f97\u5206:200)\n  ...\n\n==============================================================\n  \u53ef\u7528\u7684\u884c\u4e3a\u9884\u8bbe\n==============================================================\n  \u2022 rush_in_shoot_leave \u2192 \u51b2\u5165-\u5c04\u51fb-\u79bb\u5f00\n    \u4ece\u5c4f\u5e55\u9876\u90e8\u98de\u5165\uff0c\u505c\u987f\u5c04\u51fb\uff0c\u7136\u540e\u98de\u51fa\n  \u2022 side_pass_shoot     \u2192 \u6a2a\u5411\u63a0\u8fc7\u5c04\u51fb\n    \u4ece\u4fa7\u9762\u6a2a\u5411\u98de\u8fc7,\u8fb9\u79fb\u52a8\u8fb9\u5c04\u51fb\n  ...\n</code></pre>"},{"location":"ENEMY_PRESET_SYSTEM/#_11","title":"\u67e5\u770b\u9884\u8bbe\u8be6\u60c5","text":"<pre><code>python tools/enemy/list_presets.py --detail fairy_red\n</code></pre>"},{"location":"ENEMY_PRESET_SYSTEM/#json","title":"\u5bfc\u51fa\u4e3a\u7f16\u8f91\u5668JSON","text":"<pre><code>python tools/enemy/list_presets.py --export editor_presets.json\n</code></pre> <p>\u751f\u6210\u7684JSON\u53ef\u76f4\u63a5\u7528\u4e8e\u7f16\u8f91\u5668UI\u7684\u4e0b\u62c9\u83dc\u5355\u3002</p>"},{"location":"ENEMY_PRESET_SYSTEM/#_12","title":"\u751f\u6210\u4f7f\u7528\u4ee3\u7801","text":"<pre><code>python tools/enemy/list_presets.py --usage fairy_red --behavior rush_in_shoot_leave\n</code></pre> <p>\u81ea\u52a8\u751f\u6210\u53ef\u590d\u5236\u7c98\u8d34\u7684\u793a\u4f8b\u4ee3\u7801\u3002</p>"},{"location":"ENEMY_PRESET_SYSTEM/#_13","title":"\u9884\u8bbe\u5c5e\u6027\u8bf4\u660e","text":""},{"location":"ENEMY_PRESET_SYSTEM/#_14","title":"\u654c\u4eba\u9884\u8bbe\u5c5e\u6027","text":"\u5c5e\u6027 \u7c7b\u578b \u8bf4\u660e \u793a\u4f8b <code>name</code> string \u53cb\u597d\u540d\u79f0 \"\u7ea2\u8272\u5996\u7cbe\" <code>sprite</code> string \u7cbe\u7075ID \"enemy_fairy_red\" <code>hp</code> int \u751f\u547d\u503c 30 <code>score</code> int \u51fb\u7834\u5f97\u5206 100 <code>hitbox_radius</code> float \u78b0\u649e\u534a\u5f84 0.02 <code>drop</code> string \u6389\u843d\u7269\u54c1 \"power_small\" <code>defaults</code> object \u9ed8\u8ba4\u53c2\u6570 \u89c1\u4e0b\u8868"},{"location":"ENEMY_PRESET_SYSTEM/#defaults","title":"defaults \u5bf9\u8c61","text":"\u5c5e\u6027 \u8bf4\u660e \u793a\u4f8b <code>bullet_type</code> \u5f39\u5e55\u7c7b\u578b \"ball_s\" <code>bullet_color</code> \u5f39\u5e55\u989c\u8272 \"red\" <code>move_speed</code> \u79fb\u52a8\u901f\u5ea6 2.0 <code>fire_rate</code> \u5c04\u51fb\u95f4\u9694\uff08\u5e27\uff09 20"},{"location":"ENEMY_PRESET_SYSTEM/#_15","title":"\u884c\u4e3a\u9884\u8bbe\u9636\u6bb5\u52a8\u4f5c","text":"\u52a8\u4f5c \u53c2\u6570 \u8bf4\u660e <code>move_to</code> target, duration \u79fb\u52a8\u5230\u76ee\u6807\u4f4d\u7f6e <code>move_linear</code> dx, dy, duration \u7ebf\u6027\u79fb\u52a8 <code>move_circle</code> radius, duration, center \u5706\u5f62\u79fb\u52a8 <code>shoot_burst</code> count, interval \u8fde\u53d1\u5f39\u5e55 <code>shoot_continuous</code> count, interval \u6301\u7eed\u5c04\u51fb <code>shoot_pattern</code> pattern, count \u53d1\u5c04\u5f39\u5e55\u6a21\u5f0f <code>wait</code> duration \u7b49\u5f85\u5e27\u6570"},{"location":"ENEMY_PRESET_SYSTEM/#_16","title":"\u53ef\u7528\u7684\u9884\u8bbe\u5217\u8868","text":""},{"location":"ENEMY_PRESET_SYSTEM/#_17","title":"\u654c\u4eba\u9884\u8bbe","text":"ID \u540d\u79f0 HP \u5f97\u5206 \u7279\u70b9 <code>fairy_red</code> \u7ea2\u8272\u5996\u7cbe 30 100 \u57fa\u7840\u6742\u5175 <code>fairy_blue</code> \u84dd\u8272\u5996\u7cbe 30 100 \u57fa\u7840\u6742\u5175 <code>fairy_green</code> \u7eff\u8272\u5996\u7cbe 35 150 \u7a0d\u5f3a\u6742\u5175 <code>orb_red</code> \u7ea2\u8272\u5e7d\u7075\u7403 50 200 \u4e2d\u578b\u654c\u4eba <code>orb_blue</code> \u84dd\u8272\u5e7d\u7075\u7403 50 200 \u4e2d\u578b\u654c\u4eba <code>ghost_fire_red</code> \u7ea2\u8272\u706b\u7130\u5e7d\u7075 80 300 \u5f3a\u654c <code>ghost_fire_blue</code> \u84dd\u8272\u706b\u7130\u5e7d\u7075 80 300 \u5f3a\u654c <code>kedama_pink</code> \u7c89\u8272\u6bdb\u7389 20 50 \u5feb\u901f\u5c0f\u578b\u654c\u4eba"},{"location":"ENEMY_PRESET_SYSTEM/#_18","title":"\u884c\u4e3a\u9884\u8bbe","text":"ID \u540d\u79f0 \u63cf\u8ff0 <code>rush_in_shoot_leave</code> \u51b2\u5165-\u5c04\u51fb-\u79bb\u5f00 \u6700\u7ecf\u5178\u7684\u6742\u5175\u6a21\u5f0f <code>side_pass_shoot</code> \u6a2a\u5411\u63a0\u8fc7\u5c04\u51fb \u4ece\u4fa7\u9762\u6a2a\u5411\u98de\u8fc7 <code>circle_strafe</code> \u73af\u7ed5\u5c04\u51fb \u4ee5\u5706\u5f62\u8def\u5f84\u79fb\u52a8 <code>dive_attack</code> \u4fef\u51b2\u653b\u51fb \u5feb\u901f\u4fef\u51b2\u5230\u5e95\u90e8 <code>ambush_retreat</code> \u7a81\u88ad-\u64a4\u9000 \u5feb\u901f\u98de\u5165\u540e\u64a4\u9000"},{"location":"ENEMY_PRESET_SYSTEM/#_19","title":"\u7f16\u8f91\u5668\u96c6\u6210\u5efa\u8bae","text":""},{"location":"ENEMY_PRESET_SYSTEM/#ui","title":"UI \u7ec4\u4ef6\u8bbe\u8ba1","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502 \u654c\u4eba\u521b\u5efa\u5668                      \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                                 \u2502\n\u2502 \u654c\u4eba\u9884\u8bbe:  [fairy_red \u25bc]       \u2502   \u2190 \u4ece enemy_presets.json \u52a0\u8f7d\n\u2502                                 \u2502\n\u2502 \u884c\u4e3a\u9884\u8bbe:  [rush_in_shoot_leave\u2502   \u2190 \u4ece behavior_presets.json \u52a0\u8f7d\n\u2502            \u25bc]                   \u2502\n\u2502                                 \u2502\n\u2502 \u250c\u2500 \u8986\u76d6\u5c5e\u6027 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\u2502\n\u2502 \u2502                             \u2502\u2502\n\u2502 \u2502 HP:    [30 ]  \u5f97\u5206: [100 ] \u2502\u2502   \u2190 \u53ef\u9009\uff1a\u8986\u76d6\u9ed8\u8ba4\u503c\n\u2502 \u2502                             \u2502\u2502\n\u2502 \u2502 \u4f4d\u7f6e:  X [0.0] Y [1.0]     \u2502\u2502\n\u2502 \u2502                             \u2502\u2502\n\u2502 \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\u2502\n\u2502                                 \u2502\n\u2502      [\u9884\u89c8]  [\u521b\u5efa]  [\u53d6\u6d88]    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"ENEMY_PRESET_SYSTEM/#_20","title":"\u6570\u636e\u6d41","text":"<pre><code>\u7528\u6237\u9009\u62e9 \u2192 \u52a0\u8f7d\u9884\u8bbe \u2192 \u9884\u89c8\u5c5e\u6027 \u2192 \u751f\u6210\u4ee3\u7801 \u2192 \u4fdd\u5b58\u5230\u6587\u4ef6\n   \u2502           \u2502          \u2502          \u2502          \u2502\n   \u2502           \u2502          \u2502          \u2502          \u2514\u2192 game_content/stages/.../\n   \u2502           \u2502          \u2502          \u2502\n   \u2502           \u2502          \u2502          \u2514\u2192 create_preset_enemy(...)\n   \u2502           \u2502          \u2502\n   \u2502           \u2502          \u2514\u2192 \u663e\u793a\uff1aHP=30, \u901f\u5ea6=2.0, \u989c\u8272=red\n   \u2502           \u2502\n   \u2502           \u2514\u2192 \u8bfb\u53d6 enemy_presets.json\n   \u2502\n   \u2514\u2192 \u4e0b\u62c9\u83dc\u5355: fairy_red\n</code></pre>"},{"location":"ENEMY_PRESET_SYSTEM/#_21","title":"\u6027\u80fd\u548c\u6700\u4f73\u5b9e\u8df5","text":""},{"location":"ENEMY_PRESET_SYSTEM/#_22","title":"\u2705 \u63a8\u8350\u505a\u6cd5","text":"<ol> <li>\u590d\u7528\u9884\u8bbe\uff1a\u4e3a\u5e38\u89c1\u654c\u4eba\u7c7b\u578b\u521b\u5efa\u9884\u8bbe\uff0c\u907f\u514d\u91cd\u590d\u4ee3\u7801</li> <li>\u7ec4\u5408\u4f18\u4e8e\u7ee7\u627f\uff1a\u4f7f\u7528\u884c\u4e3a\u9884\u8bbe\u7ec4\u5408\u800c\u975e\u6df1\u5ea6\u7ee7\u627f</li> <li>\u9884\u52a0\u8f7d\u914d\u7f6e\uff1a\u5728\u6e38\u620f\u542f\u52a8\u65f6\u52a0\u8f7d\u9884\u8bbe\u6587\u4ef6\uff0c\u800c\u975e\u6bcf\u6b21\u521b\u5efa\u654c\u4eba\u65f6\u52a0\u8f7d</li> <li>\u547d\u540d\u89c4\u8303\uff1a\u9884\u8bbeID\u4f7f\u7528 <code>snake_case</code>\uff0c\u7c7b\u540d\u4f7f\u7528 <code>PascalCase</code></li> </ol>"},{"location":"ENEMY_PRESET_SYSTEM/#_23","title":"\u274c \u907f\u514d\u505a\u6cd5","text":"<ol> <li>\u8fc7\u5ea6\u62bd\u8c61\uff1a\u4e0d\u8981\u4e3a\u6bcf\u4e2a\u7ec6\u5fae\u5dee\u522b\u90fd\u521b\u5efa\u65b0\u9884\u8bbe</li> <li>\u786c\u7f16\u7801\u914d\u7f6e\uff1a\u907f\u514d\u5728\u4ee3\u7801\u4e2d\u786c\u7f16\u7801\u654c\u4eba\u5c5e\u6027</li> <li>\u5faa\u73af\u4f9d\u8d56\uff1a\u884c\u4e3a\u9884\u8bbe\u4e0d\u5e94\u76f8\u4e92\u5f15\u7528</li> </ol>"},{"location":"ENEMY_PRESET_SYSTEM/#_24","title":"\u6269\u5c55\u548c\u81ea\u5b9a\u4e49","text":""},{"location":"ENEMY_PRESET_SYSTEM/#_25","title":"\u6dfb\u52a0\u65b0\u7684\u654c\u4eba\u9884\u8bbe","text":"<ol> <li>\u7f16\u8f91 <code>assets/configs/enemy_presets.json</code></li> <li>\u5728 <code>presets</code> \u8282\u6dfb\u52a0\u65b0\u6761\u76ee</li> <li>\u8fd0\u884c <code>python tools/enemy/list_presets.py</code> \u9a8c\u8bc1</li> </ol>"},{"location":"ENEMY_PRESET_SYSTEM/#_26","title":"\u6dfb\u52a0\u65b0\u7684\u884c\u4e3a\u9884\u8bbe","text":"<ol> <li>\u7f16\u8f91 <code>assets/configs/enemy_presets.json</code></li> <li>\u5728 <code>behavior_presets</code> \u8282\u6dfb\u52a0\u65b0\u6761\u76ee</li> <li>\u5982\u9700\u65b0\u52a8\u4f5c\u7c7b\u578b\uff0c\u5728 <code>PresetEnemy._execute_behavior_preset()</code> \u4e2d\u6dfb\u52a0\u5904\u7406\u903b\u8f91</li> </ol>"},{"location":"ENEMY_PRESET_SYSTEM/#_27","title":"\u521b\u5efa\u81ea\u5b9a\u4e49\u52a8\u4f5c","text":"<pre><code># \u5728 PresetEnemy \u7c7b\u4e2d\u6dfb\u52a0\u65b0\u65b9\u6cd5\nasync def _execute_my_custom_action(self, params: Dict[str, Any]):\n    \"\"\"\u81ea\u5b9a\u4e49\u52a8\u4f5c\"\"\"\n    # \u5b9e\u73b0\u4f60\u7684\u52a8\u4f5c\u903b\u8f91\n    pass\n\n# \u7136\u540e\u5728 _execute_behavior_preset() \u4e2d\u6ce8\u518c\nelif action == 'my_custom_action':\n    await self._execute_my_custom_action(params)\n</code></pre>"},{"location":"ENEMY_PRESET_SYSTEM/#luastg","title":"\u4e0e LuaSTG \u7684\u5bf9\u6bd4","text":"\u7279\u6027 LuaSTG \u672c\u9879\u76ee \u9884\u8bbe\u6807\u8bc6 \u6570\u5b57ID (1-18) \u5b57\u7b26\u4e32ID (\"fairy_red\") \u914d\u7f6e\u5b58\u50a8 Lua\u4ee3\u7801 JSON\u6587\u4ef6 \u884c\u4e3a\u5b9a\u4e49 \u624b\u5199\u4efb\u52a1\u51fd\u6570 \u9884\u8bbe+\u7c7b\u65b9\u6cd5 \u52a8\u6001\u521b\u5efa \u2717 \u2713 \u652f\u6301 \u7f16\u8f91\u5668\u53cb\u597d \u2717 \u2713 \u9ad8\u5ea6\u53cb\u597d \u7c7b\u578b\u5b89\u5168 \u2717 \u2713 Python\u7c7b\u578b\u63d0\u793a"},{"location":"ENEMY_PRESET_SYSTEM/#_28","title":"\u793a\u4f8b\u4ee3\u7801","text":"<p>\u5b8c\u6574\u793a\u4f8b\u8bf7\u67e5\u770b\uff1a - <code>game_content/stages/stage1/enemies/preset_examples.py</code></p>"},{"location":"ENEMY_PRESET_SYSTEM/#_29","title":"\u6545\u969c\u6392\u9664","text":""},{"location":"ENEMY_PRESET_SYSTEM/#_30","title":"\u95ee\u9898\uff1a\u627e\u4e0d\u5230\u9884\u8bbe","text":"<p>\u9519\u8bef\uff1a<code>ValueError: \u672a\u627e\u5230\u9884\u8bbe: xxx</code></p> <p>\u89e3\u51b3\uff1a 1. \u786e\u8ba4 <code>assets/configs/enemy_presets.json</code> \u5b58\u5728 2. \u8fd0\u884c <code>python tools/enemy/list_presets.py</code> \u67e5\u770b\u53ef\u7528\u9884\u8bbe 3. \u68c0\u67e5\u9884\u8bbeID\u62fc\u5199</p>"},{"location":"ENEMY_PRESET_SYSTEM/#_31","title":"\u95ee\u9898\uff1a\u884c\u4e3a\u9884\u8bbe\u4e0d\u6267\u884c","text":"<p>\u539f\u56e0\uff1a\u5b50\u7c7b\u8986\u76d6\u4e86 <code>run()</code> \u65b9\u6cd5</p> <p>\u89e3\u51b3\uff1a</p> <pre><code># \u9519\u8bef \u274c\nclass MyEnemy(PresetEnemy):\n    preset_id = \"fairy_red\"\n    behavior_preset = \"rush_in_shoot_leave\"\n\n    async def run(self):  # \u8fd9\u4f1a\u8986\u76d6\u9ed8\u8ba4\u884c\u4e3a\uff01\n        pass\n\n# \u6b63\u786e \u2705\nclass MyEnemy(PresetEnemy):\n    preset_id = \"fairy_red\"\n    behavior_preset = \"rush_in_shoot_leave\"\n    # \u4e0d\u8981\u8986\u76d6 run()\uff0c\u8ba9\u57fa\u7c7b\u5904\u7406\n</code></pre>"},{"location":"STAGE_SCRIPTING_GUIDE/","title":"pystg \u5173\u5361\u811a\u672c\u7f16\u5199\u6307\u5357","text":"<p>\u672c\u6587\u6863\u9762\u5411\u5173\u5361\u5185\u5bb9\u521b\u4f5c\u8005\u2014\u2014\u53ea\u9700\u8981\u5173\u5fc3\u5f39\u5e55/\u654c\u4eba/Boss \u7684\u8bbe\u8ba1\uff0c\u4e0d\u9700\u8981\u4e86\u89e3\u5f15\u64ce\u5185\u90e8\u3002</p>"},{"location":"STAGE_SCRIPTING_GUIDE/#_1","title":"\u76ee\u5f55","text":"<ol> <li>\u67b6\u6784\u6982\u89c8</li> <li>\u76ee\u5f55\u7ed3\u6784\u89c4\u8303</li> <li>\u5feb\u901f\u5f00\u59cb\uff1a5 \u5206\u949f\u5199\u51fa\u4f60\u7684\u7b2c\u4e00\u4e2a\u7b26\u5361</li> <li>\u6838\u5fc3\u6982\u5ff5</li> <li>\u7f16\u5199\u7b26\u5361\uff08SpellCard\uff09</li> <li>\u7f16\u5199\u6ce2\u6b21\uff08Wave\uff09</li> <li>\u7f16\u5199\u654c\u4eba\u811a\u672c\uff08EnemyScript\uff09</li> <li>\u7f16\u5199 Boss \u914d\u7f6e</li> <li>\u7f16\u5199\u5173\u5361\u914d\u7f6e\uff08stage.json\uff09</li> <li>\u5f39\u5e55 API \u53c2\u8003</li> <li>\u5750\u6807\u7cfb\u7edf</li> <li>\u5b8c\u6574\u793a\u4f8b\uff1aStage 1 \u9010\u6587\u4ef6\u89e3\u6790</li> <li>\u5e38\u89c1\u95ee\u9898</li> <li>\u4ece\u96f6\u521b\u5efa\u4e00\u4e2a\u65b0\u5173\u5361</li> <li>\u97f3\u9891\u7cfb\u7edf</li> </ol>"},{"location":"STAGE_SCRIPTING_GUIDE/#1","title":"1. \u67b6\u6784\u6982\u89c8","text":"<p>pystg \u7684\u5173\u5361\u7cfb\u7edf\u91c7\u7528\u5f15\u64ce\u5c42 / \u5185\u5bb9\u5c42\u5206\u79bb\u7684\u8bbe\u8ba1\uff1a</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                    \u5f15\u64ce\u5c42 (src/)                   \u2502\n\u2502  \u63d0\u4f9b\u80fd\u529b\uff0c\u4e0d\u5173\u5fc3\u5177\u4f53\u5173\u5361\u5185\u5bb9                        \u2502\n\u2502                                                    \u2502\n\u2502  Bullet\uff08\u5b50\u5f39\u6c60\uff09  Player\uff08\u73a9\u5bb6\uff09  Renderer\uff08\u6e32\u67d3\uff09  \u2502\n\u2502  Boss \u57fa\u7c7b        Enemy \u57fa\u7c7b     SpellCard \u57fa\u7c7b    \u2502\n\u2502  Wave \u57fa\u7c7b        Stage \u57fa\u7c7b     Coroutine\uff08\u534f\u7a0b\uff09  \u2502\n\u2502  StageContext\uff08\u4e0a\u4e0b\u6587\u6865\u6881\uff09                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                      \u2502 StageContext\n                      \u2502 \uff08\u5f15\u64ce\u5411\u5185\u5bb9\u63d0\u4f9b\u7684\u7edf\u4e00\u63a5\u53e3\uff09\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502              \u5185\u5bb9\u5c42 (game_content/)                \u2502\n\u2502  \u53ea\u63cf\u8ff0\"\u53d1\u751f\u4ec0\u4e48\"\uff0c\u4e0d\u5173\u5fc3\"\u600e\u4e48\u5b9e\u73b0\"                   \u2502\n\u2502                                                    \u2502\n\u2502  \u6ce2\u6b21\u811a\u672c    \u654c\u4eba\u5b9a\u4e49    Boss\u914d\u7f6e    \u7b26\u5361\u811a\u672c        \u2502\n\u2502  \u5bf9\u8bdd\u5185\u5bb9    \u65f6\u95f4\u7ebf      \u8d44\u6e90\u5f15\u7528                    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"STAGE_SCRIPTING_GUIDE/#_2","title":"\u6838\u5fc3\u539f\u5219","text":"\u89c4\u5219 \u8bf4\u660e \u2705 \u5185\u5bb9\u5c42\u53ea\u7528\u57fa\u7c7b API <code>self.fire()</code>, <code>self.wait()</code>, <code>self.move_to()</code> \u2705 \u5185\u5bb9\u5c42\u901a\u8fc7 <code>ctx</code> \u4e0e\u5f15\u64ce\u4ea4\u4e92 <code>ctx.create_bullet()</code>, <code>ctx.get_player()</code> \u274c \u5185\u5bb9\u5c42\u4e0d\u80fd import \u5f15\u64ce\u6a21\u5757 \u4e0d\u80fd\u51fa\u73b0 <code>from src.game.bullet import BulletPool</code> \u274c \u5185\u5bb9\u5c42\u4e0d\u5904\u7406\u6e32\u67d3/\u78b0\u649e/\u7269\u7406 \u8fd9\u4e9b\u662f\u5f15\u64ce\u7684\u4e8b <p>\u4f60\u9700\u8981 import \u7684\u53ea\u6709\u57fa\u7c7b\uff1a</p> <pre><code>from src.game.stage.spellcard import SpellCard, NonSpell   # \u7b26\u5361\nfrom src.game.stage.wave_base import Wave                   # \u6ce2\u6b21\nfrom src.game.stage.enemy_script import EnemyScript         # \u654c\u4eba\u811a\u672c\n</code></pre>"},{"location":"STAGE_SCRIPTING_GUIDE/#2","title":"2. \u76ee\u5f55\u7ed3\u6784\u89c4\u8303","text":"<p>\u6bcf\u4e2a\u5173\u5361\u662f <code>game_content/stages/</code> \u4e0b\u7684\u4e00\u4e2a\u6587\u4ef6\u5939\uff1a</p> <pre><code>game_content/stages/\n\u251c\u2500\u2500 stage1/                      \u2190 \u5173\u5361 1\n\u2502   \u251c\u2500\u2500 __init__.py              \u2190 \u5173\u5361\u5143\u4fe1\u606f\n\u2502   \u251c\u2500\u2500 stage.json               \u2190 \u65f6\u95f4\u7ebf\uff08\u5b9a\u4e49\u5173\u5361\u6d41\u7a0b\uff09\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 waves/                   \u2190 \u9053\u4e2d\u6ce2\u6b21\u811a\u672c\n\u2502   \u2502   \u251c\u2500\u2500 opening_wave.py      \u2190 \u5f00\u573a\u6ce2\u6b21\n\u2502   \u2502   \u251c\u2500\u2500 fairy_wave.py        \u2190 \u5996\u7cbe\u7f16\u961f\n\u2502   \u2502   \u2514\u2500\u2500 post_midboss_wave.py \u2190 \u9053\u4e2dBoss\u540e\u6536\u5c3e\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 bosses/                  \u2190 Boss \u914d\u7f6e\n\u2502   \u2502   \u251c\u2500\u2500 midboss.json         \u2190 \u9053\u4e2dBoss\u7684\u7b26\u5361\u5e8f\u5217\n\u2502   \u2502   \u2514\u2500\u2500 boss.json            \u2190 \u5173\u5e95Boss\u7684\u7b26\u5361\u5e8f\u5217\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 spellcards/              \u2190 \u7b26\u5361\u811a\u672c\uff08Boss \u7684\u653b\u51fb\u6a21\u5f0f\uff09\n\u2502   \u2502   \u251c\u2500\u2500 nonspell_1.py        \u2190 \u7b2c1\u6bb5\u975e\u7b26\n\u2502   \u2502   \u251c\u2500\u2500 spell_1.py           \u2190 \u6708\u7b26\u300cMoonlight Ray\u300d\n\u2502   \u2502   \u2514\u2500\u2500 spell_2.py           \u2190 \u591c\u7b26\u300cNight Bird\u300d\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 enemies/                 \u2190 \u53ef\u590d\u7528\u7684\u654c\u4eba\u811a\u672c\n\u2502   \u2502   \u2514\u2500\u2500 fairy.py             \u2190 \u7ea2/\u84dd\u5996\u7cbe\n\u2502   \u2502\n\u2502   \u251c\u2500\u2500 dialogue/                \u2190 \u5bf9\u8bdd\u811a\u672c\n\u2502   \u2502   \u2514\u2500\u2500 pre_boss.py          \u2190 Boss\u524d\u5bf9\u8bdd\n\u2502   \u2502\n\u2502   \u2514\u2500\u2500 audio/                   \u2190 \u5173\u5361\u79c1\u6709\u97f3\u9891\uff08\u53ef\u9009\uff09\n\u2502       \u251c\u2500\u2500 se/                  \u2190 \u5173\u5361\u4e13\u5c5e\u97f3\u6548\n\u2502       \u2514\u2500\u2500 music/               \u2190 \u5173\u5361\u4e13\u5c5e BGM\n\u2502\n\u251c\u2500\u2500 stage2/                      \u2190 \u5173\u5361 2\uff08\u540c\u6837\u7ed3\u6784\uff09\n\u2502   \u251c\u2500\u2500 stage.json\n\u2502   \u251c\u2500\u2500 waves/\n\u2502   \u251c\u2500\u2500 bosses/\n\u2502   \u251c\u2500\u2500 spellcards/\n\u2502   \u251c\u2500\u2500 enemies/\n\u2502   \u2514\u2500\u2500 dialogue/\n\u2502\n\u2514\u2500\u2500 stage3/                      \u2190 \u5173\u5361 3\n    \u2514\u2500\u2500 ...\n</code></pre> <p>\u5173\u952e\u89c4\u5219\uff1a<code>game_content/</code> \u4e0b\u7684\u6587\u4ef6\u4e0d\u80fd\u51fa\u73b0\u5f15\u64ce\u903b\u8f91\uff01 \u53ea\u5141\u8bb8\u51fa\u73b0\uff1a\u5f39\u5e55\u5b9a\u4e49\u3001\u654c\u4eba\u884c\u4e3a\u3001Boss\u914d\u7f6e\u3001\u65f6\u95f4\u7ebf\u3001\u5bf9\u8bdd\u3001\u97f3\u9891\u8d44\u6e90\u3001\u8d44\u6e90\u5f15\u7528\u3002</p>"},{"location":"STAGE_SCRIPTING_GUIDE/#3-5","title":"3. \u5feb\u901f\u5f00\u59cb\uff1a5 \u5206\u949f\u5199\u51fa\u4f60\u7684\u7b2c\u4e00\u4e2a\u7b26\u5361","text":""},{"location":"STAGE_SCRIPTING_GUIDE/#1_1","title":"\u7b2c 1 \u6b65\uff1a\u521b\u5efa\u7b26\u5361\u811a\u672c","text":"<p>\u5728 <code>game_content/stages/stage1/spellcards/</code> \u4e0b\u65b0\u5efa <code>my_spell.py</code>\uff1a</p> <pre><code>\"\"\"\u6211\u7684\u7b2c\u4e00\u4e2a\u7b26\u5361\"\"\"\nfrom src.game.stage.spellcard import SpellCard\n\n\nclass MySpell(SpellCard):\n    name = \"\u706b\u7b26\u300cMy First Spell\u300d\"\n    hp = 1000\n    time_limit = 45\n    bonus = 500000\n\n    async def setup(self):\n        \"\"\"Boss \u79fb\u52a8\u5230\u4e0a\u65b9\u4e2d\u592e\"\"\"\n        await self.boss.move_to(0, 0.5, duration=30)\n\n    async def run(self):\n        \"\"\"\u5f39\u5e55\u903b\u8f91\"\"\"\n        angle = 0\n        while True:\n            # \u53d1\u5c04 12-way \u7ea2\u8272\u5706\u5f39\n            self.fire_circle(\n                count=12,\n                speed=2.0,\n                start_angle=angle,\n                bullet_type=\"ball_m\",\n                color=\"red\"\n            )\n            angle += 10  # \u6bcf\u6b21\u65cb\u8f6c\n\n            await self.wait(15)  # \u7b49 15 \u5e27\uff080.25\u79d2\uff09\n\n\n# \u5fc5\u987b\u6ce8\u518c\uff01\nspellcard = MySpell\n</code></pre>"},{"location":"STAGE_SCRIPTING_GUIDE/#2-boss","title":"\u7b2c 2 \u6b65\uff1a\u5728 Boss \u914d\u7f6e\u4e2d\u5f15\u7528","text":"<p>\u7f16\u8f91 <code>bosses/boss.json</code>\uff0c\u5728 <code>phases</code> \u6570\u7ec4\u4e2d\u6dfb\u52a0\uff1a</p> <pre><code>{\n    \"type\": \"spellcard\",\n    \"hp\": 1000,\n    \"time\": 45,\n    \"script\": \"my_spell\",\n    \"name\": \"\u706b\u7b26\u300cMy First Spell\u300d\",\n    \"bonus\": 500000,\n    \"practice_unlock\": true\n}\n</code></pre>"},{"location":"STAGE_SCRIPTING_GUIDE/#3","title":"\u7b2c 3 \u6b65\uff1a\u8fd0\u884c\u6e38\u620f\u770b\u6548\u679c","text":"<p>\u5c31\u8fd9\u4e48\u7b80\u5355\u3002\u4e0d\u9700\u8981\u6539\u5f15\u64ce\u4ee3\u7801\uff0c\u4e0d\u9700\u8981\u6ce8\u518c\u4efb\u4f55\u4e1c\u897f\u3002 <code>boss.json</code> \u91cc\u7684 <code>script</code> \u5b57\u6bb5\u4f1a\u81ea\u52a8\u52a0\u8f7d\u5bf9\u5e94\u7684 Python \u6587\u4ef6\u3002</p>"},{"location":"STAGE_SCRIPTING_GUIDE/#4","title":"4. \u6838\u5fc3\u6982\u5ff5","text":""},{"location":"STAGE_SCRIPTING_GUIDE/#41-coroutine","title":"4.1 \u534f\u7a0b\uff08Coroutine\uff09\u2014\u2014\u5f39\u5e55\u7684\"\u65f6\u95f4\u63a7\u5236\u5668\"","text":"<p>pystg \u4f7f\u7528 Python \u7684 <code>async/await</code> \u8bed\u6cd5\u6765\u63a7\u5236\u5f39\u5e55\u7684\u65f6\u95f4\u8282\u594f\u3002\u6bcf\u4e00\u5e27\u6e38\u620f\u4f1a\u63a8\u8fdb\u4f60\u7684\u534f\u7a0b\u4e00\u6b65\u3002</p> <pre><code>async def run(self):\n    # \u8fd9\u884c\u5728\u7b2c 1 \u5e27\u6267\u884c\n    self.fire_circle(count=8, speed=2.0)\n\n    # \u6682\u505c 30 \u5e27\uff080.5\u79d2\uff09\uff0c\u7136\u540e\u7ee7\u7eed\n    await self.wait(30)\n\n    # \u8fd9\u884c\u5728\u7b2c 31 \u5e27\u6267\u884c\n    self.fire_circle(count=16, speed=3.0)\n</code></pre> <p><code>await self.wait(N)</code> = \u6682\u505c N \u5e27\u300260\u5e27 = 1\u79d2\u3002</p>"},{"location":"STAGE_SCRIPTING_GUIDE/#42-spellcardboss","title":"4.2 SpellCard\uff08\u7b26\u5361\uff09\u2014\u2014Boss \u7684\u653b\u51fb\u6a21\u5f0f","text":"<p>\u4e00\u4e2a\u7b26\u5361\u5c31\u662f Boss \u7684\u4e00\u6bb5\u653b\u51fb\u3002\u5b83\u6709\uff1a - HP\uff1a\u88ab\u6253\u591a\u5c11\u4e0b\u7ed3\u675f - \u65f6\u95f4\u9650\u5236\uff1a\u8d85\u65f6\u81ea\u52a8\u7ed3\u675f - bonus\uff1a\u6ee1\u8840\u51fb\u7834\u7684\u5956\u52b1\u5206\u6570</p> <pre><code>class MySpell(SpellCard):\n    name = \"\u7b26\u5361\u540d\"     # \u7b26\u5361\u5ba3\u8a00\u65f6\u663e\u793a\n    hp = 1200           # Boss \u5728\u8fd9\u6bb5\u7684 HP\n    time_limit = 60     # 60\u79d2\u65f6\u95f4\u9650\u5236\n    bonus = 1000000     # \u51fb\u7834\u5956\u52b1\n</code></pre>"},{"location":"STAGE_SCRIPTING_GUIDE/#43-nonspellboss","title":"4.3 NonSpell\uff08\u975e\u7b26\uff09\u2014\u2014Boss \u7684\u666e\u901a\u653b\u51fb","text":"<p>\u548c\u7b26\u5361\u7c7b\u4f3c\uff0c\u4f46\uff1a - \u6ca1\u6709\u540d\u5b57\u663e\u793a - \u5956\u52b1\u8f83\u5c11 - \u9ed8\u8ba4\u4e0d\u80fd\u5728\u7ec3\u4e60\u6a21\u5f0f\u5355\u72ec\u7ec3</p> <pre><code>from src.game.stage.spellcard import NonSpell\n\nclass MyNonSpell(NonSpell):\n    hp = 800\n    time_limit = 30\n\n    async def run(self):\n        ...\n</code></pre>"},{"location":"STAGE_SCRIPTING_GUIDE/#44-wave","title":"4.4 Wave\uff08\u6ce2\u6b21\uff09\u2014\u2014\u9053\u4e2d\u5f39\u5e55","text":"<p>\u4e0d\u7ed1\u5b9a Boss \u7684\u5f39\u5e55\u811a\u672c\uff0c\u7528\u4e8e\u9053\u4e2d\u5c0f\u602a\u9636\u6bb5\u3002</p> <pre><code>from src.game.stage.wave_base import Wave\n\nclass MyWave(Wave):\n    async def run(self):\n        for i in range(8):\n            self.fire(x=-0.7 + i*0.2, y=0.9, angle=-90, speed=2.0)\n        await self.wait(60)\n</code></pre>"},{"location":"STAGE_SCRIPTING_GUIDE/#45-enemyscript","title":"4.5 EnemyScript\uff08\u654c\u4eba\u811a\u672c\uff09\u2014\u2014\u53ef\u590d\u7528\u7684\u5c0f\u602a\u884c\u4e3a","text":"<p>\u5b9a\u4e49\u4e00\u4e2a\u654c\u4eba\u4ece\u51fa\u751f\u5230\u6d88\u5931\u7684\u5b8c\u6574\u884c\u4e3a\u3002</p> <pre><code>from src.game.stage.enemy_script import EnemyScript\n\nclass RedFairy(EnemyScript):\n    hp = 30\n    score = 100\n\n    async def run(self):\n        await self.move_to(self.x, 0.3, duration=60)\n        self.fire_circle(count=8, speed=2.0, color=\"red\")\n        await self.wait(30)\n        await self.move_to(self.x, -0.2, duration=60)\n</code></pre>"},{"location":"STAGE_SCRIPTING_GUIDE/#5-spellcard","title":"5. \u7f16\u5199\u7b26\u5361\uff08SpellCard\uff09","text":""},{"location":"STAGE_SCRIPTING_GUIDE/#51","title":"5.1 \u57fa\u672c\u6a21\u677f","text":"<pre><code>\"\"\"\n\u7b26\u5361\u540d\u300c\u82f1\u6587\u540d\u300d\n\n[\u8bbe\u8ba1\u601d\u8def\u7b80\u8ff0]\n\"\"\"\nfrom src.game.stage.spellcard import SpellCard\n\n\nclass MySpellCard(SpellCard):\n    # ===== \u5143\u4fe1\u606f =====\n    name = \"\u7b26\u5361\u540d\u300cEnglish Name\u300d\"\n    hp = 1200\n    time_limit = 60        # \u79d2\n    bonus = 1000000\n\n    # ===== \u521d\u59cb\u5316 =====\n    async def setup(self):\n        \"\"\"\u7b26\u5361\u5f00\u59cb\u524d\u7684\u51c6\u5907\uff08\u53ef\u9009\uff09\"\"\"\n        await self.boss.move_to(0, 0.5, duration=60)\n\n    # ===== \u4e3b\u903b\u8f91 =====\n    async def run(self):\n        \"\"\"\u5f39\u5e55\u4e3b\u5faa\u73af\"\"\"\n        while True:\n            # \u53d1\u5f39\n            self.fire_circle(count=20, speed=2.5, color=\"blue\")\n            # \u7b49\u5f85\n            await self.wait(30)\n\n\n# \u6ce8\u518c\nspellcard = MySpellCard\n</code></pre>"},{"location":"STAGE_SCRIPTING_GUIDE/#52-run-api","title":"5.2 \u5728 <code>run()</code> \u4e2d\u53ef\u7528\u7684 API","text":""},{"location":"STAGE_SCRIPTING_GUIDE/#_3","title":"\u53d1\u5f39","text":"\u65b9\u6cd5 \u8bf4\u660e \u793a\u4f8b <code>self.fire(...)</code> \u53d1\u5c04\u5355\u53d1\u5b50\u5f39 <code>self.fire(angle=90, speed=2.0, color=\"red\")</code> <code>self.fire_circle(...)</code> \u53d1\u5c04\u5706\u5f62\u5f39\u5e55 <code>self.fire_circle(count=20, speed=2.5)</code> <code>self.fire_arc(...)</code> \u53d1\u5c04\u6247\u5f62\u5f39\u5e55 <code>self.fire_arc(count=5, center_angle=-90, arc_angle=60)</code> <code>self.fire_at_player(...)</code> \u53d1\u5c04\u81ea\u673a\u72d9 <code>self.fire_at_player(speed=3.0)</code> <code>self.clear_bullets()</code> \u6e05\u9664\u6b64\u7b26\u5361\u7684\u6240\u6709\u5b50\u5f39 <code>self.clear_bullets(to_items=True)</code>"},{"location":"STAGE_SCRIPTING_GUIDE/#_4","title":"\u65f6\u95f4\u63a7\u5236","text":"\u65b9\u6cd5 \u8bf4\u660e \u793a\u4f8b <code>await self.wait(frames)</code> \u7b49\u5f85 N \u5e27 <code>await self.wait(30)</code> <code>await self.wait_seconds(sec)</code> \u7b49\u5f85 N \u79d2 <code>await self.wait_seconds(1.5)</code> <code>await self.wait_until(cond)</code> \u7b49\u5f85\u6761\u4ef6\u6ee1\u8db3 <code>await self.wait_until(lambda: self.time &gt; 300)</code> <code>self.time</code> \u5f53\u524d\u5e27\u6570 <code>if self.time % 60 == 0:</code> <code>self.time_seconds</code> \u5f53\u524d\u79d2\u6570 <code>if self.time_seconds &gt; 15:</code> <code>self.time_remaining</code> \u5269\u4f59\u79d2\u6570 <code>if self.time_remaining &lt; 10:</code>"},{"location":"STAGE_SCRIPTING_GUIDE/#boss","title":"Boss \u64cd\u4f5c","text":"\u65b9\u6cd5 \u8bf4\u660e \u793a\u4f8b <code>self.boss.x</code>, <code>self.boss.y</code> Boss \u5f53\u524d\u4f4d\u7f6e <code>x = self.boss.x</code> <code>await self.boss.move_to(x, y, duration)</code> \u5e73\u6ed1\u79fb\u52a8 Boss <code>await self.boss.move_to(0.3, 0.5, 60)</code> <code>self.boss.move_to_instant(x, y)</code> \u77ac\u79fb Boss <code>self.boss.move_to_instant(0, 0.5)</code>"},{"location":"STAGE_SCRIPTING_GUIDE/#_5","title":"\u97f3\u6548","text":"\u65b9\u6cd5 \u8bf4\u660e <code>self.play_se(name)</code> \u64ad\u653e\u97f3\u6548\uff08Stage\u79c1\u6709\u4f18\u5148\uff0cfallback\u5168\u5c40\uff09 <code>self.play_se(name, volume=0.5)</code> \u6307\u5b9a\u97f3\u91cf\u64ad\u653e\u97f3\u6548"},{"location":"STAGE_SCRIPTING_GUIDE/#_6","title":"\u8f85\u52a9","text":"\u65b9\u6cd5 \u8bf4\u660e <code>self.angle_to_player()</code> \u8ba1\u7b97\u5230\u73a9\u5bb6\u7684\u89d2\u5ea6\uff08\u5ea6\uff09 <code>self.ctx.get_player()</code> \u83b7\u53d6\u73a9\u5bb6\u4f4d\u7f6e\uff08<code>.x</code>, <code>.y</code>\uff09"},{"location":"STAGE_SCRIPTING_GUIDE/#53","title":"5.3 \u5f39\u5e55\u8bbe\u8ba1\u6280\u5de7","text":""},{"location":"STAGE_SCRIPTING_GUIDE/#_7","title":"\u5206\u9636\u6bb5\u96be\u5ea6\u9012\u589e","text":"<pre><code>async def run(self):\n    angle = 0\n    while True:\n        # \u57fa\u7840\u5f39\u5e55\n        self.fire_circle(count=16, speed=2.0, start_angle=angle, color=\"blue\")\n\n        # 15\u79d2\u540e\u589e\u52a0\u81ea\u673a\u72d9\n        if self.time_seconds &gt; 15:\n            self.fire_at_player(speed=3.0, color=\"red\")\n\n        # 30\u79d2\u540e\u589e\u52a0\u87ba\u65cb\u81c2\n        if self.time_seconds &gt; 30:\n            for arm in range(4):\n                self.fire(angle=angle + arm * 90, speed=1.5, color=\"purple\")\n\n        angle += 7\n        await self.wait(10)\n</code></pre>"},{"location":"STAGE_SCRIPTING_GUIDE/#boss_1","title":"Boss \u8fb9\u79fb\u52a8\u8fb9\u53d1\u5f39","text":"<pre><code>async def run(self):\n    while True:\n        # \u968f\u673a\u76ee\u6807\u4f4d\u7f6e\n        target_x = random.uniform(-0.5, 0.5)\n        target_y = random.uniform(0.3, 0.7)\n\n        # \u540c\u65f6\u79fb\u52a8\u548c\u53d1\u5f39\n        move_gen = self.boss.move_to(target_x, target_y, duration=90)\n        for _ in range(90):\n            try:\n                next(move_gen)  # \u63a8\u8fdb\u79fb\u52a8\n            except StopIteration:\n                pass\n\n            # \u6bcf 6 \u5e27\u53d1\u4e00\u8f6e\n            if self.time % 6 == 0:\n                self.fire_at_player(speed=2.5, color=\"red\")\n\n            yield  # \u2190 \u6ce8\u610f\uff1a\u5e76\u884c\u64cd\u4f5c\u65f6\u7528 yield \u800c\u4e0d\u662f await\n\n        await self.wait(30)\n</code></pre>"},{"location":"STAGE_SCRIPTING_GUIDE/#_8","title":"\u62bd\u53d6\u8f85\u52a9\u65b9\u6cd5","text":"<pre><code>class MySpell(SpellCard):\n    async def run(self):\n        while True:\n            await self._wave_attack()\n            await self.wait(30)\n            await self._spiral_attack()\n            await self.wait(30)\n\n    async def _wave_attack(self):\n        \"\"\"\u6ce2\u6d6a\u653b\u51fb\"\"\"\n        for wave in range(5):\n            self.fire_circle(\n                count=20 + wave * 4,\n                speed=1.5 + wave * 0.2,\n                start_angle=wave * 7,\n                color=\"blue\"\n            )\n            await self.wait(6)\n\n    async def _spiral_attack(self):\n        \"\"\"\u87ba\u65cb\u653b\u51fb\"\"\"\n        for step in range(60):\n            for arm in range(3):\n                self.fire(\n                    angle=step * 13 + arm * 120,\n                    speed=2.0,\n                    color=\"purple\"\n                )\n            await self.wait(2)\n</code></pre>"},{"location":"STAGE_SCRIPTING_GUIDE/#6-wave","title":"6. \u7f16\u5199\u6ce2\u6b21\uff08Wave\uff09","text":""},{"location":"STAGE_SCRIPTING_GUIDE/#61","title":"6.1 \u57fa\u672c\u6a21\u677f","text":"<pre><code>\"\"\"\n\u6ce2\u6b21\u63cf\u8ff0\n\"\"\"\nfrom src.game.stage.wave_base import Wave\n\n\nclass MyWave(Wave):\n    async def run(self):\n        # 3\u6ce2\u5f39\u5e55\n        for wave_num in range(3):\n            for i in range(8):\n                x = -0.7 + i * 0.2\n                self.fire(\n                    x=x, y=0.9,\n                    angle=-90, speed=1.8,\n                    bullet_type=\"rice\", color=\"blue\"\n                )\n            await self.wait(30)\n\n        # \u7b49\u5f85\u5b50\u5f39\u98de\u51fa\n        await self.wait(60)\n\n\n# \u6ce8\u518c\nwave = MyWave\n</code></pre>"},{"location":"STAGE_SCRIPTING_GUIDE/#62-wave-api","title":"6.2 Wave \u53ef\u7528 API","text":"<p>\u548c SpellCard \u7c7b\u4f3c\uff0c\u4f46\u6ca1\u6709 <code>self.boss</code>\uff1a</p> \u65b9\u6cd5 \u8bf4\u660e <code>self.fire(x, y, angle, speed, ...)</code> \u53d1\u5c04\uff08\u5fc5\u987b\u6307\u5b9a x, y\uff09 <code>self.fire_circle(x, y, count, ...)</code> \u5706\u5f62\u5f39\u5e55 <code>self.fire_arc(x, y, count, ...)</code> \u6247\u5f62\u5f39\u5e55 <code>self.fire_at_player(x, y, speed, ...)</code> \u81ea\u673a\u72d9 <code>await self.wait(frames)</code> \u7b49\u5f85 <code>self.play_se(name)</code> \u64ad\u653e\u97f3\u6548 <code>self.time</code> / <code>self.time_seconds</code> \u5f53\u524d\u65f6\u95f4"},{"location":"STAGE_SCRIPTING_GUIDE/#63","title":"6.3 \u517c\u5bb9\u65e7\u7248\u51fd\u6570\u98ce\u683c","text":"<p>\u5982\u679c\u4f60\u89c9\u5f97\u7c7b\u592a\u91cd\uff0c\u4e5f\u53ef\u4ee5\u7528\u51fd\u6570\u98ce\u683c\uff08\u4f46\u4e0d\u63a8\u8350\u7528\u4e8e\u590d\u6742\u6ce2\u6b21\uff09\uff1a</p> <pre><code>def run(ctx):\n    \"\"\"\u65e7\u7248\u51fd\u6570\u98ce\u683c\uff0c\u76f4\u63a5\u64cd\u4f5c ctx\"\"\"\n    for i in range(8):\n        ctx.create_bullet(x=-0.7 + i*0.2, y=0.9, angle=-90, speed=1.8,\n                          bullet_type=\"rice\", color=\"blue\")\n    for _ in range(60):\n        yield\n</code></pre>"},{"location":"STAGE_SCRIPTING_GUIDE/#7-enemyscript","title":"7. \u7f16\u5199\u654c\u4eba\u811a\u672c\uff08EnemyScript\uff09","text":""},{"location":"STAGE_SCRIPTING_GUIDE/#71","title":"7.1 \u57fa\u672c\u6a21\u677f","text":"<pre><code>\"\"\"\n\u7ea2\u8272\u5996\u7cbe - \u98de\u5165 \u2192 \u5c04\u5f39 \u2192 \u98de\u8d70\n\"\"\"\nfrom src.game.stage.enemy_script import EnemyScript\n\n\nclass RedFairy(EnemyScript):\n    hp = 30\n    sprite = \"enemy_fairy_red\"\n    score = 100\n\n    async def run(self):\n        # \u98de\u5230 y=0.3\n        await self.move_to(self.x, 0.3, duration=60)\n\n        # \u53d1\u5c04 3 \u8f6e 8-way \u5f39\u5e55\n        for _ in range(3):\n            self.fire_circle(count=8, speed=2.0, color=\"red\")\n            await self.wait(20)\n\n        # \u98de\u51fa\u5c4f\u5e55\n        await self.move_to(self.x, -0.2, duration=60)\n</code></pre>"},{"location":"STAGE_SCRIPTING_GUIDE/#72-enemyscript-api","title":"7.2 EnemyScript \u53ef\u7528 API","text":""},{"location":"STAGE_SCRIPTING_GUIDE/#_9","title":"\u79fb\u52a8","text":"\u65b9\u6cd5 \u8bf4\u660e <code>await self.move_to(x, y, duration)</code> \u5e73\u6ed1\u79fb\u52a8\uff08smoothstep\uff09 <code>await self.move_linear(dx, dy, duration)</code> \u5300\u901f\u76f4\u7ebf\u79fb\u52a8 <code>self.set_position(x, y)</code> \u77ac\u79fb <code>self.x</code>, <code>self.y</code> \u5f53\u524d\u4f4d\u7f6e"},{"location":"STAGE_SCRIPTING_GUIDE/#_10","title":"\u53d1\u5f39","text":"<p>\u548c SpellCard \u5b8c\u5168\u76f8\u540c\uff1a<code>self.fire()</code>, <code>self.fire_circle()</code>, <code>self.fire_at_player()</code> \u7b49\u3002 \u9ed8\u8ba4\u4ece\u81ea\u8eab\u4f4d\u7f6e\u53d1\u5c04\u3002</p>"},{"location":"STAGE_SCRIPTING_GUIDE/#8-boss","title":"8. \u7f16\u5199 Boss \u914d\u7f6e","text":"<p>Boss \u7528 JSON \u914d\u7f6e\uff0c\u5b9a\u4e49\u5176\u7b26\u5361\u5e8f\u5217\uff1a</p> <pre><code>{\n  \"id\": \"rumia_boss\",\n  \"name\": \"\u30eb\u30fc\u30df\u30a2\",\n  \"texture\": \"enemy_rumia\",\n  \"animations\": {},\n\n  \"phases\": [\n    {\n      \"type\": \"nonspell\",\n      \"hp\": 800,\n      \"time\": 30,\n      \"script\": \"nonspell_1\",\n      \"bonus\": 100000,\n      \"comment\": \"\u7b2c1\u6bb5\u975e\u7b26\"\n    },\n    {\n      \"type\": \"spellcard\",\n      \"hp\": 1200,\n      \"time\": 60,\n      \"script\": \"spell_1\",\n      \"name\": \"\u6708\u7b26\u300cMoonlight Ray\u300d\",\n      \"bonus\": 1000000,\n      \"practice_unlock\": true,\n      \"comment\": \"\u7b2c1\u5f20\u7b26\u5361\"\n    }\n  ]\n}\n</code></pre>"},{"location":"STAGE_SCRIPTING_GUIDE/#_11","title":"\u5b57\u6bb5\u8bf4\u660e","text":"\u5b57\u6bb5 \u7c7b\u578b \u8bf4\u660e <code>type</code> <code>\"nonspell\"</code> / <code>\"spellcard\"</code> \u975e\u7b26 / \u7b26\u5361 <code>hp</code> int \u6b64\u9636\u6bb5 Boss \u7684 HP <code>time</code> int \u65f6\u95f4\u9650\u5236\uff08\u79d2\uff09 <code>script</code> string \u811a\u672c\u6587\u4ef6\u540d\uff08\u4e0d\u542b <code>.py</code>\uff0c\u5728 <code>spellcards/</code> \u76ee\u5f55\u4e0b\u627e\uff09 <code>name</code> string \u7b26\u5361\u540d\u79f0\uff08\u7b26\u5361\u5ba3\u8a00\u65f6\u663e\u793a\uff09 <code>bonus</code> int \u6ee1\u8840\u51fb\u7834\u5956\u52b1 <code>practice_unlock</code> bool \u662f\u5426\u53ef\u5728\u7ec3\u4e60\u6a21\u5f0f\u9009\u62e9"},{"location":"STAGE_SCRIPTING_GUIDE/#9-stagejson","title":"9. \u7f16\u5199\u5173\u5361\u914d\u7f6e\uff08stage.json\uff09","text":"<p><code>stage.json</code> \u5b9a\u4e49\u5173\u5361\u7684\u65f6\u95f4\u7ebf\u2014\u2014\u6309\u987a\u5e8f\u6267\u884c\u5404\u6bb5\u843d\uff1a</p> <pre><code>{\n  \"id\": \"stage1\",\n  \"name\": \"Stage 1\",\n  \"title\": \"\u8d64\u3088\u308a\u7d05\u3044\u5922\",\n  \"subtitle\": \"A Dream More Scarlet than Red\",\n\n  \"bgm\": \"stage1.ogg\",\n  \"boss_bgm\": \"boss1.ogg\",\n  \"background\": \"stage1_bg\",\n\n  \"sections\": [\n    { \"type\": \"wave\",     \"script\": \"waves/opening_wave\"      },\n    { \"type\": \"wait\",     \"duration\": 120                      },\n    { \"type\": \"wave\",     \"script\": \"waves/fairy_wave\"         },\n    { \"type\": \"wait\",     \"duration\": 60                       },\n    { \"type\": \"midboss\",  \"boss\": \"bosses/midboss\"             },\n    { \"type\": \"wave\",     \"script\": \"waves/post_midboss_wave\"  },\n    { \"type\": \"dialogue\", \"script\": \"dialogue/pre_boss\"        },\n    { \"type\": \"boss\",     \"boss\": \"bosses/boss\"                }\n  ]\n}\n</code></pre>"},{"location":"STAGE_SCRIPTING_GUIDE/#section","title":"Section \u7c7b\u578b","text":"type \u8bf4\u660e \u91cd\u8981\u5b57\u6bb5 <code>wave</code> \u9053\u4e2d\u6ce2\u6b21 <code>script</code>: \u6ce2\u6b21\u811a\u672c\u8def\u5f84\uff08\u76f8\u5bf9\u4e8e stage \u76ee\u5f55\uff0c\u4e0d\u542b <code>.py</code>\uff09 <code>wait</code> \u7b49\u5f85 <code>duration</code>: \u5e27\u6570\uff0860 = 1\u79d2\uff09 <code>midboss</code> \u9053\u4e2d Boss <code>boss</code>: Boss \u914d\u7f6e\u8def\u5f84\uff08\u4e0d\u542b <code>.json</code>\uff09 <code>boss</code> \u5173\u5e95 Boss <code>boss</code>: \u540c\u4e0a\u3002\u4f1a\u5207\u6362\u5230 boss_bgm <code>dialogue</code> \u5bf9\u8bdd <code>script</code>: \u5bf9\u8bdd\u811a\u672c\u8def\u5f84"},{"location":"STAGE_SCRIPTING_GUIDE/#10-api","title":"10. \u5f39\u5e55 API \u53c2\u8003","text":""},{"location":"STAGE_SCRIPTING_GUIDE/#selffire-","title":"<code>self.fire(...)</code> - \u53d1\u5c04\u5355\u53d1\u5b50\u5f39","text":"<pre><code>self.fire(\n    x=0, y=0.5,           # \u4f4d\u7f6e\uff08SpellCard \u9ed8\u8ba4\u4e3a Boss \u4f4d\u7f6e\uff09\n    angle=-90,             # \u89d2\u5ea6\uff08\u5ea6\uff0c0=\u53f3\uff0c90=\u4e0a\uff0c-90=\u4e0b\uff09\n    speed=2.0,             # \u901f\u5ea6\n    bullet_type=\"ball_m\",  # \u5f39\u5e55\u7c7b\u578b\n    color=\"red\",           # \u989c\u8272\n    accel=0,               # \u52a0\u901f\u5ea6\n    angle_accel=0,         # \u89d2\u901f\u5ea6\uff08\u66f2\u7ebf\u5f39\uff09\n)\n</code></pre>"},{"location":"STAGE_SCRIPTING_GUIDE/#bullet_type","title":"\u5f39\u5e55\u7c7b\u578b\uff08bullet_type\uff09","text":"\u7c7b\u578b \u8bf4\u660e \u5927\u5c0f <code>\"ball_s\"</code> \u5c0f\u5f39 \u5c0f <code>\"ball_m\"</code> \u4e2d\u5f39 \u4e2d <code>\"ball_l\"</code> \u5927\u5f39 \u5927 <code>\"rice\"</code> \u7c73\u5f39 \u7ec6\u957f <code>\"scale\"</code> \u9cde\u5f39 \u4e2d <code>\"arrowhead\"</code> \u7bad\u5934\u5f39 \u4e2d <code>\"knife\"</code> \u5200\u5f39 \u7ec6\u957f <code>\"star_s\"</code> \u5c0f\u661f\u5f39 \u5c0f <code>\"star_m\"</code> \u4e2d\u661f\u5f39 \u4e2d <code>\"needle\"</code> \u9488\u5f39 \u7ec6 <code>\"oval\"</code> \u692d\u5706\u5f39 \u4e2d <code>\"bullet\"</code> \u666e\u901a\u5f39 \u5c0f"},{"location":"STAGE_SCRIPTING_GUIDE/#color","title":"\u989c\u8272\uff08color\uff09","text":"\u989c\u8272 \u503c <code>\"red\"</code> \u7ea2\u8272 <code>\"blue\"</code> \u84dd\u8272 <code>\"green\"</code> \u7eff\u8272 <code>\"yellow\"</code> \u9ec4\u8272 <code>\"purple\"</code> \u7d2b\u8272 <code>\"white\"</code> \u767d\u8272 <code>\"darkblue\"</code> \u6df1\u84dd\u8272 <code>\"orange\"</code> \u6a59\u8272 <code>\"cyan\"</code> \u9752\u8272 <code>\"pink\"</code> \u7c89\u8272"},{"location":"STAGE_SCRIPTING_GUIDE/#11","title":"11. \u5750\u6807\u7cfb\u7edf","text":"<p>pystg \u4f7f\u7528\u5f52\u4e00\u5316\u5750\u6807\uff1a</p> <pre><code>         y = 1.0 (\u5c4f\u5e55\u4e0a\u65b9)\n            \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n            \u2502          \u2502\n  x = -1.0  \u2502  (0,0)   \u2502  x = 1.0\n            \u2502  \u4e2d\u5fc3     \u2502\n            \u2502          \u2502\n            \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n         y = -1.0 (\u5c4f\u5e55\u4e0b\u65b9)\n</code></pre> <ul> <li>x \u8303\u56f4\uff1a\u7ea6 -1.0 ~ 1.0\uff08\u5b9e\u9645\u6e38\u620f\u533a\u57df\u53ef\u80fd\u66f4\u7a84\uff09</li> <li>y \u8303\u56f4\uff1a\u7ea6 -1.0 ~ 1.0</li> <li>(0, 0) \u662f\u5c4f\u5e55\u4e2d\u5fc3</li> <li>Boss \u901a\u5e38\u5728 y = 0.3 ~ 0.7 \u7684\u533a\u57df</li> <li>\u73a9\u5bb6\u901a\u5e38\u5728 y = -0.5 ~ -0.8 \u7684\u533a\u57df</li> </ul>"},{"location":"STAGE_SCRIPTING_GUIDE/#_12","title":"\u89d2\u5ea6\u7cfb\u7edf","text":"<pre><code>           90\u00b0 (\u4e0a)\n            \u2191\n  180\u00b0 \u2190\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2192 0\u00b0 (\u53f3)\n            \u2193\n          -90\u00b0 (\u4e0b)\n</code></pre> <ul> <li>0\u00b0 = \u5411\u53f3</li> <li>90\u00b0 = \u5411\u4e0a  </li> <li>-90\u00b0 = \u5411\u4e0b\uff08\u6700\u5e38\u7528 - \u5b50\u5f39\u5411\u4e0b\u98de\u5411\u73a9\u5bb6\uff09</li> <li>180\u00b0 = \u5411\u5de6</li> </ul>"},{"location":"STAGE_SCRIPTING_GUIDE/#12-stage-1","title":"12. \u5b8c\u6574\u793a\u4f8b\uff1aStage 1 \u9010\u6587\u4ef6\u89e3\u6790","text":""},{"location":"STAGE_SCRIPTING_GUIDE/#121-stagejson-","title":"12.1 stage.json - \u65f6\u95f4\u7ebf","text":"<pre><code>\u5f00\u573a\u6ce2\u6b21 \u2192 \u7b492\u79d2 \u2192 \u5996\u7cbe\u7f16\u961f \u2192 \u7b491\u79d2 \u2192 \u9053\u4e2dBoss \u2192 \u6536\u5c3e\u6ce2\u6b21 \u2192 \u5bf9\u8bdd \u2192 \u5173\u5e95Boss\n</code></pre> <p>\u5bf9\u5e94 <code>game_content/stages/stage1/stage.json</code>\u3002</p>"},{"location":"STAGE_SCRIPTING_GUIDE/#122-wavesopening_wavepy-","title":"12.2 waves/opening_wave.py - \u5f00\u573a\u6ce2\u6b21","text":"<pre><code>from src.game.stage.wave_base import Wave\n\nclass OpeningWave(Wave):\n    async def run(self):\n        # 3\u6ce2\uff0c\u6bcf\u6ce28\u5217\u7c73\u5f39\u4ece\u4e0a\u65b9\u843d\u4e0b\n        for wave_num in range(3):\n            for i in range(8):\n                x = -0.7 + i * 0.2\n                self.fire(x=x, y=0.9, angle=-90, speed=1.8,\n                          bullet_type=\"rice\", color=\"blue\")\n            await self.wait(30)\n        await self.wait(60)\n\nwave = OpeningWave\n</code></pre> <p>\u8bbe\u8ba1\uff1a\u6700\u7b80\u5355\u7684\u6ce2\u6b21\u30028 \u5217\u84dd\u8272\u7c73\u5f39\u6574\u9f50\u4e0b\u843d\uff0c\u7ed9\u73a9\u5bb6\"\u6218\u6597\u5f00\u59cb\"\u7684\u4fe1\u53f7\u3002</p>"},{"location":"STAGE_SCRIPTING_GUIDE/#123-spellcardsnonspell_1py-","title":"12.3 spellcards/nonspell_1.py - \u7b2c\u4e00\u6bb5\u975e\u7b26","text":"<pre><code>from src.game.stage.spellcard import NonSpell\n\nclass NonSpell1(NonSpell):\n    hp = 800\n    time_limit = 30\n\n    async def setup(self):\n        await self.boss.move_to(0, 0.5, duration=30)\n\n    async def run(self):\n        angle = 0\n        while True:\n            # 16-way \u7ea2\u8272\u65cb\u8f6c\u5706\u5f39\n            self.fire_circle(count=16, speed=2.0, start_angle=angle,\n                             bullet_type=\"ball_m\", color=\"red\")\n            angle += 15\n            await self.wait(20)\n\n            # \u95f4\u6b47\u81ea\u673a\u72d9\n            if self.time % 120 &lt; 60:\n                self.fire_at_player(speed=2.5, bullet_type=\"rice\", color=\"white\")\n            await self.wait(10)\n\nspellcard = NonSpell1\n</code></pre> <p>\u8bbe\u8ba1\uff1a - \u65cb\u8f6c\u5706\u5f39\u662f\u57fa\u672c\u76d8\uff08rhythm\uff09\uff0c\u73a9\u5bb6\u53ef\u4ee5\u5728\u95f4\u9699\u4e2d\u7a7f\u68ad - \u81ea\u673a\u72d9\u589e\u52a0\u53d8\u5316\uff0c\u8feb\u4f7f\u73a9\u5bb6\u5fae\u8c03\u8d70\u4f4d - <code>angle += 15</code> \u8ba9\u5f39\u5e55\u6bcf\u6b21\u65cb\u8f6c\uff0c\u907f\u514d\u56fa\u5b9a\u5b89\u5168\u4f4d</p>"},{"location":"STAGE_SCRIPTING_GUIDE/#124-spellcardsspell_1py-","title":"12.4 spellcards/spell_1.py - \u6708\u7b26","text":"<p>\u5206\u4e09\u5c42\uff1a\u5706\u5f62\u6269\u6563 \u2192 \u81ea\u673a\u72d9\u5c04\u7ebf \u2192 15\u79d2\u540e\u52a0\u5165\u87ba\u65cb\u5f39\u5e55\u3002 \u5c55\u793a\u4e86\u5206\u9636\u6bb5\u8bbe\u8ba1\uff1a\u524d\u534a\u6bb5\u70ed\u8eab\uff0c\u540e\u534a\u6bb5\u52a0\u538b\u3002</p>"},{"location":"STAGE_SCRIPTING_GUIDE/#125-spellcardsspell_2py-","title":"12.5 spellcards/spell_2.py - \u591c\u7b26","text":"<p>\u5c55\u793a\u4e86\uff1a - Boss \u968f\u673a\u79fb\u52a8 + \u8fb9\u79fb\u52a8\u8fb9\u5c04\u5f39 - \u62bd\u53d6\u8f85\u52a9\u65b9\u6cd5 (<code>_fire_bird_pattern</code>, <code>_fire_wave_attack</code>) - V\u5b57\u5f62\u5f39\u5e55\u7684\u5b9e\u73b0</p>"},{"location":"STAGE_SCRIPTING_GUIDE/#126-bossesbossjson-boss","title":"12.6 bosses/boss.json - \u5173\u5e95 Boss \u914d\u7f6e","text":"<pre><code>{\n  \"phases\": [\n    { \"type\": \"nonspell\", \"script\": \"nonspell_1\", \"hp\": 800,  \"time\": 30 },\n    { \"type\": \"spellcard\", \"script\": \"spell_1\",   \"hp\": 1200, \"time\": 60, \"name\": \"\u6708\u7b26\u300cMoonlight Ray\u300d\" },\n    { \"type\": \"spellcard\", \"script\": \"spell_2\",   \"hp\": 1500, \"time\": 60, \"name\": \"\u591c\u7b26\u300cNight Bird\u300d\" }\n  ]\n}\n</code></pre> <p>Boss \u6309\u987a\u5e8f\u6267\u884c\uff1a\u975e\u7b261 \u2192 \u6708\u7b26 \u2192 \u591c\u7b26\u3002\u6bcf\u6bb5\u7ed3\u675f\u540e\u81ea\u52a8\u8fdb\u5165\u4e0b\u4e00\u6bb5\u3002</p>"},{"location":"STAGE_SCRIPTING_GUIDE/#13","title":"13. \u5e38\u89c1\u95ee\u9898","text":""},{"location":"STAGE_SCRIPTING_GUIDE/#q-await-yield","title":"Q: <code>await</code> \u548c <code>yield</code> \u5e94\u8be5\u7528\u54ea\u4e2a\uff1f","text":"<p>\u7edf\u4e00\u4f7f\u7528 <code>await</code>\uff08\u63a8\u8350\uff09\uff1a</p> <pre><code>async def run(self):\n    await self.wait(30)          # \u2705\n    await self.boss.move_to(...) # \u2705\n</code></pre> <p>\u7279\u6b8a\u60c5\u51b5\uff08\u5e76\u884c\u64cd\u4f5c\uff09\u624d\u9700\u8981 <code>yield</code>\uff1a</p> <pre><code># \u540c\u65f6\u79fb\u52a8 Boss \u548c\u53d1\u5f39\nmove_gen = self.boss.move_to(0.3, 0.5, 60)\nfor _ in range(60):\n    try:\n        next(move_gen)\n    except StopIteration:\n        pass\n    self.fire_at_player(speed=2.0)\n    yield  # \u2190 \u8fd9\u91cc\u5fc5\u987b\u7528 yield\n</code></pre>"},{"location":"STAGE_SCRIPTING_GUIDE/#q","title":"Q: \u600e\u4e48\u8ba9\u5f39\u5e55\u53d8\u6210\u767d\u8272\u9053\u5177\uff1f","text":"<pre><code>self.clear_bullets(to_items=True)\n</code></pre> <p>\u901a\u5e38\u5728 <code>on_timeout</code> \u6216 <code>on_defeated</code> \u4e2d\u4f7f\u7528\u3002</p>"},{"location":"STAGE_SCRIPTING_GUIDE/#q_1","title":"Q: \u600e\u4e48\u83b7\u53d6\u73a9\u5bb6\u4f4d\u7f6e\uff1f","text":"<pre><code>player = self.ctx.get_player()\npx, py = player.x, player.y\n</code></pre> <p>\u6216\u8005\uff1a</p> <pre><code>angle = self.angle_to_player()  # \u8ba1\u7b97\u5230\u73a9\u5bb6\u7684\u89d2\u5ea6\n</code></pre>"},{"location":"STAGE_SCRIPTING_GUIDE/#q_2","title":"Q: \u600e\u4e48\u53d1\u5c04\"\u66f2\u7ebf\u5f39\"\uff1f","text":"<pre><code>self.fire(\n    angle=0, speed=2.0,\n    angle_accel=2.0,   # \u6bcf\u5e27\u65cb\u8f6c 2 \u5ea6 \u2192 \u87ba\u65cb\u5f39\n    color=\"purple\"\n)\n</code></pre>"},{"location":"STAGE_SCRIPTING_GUIDE/#q_3","title":"Q: \u4e00\u4e2a\u6ce2\u6b21\u811a\u672c\u53ef\u4ee5\u4e0d\u7528\u7c7b\u5417\uff1f","text":"<p>\u53ef\u4ee5\uff0c\u7528\u51fd\u6570\u98ce\u683c\uff1a</p> <pre><code>def run(ctx):\n    for i in range(8):\n        ctx.create_bullet(x=i*0.2, y=0.9, angle=-90, speed=2.0,\n                          bullet_type=\"rice\", color=\"blue\")\n    for _ in range(60):\n        yield\n</code></pre> <p>\u4f46\u63a8\u8350\u7528 <code>Wave</code> \u7c7b\uff0c\u56e0\u4e3a\u6709\u66f4\u591a API \u53ef\u7528\u3002</p>"},{"location":"STAGE_SCRIPTING_GUIDE/#q-stage","title":"Q: \u6211\u65b0\u589e\u4e86\u4e00\u4e2a stage\uff0c\u600e\u4e48\u8ba9\u6e38\u620f\u52a0\u8f7d\u5b83\uff1f","text":"<ol> <li>\u5728 <code>game_content/stages/stageN/</code> \u521b\u5efa\u5b8c\u6574\u76ee\u5f55\u7ed3\u6784</li> <li>\u5728 <code>levels/</code> \u4e2d\u521b\u5efa\u4e00\u4e2a\u52a0\u8f7d\u811a\u672c\uff08\u53c2\u8003 <code>stage1_level.py</code>\uff09</li> <li>\u5728 <code>main.py</code> \u4e2d\u5207\u6362\u5173\u5361</li> </ol>"},{"location":"STAGE_SCRIPTING_GUIDE/#14","title":"14. \u4ece\u96f6\u521b\u5efa\u4e00\u4e2a\u65b0\u5173\u5361","text":""},{"location":"STAGE_SCRIPTING_GUIDE/#1_2","title":"\u6b65\u9aa4 1\uff1a\u521b\u5efa\u76ee\u5f55","text":"<pre><code>game_content/stages/stage2/\n\u251c\u2500\u2500 __init__.py\n\u251c\u2500\u2500 stage.json\n\u251c\u2500\u2500 waves/\n\u2502   \u2514\u2500\u2500 __init__.py\n\u251c\u2500\u2500 bosses/\n\u251c\u2500\u2500 spellcards/\n\u2502   \u2514\u2500\u2500 __init__.py\n\u251c\u2500\u2500 enemies/\n\u2502   \u2514\u2500\u2500 __init__.py\n\u2514\u2500\u2500 dialogue/\n</code></pre>"},{"location":"STAGE_SCRIPTING_GUIDE/#2-stagejson","title":"\u6b65\u9aa4 2\uff1a\u7f16\u5199 stage.json","text":"<pre><code>{\n  \"id\": \"stage2\",\n  \"name\": \"Stage 2\",\n  \"title\": \"\u4f60\u7684\u5173\u5361\u6807\u9898\",\n  \"bgm\": \"stage2.ogg\",\n  \"boss_bgm\": \"boss2.ogg\",\n  \"background\": \"stage2_bg\",\n  \"sections\": [\n    { \"type\": \"wave\", \"script\": \"waves/opening_wave\" },\n    { \"type\": \"wait\", \"duration\": 120 },\n    { \"type\": \"boss\", \"boss\": \"bosses/boss\" }\n  ]\n}\n</code></pre>"},{"location":"STAGE_SCRIPTING_GUIDE/#3_1","title":"\u6b65\u9aa4 3\uff1a\u7f16\u5199\u6ce2\u6b21\u811a\u672c","text":"<p><code>waves/opening_wave.py</code>\uff1a</p> <pre><code>from src.game.stage.wave_base import Wave\n\nclass OpeningWave(Wave):\n    async def run(self):\n        # \u4f60\u7684\u6ce2\u6b21\u903b\u8f91\n        for _ in range(5):\n            self.fire_circle(x=0, y=0.9, count=12, speed=2.0, color=\"green\")\n            await self.wait(20)\n        await self.wait(60)\n\nwave = OpeningWave\n</code></pre>"},{"location":"STAGE_SCRIPTING_GUIDE/#4_1","title":"\u6b65\u9aa4 4\uff1a\u7f16\u5199\u7b26\u5361","text":"<p><code>spellcards/nonspell_1.py</code>\uff1a</p> <pre><code>from src.game.stage.spellcard import NonSpell\n\nclass NonSpell1(NonSpell):\n    hp = 600\n    time_limit = 25\n\n    async def setup(self):\n        await self.boss.move_to(0, 0.5, duration=30)\n\n    async def run(self):\n        while True:\n            self.fire_circle(count=8, speed=2.0, color=\"blue\")\n            await self.wait(20)\n\nspellcard = NonSpell1\n</code></pre>"},{"location":"STAGE_SCRIPTING_GUIDE/#5-boss","title":"\u6b65\u9aa4 5\uff1a\u7f16\u5199 Boss \u914d\u7f6e","text":"<p><code>bosses/boss.json</code>\uff1a</p> <pre><code>{\n  \"id\": \"stage2_boss\",\n  \"name\": \"Boss \u540d\",\n  \"texture\": \"enemy_boss\",\n  \"phases\": [\n    {\n      \"type\": \"nonspell\",\n      \"hp\": 600,\n      \"time\": 25,\n      \"script\": \"nonspell_1\"\n    }\n  ]\n}\n</code></pre>"},{"location":"STAGE_SCRIPTING_GUIDE/#6","title":"\u6b65\u9aa4 6\uff1a\u521b\u5efa\u52a0\u8f7d\u811a\u672c","text":"<p><code>levels/stage2_level.py</code>\uff1a</p> <pre><code>from typing import Generator\nfrom src.game.stage.context import StageContext\nfrom src.game.stage.stage_base import StageBase\n\ndef stage2_level(stage_manager, bullet_pool, player) -&gt; Generator:\n    ctx = StageContext(\n        bullet_pool=bullet_pool,\n        player=player,\n        enemy_manager=stage_manager.enemy_manager\n    )\n    stage = StageBase.from_config(\"game_content/stages/stage2/stage.json\", ctx)\n    stage.start()\n\n    while stage._active:\n        stage.update()\n        yield\n\n    bullet_pool.clear_all()\n    for _ in range(120):\n        yield\n</code></pre> <p>\u5b8c\u6210\uff01\u8fd0\u884c\u6e38\u620f\u5373\u53ef\u770b\u5230\u4f60\u7684\u65b0\u5173\u5361\u3002</p>"},{"location":"STAGE_SCRIPTING_GUIDE/#15","title":"15. \u97f3\u9891\u7cfb\u7edf","text":"<p>pystg \u91c7\u7528\u4e24\u7ea7\u97f3\u9891\u7ba1\u7406\uff1a</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502            AudioManager\uff08\u7edf\u4e00\u8c03\u5ea6\uff09            \u2502\n\u2502                                              \u2502\n\u2502  \u67e5\u627e\u987a\u5e8f\uff1a Stage\u79c1\u6709 \u2192 Game\u5168\u5c40 \u2192 \u8b66\u544a\u7f3a\u5931  \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n              \u2502                \u2502\n    \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510  \u250c\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n    \u2502 GameAudioBank    \u2502  \u2502 StageAudioBank  \u2502\n    \u2502 \uff08\u5168\u5c40\uff0c\u59cb\u7ec8\u5b58\u5728\uff09 \u2502  \u2502 \uff08\u5173\u5361\u79c1\u6709\uff0c\u53ef\u9009\uff09\u2502\n    \u2502                  \u2502  \u2502                 \u2502\n    \u2502 shoot, graze,    \u2502  \u2502 \u53ef\u8986\u76d6\u5168\u5c40\u540c\u540d SE\u2502\n    \u2502 pldead, bomb...  \u2502  \u2502 \u5173\u5361\u4e13\u5c5e BGM    \u2502\n    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518  \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"STAGE_SCRIPTING_GUIDE/#151","title":"15.1 \u5185\u5bb9\u4f5c\u8005\u9700\u8981\u77e5\u9053\u7684","text":"<p>\u4f60\u4e0d\u9700\u8981\u76f4\u63a5\u64cd\u4f5c\u97f3\u9891\u7cfb\u7edf\u3002 \u57fa\u7c7b\u5df2\u7ecf\u63d0\u4f9b\u4e86\u4fbf\u6377\u65b9\u6cd5\uff1a</p> <pre><code># \u5728 SpellCard / Wave / EnemyScript \u4e2d\nself.play_se(\"shoot\")            # \u64ad\u653e\u97f3\u6548\nself.play_se(\"explode\", volume=0.7)  # \u6307\u5b9a\u97f3\u91cf\n\n# \u901a\u8fc7 ctx \u64ad\u653e BGM\nself.ctx.play_bgm(\"boss1\")       # \u64ad\u653e BGM\nself.ctx.stop_bgm(fade_ms=1000)  # \u6de1\u51fa\u505c\u6b62\n</code></pre>"},{"location":"STAGE_SCRIPTING_GUIDE/#152-gameaudiobank","title":"15.2 \u5168\u5c40\u97f3\u6548\uff08GameAudioBank\uff09","text":"<p>\u5168\u5c40\u97f3\u6548\u7531\u5f15\u64ce\u5728\u542f\u52a8\u65f6\u52a0\u8f7d\uff0c\u6587\u4ef6\u5728 <code>assets/audio/se/</code> \u76ee\u5f55\u4e0b\u3002 \u6240\u6709\u5185\u5bb9\u811a\u672c\u5747\u53ef\u76f4\u63a5\u4f7f\u7528\u4ee5\u4e0b\u540d\u79f0\uff1a</p> \u540d\u79f0 \u8bf4\u660e \u5bf9\u5e94\u6587\u4ef6 <code>\"shoot\"</code> \u81ea\u673a\u5c04\u51fb se_plst00.wav <code>\"graze\"</code> \u64e6\u5f39 se_graze.wav <code>\"pldead\"</code> \u81ea\u673a\u6b7b\u4ea1 se_pldead00.wav <code>\"extend\"</code> \u7eed\u547d se_extend.wav <code>\"powerup\"</code> \u6ee1P se_powerup.wav <code>\"bomb\"</code> Bomb se_nep00.wav <code>\"pause\"</code> \u6682\u505c se_pause.wav <code>\"select\"</code> \u83dc\u5355\u9009\u62e9 se_select00.wav <code>\"cancel\"</code> \u83dc\u5355\u53d6\u6d88 se_cancel00.wav <code>\"ok\"</code> \u83dc\u5355\u786e\u8ba4 se_ok00.wav <code>\"cardget\"</code> \u7b26\u5361\u53d6\u5f97 se_cardget.wav <code>\"timeout\"</code> \u8d85\u65f6 se_timeout.wav <code>\"item\"</code> \u9053\u5177\u56de\u6536 se_item00.wav <code>\"damage\"</code> \u654c\u4eba\u53d7\u4f24 se_damage00.wav <code>\"explode\"</code> \u654c\u4eba\u7206\u70b8 se_explode.wav <code>\"kira\"</code> \u661f\u661f\u97f3\u6548 se_kira00.wav <code>\"lazer\"</code> \u6fc0\u5149 se_lazer00.wav <code>\"bonus\"</code> \u5956\u52b1 se_bonus.wav <code>\"warning\"</code> \u8b66\u544a se_hyz_warning.wav <code>\"charge\"</code> \u84c4\u529b se_hyz_charge00.wav"},{"location":"STAGE_SCRIPTING_GUIDE/#153-stageaudiobank","title":"15.3 \u5173\u5361\u79c1\u6709\u97f3\u9891\uff08StageAudioBank\uff09","text":"<p>\u6bcf\u4e2a\u5173\u5361\u53ef\u4ee5\u6709\u81ea\u5df1\u7684\u4e13\u5c5e\u97f3\u9891\uff0c\u653e\u5728\u5173\u5361\u76ee\u5f55\u7684 <code>audio/</code> \u5b50\u76ee\u5f55\u4e0b\uff1a</p> <pre><code>game_content/stages/stage1/\n  audio/\n    se/                    \u2190 \u5173\u5361\u4e13\u5c5e\u97f3\u6548\n    \u2502  se_custom_shot.wav  \u2190 \u6587\u4ef6\u540d\u53bb\u6389 se_ \u524d\u7f00\u548c .wav \u540e\u7f00 \u2192 \u540d\u79f0\u4e3a \"custom_shot\"\n    \u2502  se_boss_roar.wav    \u2192 \u540d\u79f0\u4e3a \"boss_roar\"\n    \u2502\n    music/                 \u2190 \u5173\u5361\u4e13\u5c5e BGM\n       stage1_road.ogg     \u2192 \u540d\u79f0\u4e3a \"stage1_road\"\n       boss1.ogg           \u2192 \u540d\u79f0\u4e3a \"boss1\"\n</code></pre> <p>\u547d\u540d\u89c4\u5219\uff1a - SE \u6587\u4ef6\u540d <code>se_xxx.wav</code> \u81ea\u52a8\u53bb\u6389 <code>se_</code> \u524d\u7f00 \u2192 \u97f3\u6548\u540d\u4e3a <code>\"xxx\"</code> - BGM \u6587\u4ef6\u540d\u53bb\u6389\u6269\u5c55\u540d\u5373\u4e3a BGM \u540d\u79f0 - \u652f\u6301\u683c\u5f0f\uff1a<code>.wav</code>\uff08SE\uff09\u3001<code>.ogg</code> / <code>.mp3</code> / <code>.wav</code>\uff08BGM\uff09</p> <p>\u8986\u76d6\u673a\u5236\uff1a \u5982\u679c\u5173\u5361\u79c1\u6709 SE \u548c\u5168\u5c40 SE \u540c\u540d\uff0c\u5219\u5173\u5361\u79c1\u6709\u4f18\u5148\u3002\u4f8b\u5982\u5173\u5361 <code>audio/se/se_shoot.wav</code> \u4f1a\u8986\u76d6\u5168\u5c40\u7684 <code>\"shoot\"</code> \u97f3\u6548\u3002</p>"},{"location":"STAGE_SCRIPTING_GUIDE/#154","title":"15.4 \u5728\u811a\u672c\u4e2d\u4f7f\u7528\u97f3\u9891","text":""},{"location":"STAGE_SCRIPTING_GUIDE/#spellcard-nonspell","title":"SpellCard / NonSpell \u4e2d","text":"<pre><code>class MySpell(SpellCard):\n    async def setup(self):\n        self.play_se(\"warning\")       # \u7b26\u5361\u5f00\u59cb\u65f6\u64ad\u653e\u8b66\u544a\u97f3\n        await self.boss.move_to(0, 0.5, duration=60)\n\n    async def run(self):\n        while True:\n            self.fire_circle(count=20, speed=2.5, color=\"red\")\n            self.play_se(\"shoot\")     # \u6bcf\u6b21\u53d1\u5f39\u64ad\u653e\u5c04\u51fb\u97f3\n            await self.wait(15)\n\n    async def on_defeated(self):\n        self.clear_bullets(to_items=True)\n        self.play_se(\"explode\")       # Boss \u88ab\u51fb\u8d25\u65f6\u7206\u70b8\u97f3\n</code></pre>"},{"location":"STAGE_SCRIPTING_GUIDE/#wave","title":"Wave \u4e2d","text":"<pre><code>class MyWave(Wave):\n    async def run(self):\n        self.play_se(\"warning\")       # \u6ce2\u6b21\u5f00\u59cb\u63d0\u793a\n        await self.wait(60)\n\n        for _ in range(5):\n            self.fire_circle(x=0, y=0.9, count=12, speed=2.0)\n            self.play_se(\"shoot\")\n            await self.wait(20)\n</code></pre>"},{"location":"STAGE_SCRIPTING_GUIDE/#enemyscript","title":"EnemyScript \u4e2d","text":"<pre><code>class BigFairy(EnemyScript):\n    hp = 100\n\n    async def run(self):\n        await self.move_to(self.x, 0.3, duration=60)\n        self.play_se(\"charge\")        # \u84c4\u529b\u97f3\n        await self.wait(60)\n        self.fire_circle(count=24, speed=3.0, color=\"purple\")\n        self.play_se(\"lazer\")         # \u53d1\u5c04\u97f3\n</code></pre>"},{"location":"STAGE_SCRIPTING_GUIDE/#ctx-bgm","title":"\u901a\u8fc7 ctx \u63a7\u5236 BGM","text":"<pre><code># \u5728 Wave \u6216 SpellCard \u4e2d\u76f4\u63a5\u901a\u8fc7 ctx\nself.ctx.play_bgm(\"boss1\")               # \u64ad\u653e BGM\nself.ctx.play_bgm(\"boss1\", fade_ms=2000) # 2\u79d2\u6de1\u5165\nself.ctx.stop_bgm(fade_ms=1000)          # 1\u79d2\u6de1\u51fa\u505c\u6b62\nself.ctx.pause_bgm()                     # \u6682\u505c\nself.ctx.unpause_bgm()                   # \u6062\u590d\n</code></pre> <p>\u6ce8\u610f\uff1a \u901a\u5e38\u4e0d\u9700\u8981\u624b\u52a8\u63a7\u5236 BGM\u3002<code>stage.json</code> \u4e2d\u914d\u7f6e\u7684 <code>bgm</code> \u548c <code>boss_bgm</code> \u4f1a\u7531\u5f15\u64ce\u81ea\u52a8\u5728\u5408\u9002\u7684\u65f6\u673a\u64ad\u653e\u3002\u53ea\u6709\u5728\u9700\u8981\u7279\u6b8a\u97f3\u9891\u63a7\u5236\uff08\u5982\u7b26\u5361\u4e2d\u95f4\u5207\u6362 BGM\u3001\u5bf9\u8bdd\u671f\u95f4\u964d\u4f4e\u97f3\u91cf\u7b49\uff09\u65f6\u624d\u9700\u8981\u624b\u52a8\u8c03\u7528\u3002</p>"},{"location":"STAGE_SCRIPTING_GUIDE/#155","title":"15.5 \u4e3a\u65b0\u5173\u5361\u6dfb\u52a0\u97f3\u9891","text":"<ol> <li>\u5728\u5173\u5361\u76ee\u5f55\u4e0b\u521b\u5efa <code>audio/se/</code> \u548c <code>audio/music/</code> \u76ee\u5f55</li> <li>\u5c06 SE \u6587\u4ef6\uff08<code>.wav</code>\uff09\u653e\u5165 <code>audio/se/</code>\uff0c\u6587\u4ef6\u540d\u4ee5 <code>se_</code> \u5f00\u5934</li> <li>\u5c06 BGM \u6587\u4ef6\uff08<code>.ogg</code>/<code>.mp3</code>\uff09\u653e\u5165 <code>audio/music/</code></li> <li>\u5728\u52a0\u8f7d\u811a\u672c\uff08<code>levels/stageN_level.py</code>\uff09\u4e2d\u521d\u59cb\u5316 StageAudioBank\uff1a</li> </ol> <pre><code>from src.game.audio import StageAudioBank\n\ndef stageN_level(stage_manager, bullet_pool, player, audio_manager=None):\n    # \u52a0\u8f7d\u5173\u5361\u79c1\u6709\u97f3\u9891\n    stage_bank = StageAudioBank.from_directory(\"stageN\", \"game_content/stages/stageN\")\n    if audio_manager:\n        audio_manager.set_stage_bank(stage_bank)\n\n    ctx = StageContext(\n        bullet_pool=bullet_pool,\n        player=player,\n        enemy_manager=stage_manager.enemy_manager,\n        audio_manager=audio_manager\n    )\n    # ... \u5176\u4f59\u903b\u8f91\n\n    # \u5173\u5361\u7ed3\u675f\u65f6\u6e05\u7406\n    if audio_manager:\n        audio_manager.set_stage_bank(None)\n</code></pre> <ol> <li>\u5b8c\u6210\uff01\u811a\u672c\u4e2d\u5c31\u53ef\u4ee5\u901a\u8fc7 <code>self.play_se(\"xxx\")</code> \u4f7f\u7528\u65b0\u97f3\u6548\u4e86\u3002</li> </ol>"},{"location":"STAGE_SCRIPTING_GUIDE/#_13","title":"\u9644\u5f55\uff1a\u6587\u4ef6\u5206\u5c42\u4e00\u89c8","text":"<pre><code>\u4f60\u9700\u8981\u5173\u5fc3\u7684\uff08\u5185\u5bb9\u5c42\uff09\uff1a\n  game_content/stages/stageN/\n    \u251c\u2500\u2500 stage.json          \u2190 \u65f6\u95f4\u7ebf\n    \u251c\u2500\u2500 waves/*.py          \u2190 \u9053\u4e2d\u5f39\u5e55\n    \u251c\u2500\u2500 spellcards/*.py     \u2190 \u7b26\u5361\u811a\u672c\n    \u251c\u2500\u2500 bosses/*.json       \u2190 Boss \u7b26\u5361\u5e8f\u5217\n    \u251c\u2500\u2500 enemies/*.py        \u2190 \u654c\u4eba\u811a\u672c\n    \u251c\u2500\u2500 dialogue/*.py       \u2190 \u5bf9\u8bdd\n    \u2514\u2500\u2500 audio/              \u2190 \u5173\u5361\u79c1\u6709\u97f3\u9891\uff08\u53ef\u9009\uff09\n        \u251c\u2500\u2500 se/*.wav        \u2190 \u5173\u5361\u97f3\u6548\n        \u2514\u2500\u2500 music/*.ogg     \u2190 \u5173\u5361 BGM\n\n\u4f60\u4e0d\u9700\u8981\u5173\u5fc3\u7684\uff08\u5f15\u64ce\u5c42\uff09\uff1a\n  src/game/stage/\n    \u251c\u2500\u2500 spellcard.py        \u2190 SpellCard/NonSpell \u57fa\u7c7b\n    \u251c\u2500\u2500 wave_base.py        \u2190 Wave \u57fa\u7c7b\n    \u251c\u2500\u2500 enemy_script.py     \u2190 EnemyScript \u57fa\u7c7b\n    \u251c\u2500\u2500 boss_base.py        \u2190 BossBase\uff08\u4ece JSON \u52a0\u8f7d\uff09\n    \u251c\u2500\u2500 stage_base.py       \u2190 StageBase\uff08\u4ece JSON \u52a0\u8f7d\uff09\n    \u251c\u2500\u2500 context.py          \u2190 StageContext\uff08\u5f15\u64ce\u6865\u6881\uff09\n    \u2514\u2500\u2500 practice.py         \u2190 \u7ec3\u4e60\u6a21\u5f0f\n\n  src/game/audio.py           \u2190 \u97f3\u9891\u7cfb\u7edf\uff08AudioBank / AudioManager\uff09\n  src/game/bullet/            \u2190 \u5b50\u5f39\u6c60\uff08\u5f15\u64ce\u5185\u90e8\uff09\n  src/game/player/            \u2190 \u73a9\u5bb6\u7cfb\u7edf\uff08\u5f15\u64ce\u5185\u90e8\uff09\n  src/render/                 \u2190 \u6e32\u67d3\u7cfb\u7edf\uff08\u5f15\u64ce\u5185\u90e8\uff09\n</code></pre>"},{"location":"TEXTURE_ASSET_SYSTEM/","title":"\u7eb9\u7406\u8d44\u4ea7\u7ba1\u7406\u7cfb\u7edf","text":""},{"location":"TEXTURE_ASSET_SYSTEM/#_2","title":"\u6982\u8ff0","text":"<p>\u672c\u7cfb\u7edf\u63d0\u4f9b\u7edf\u4e00\u7684\u7eb9\u7406\u8d44\u4ea7\u7ba1\u7406\uff0c\u652f\u6301\uff1a - \u7eb9\u7406\u56fe\u96c6 (TextureAtlas) - \u4e00\u5f20\u5927\u56fe\u5305\u542b\u591a\u4e2a\u5b50\u7eb9\u7406\u533a\u57df - \u9759\u6001\u7cbe\u7075 (Sprite) - \u7eb9\u7406\u4e2d\u7684\u4e00\u4e2a\u9759\u6001\u533a\u57df - \u52a8\u753b\u7cbe\u7075 (AnimatedSprite) - \u8fde\u7eed\u591a\u5e27\u7ec4\u6210\u7684\u4f2a\u52a8\u753b</p>"},{"location":"TEXTURE_ASSET_SYSTEM/#_3","title":"\u6838\u5fc3\u7c7b","text":""},{"location":"TEXTURE_ASSET_SYSTEM/#sprite-","title":"Sprite - \u9759\u6001\u7cbe\u7075","text":"<pre><code>@dataclass\nclass Sprite:\n    name: str                           # \u7cbe\u7075\u540d\u79f0\n    texture_path: str                   # \u6240\u5c5e\u7eb9\u7406\u8def\u5f84\n    rect: Tuple[int, int, int, int]     # (x, y, width, height)\n    center: Tuple[float, float]         # \u4e2d\u5fc3\u70b9\n    radius: float                       # \u78b0\u649e\u534a\u5f84\n    rotate: bool                        # \u662f\u5426\u8ddf\u968f\u65b9\u5411\u65cb\u8f6c\n    scale: Tuple[float, float]          # \u7f29\u653e\n    metadata: Dict[str, Any]            # \u989d\u5916\u5143\u6570\u636e\n</code></pre>"},{"location":"TEXTURE_ASSET_SYSTEM/#animatedsprite-","title":"AnimatedSprite - \u52a8\u753b\u7cbe\u7075","text":"<pre><code>@dataclass\nclass AnimatedSprite:\n    name: str                           # \u52a8\u753b\u540d\u79f0\n    texture_path: str                   # \u6240\u5c5e\u7eb9\u7406\u8def\u5f84\n    frames: List[SpriteFrame]           # \u5e27\u5217\u8868\n    center: Tuple[float, float]         # \u52a8\u753b\u4e2d\u5fc3\u70b9\n    radius: float                       # \u78b0\u649e\u534a\u5f84\n    rotate: bool                        # \u662f\u5426\u8ddf\u968f\u65b9\u5411\u65cb\u8f6c\n    frame_duration: float               # \u6bcf\u5e27\u6301\u7eed\u65f6\u95f4\uff08\u79d2\uff09\n    loop: bool                          # \u662f\u5426\u5faa\u73af\u64ad\u653e\n</code></pre> <p>\u5173\u952e\u65b9\u6cd5\uff1a - <code>get_frame_at_time(time)</code> - \u6839\u636e\u65f6\u95f4\u83b7\u53d6\u5f53\u524d\u5e27 - <code>get_frame_index_at_time(time)</code> - \u83b7\u53d6\u5f53\u524d\u5e27\u7d22\u5f15 - <code>get_frame_uv_at_time(time, texture_size)</code> - \u83b7\u53d6\u5f53\u524d\u5e27UV\u5750\u6807</p>"},{"location":"TEXTURE_ASSET_SYSTEM/#json","title":"JSON\u914d\u7f6e\u683c\u5f0f","text":""},{"location":"TEXTURE_ASSET_SYSTEM/#v20","title":"\u65b0\u683c\u5f0f (v2.0)","text":"<pre><code>{\n  \"version\": \"2.0\",\n  \"texture\": \"spritesheet.png\",\n\n  \"sprites\": {\n    \"bullet_red\": {\n      \"rect\": [0, 0, 32, 32],\n      \"center\": [16, 16],\n      \"radius\": 8.0,\n      \"rotate\": true,\n      \"metadata\": {\n        \"damage\": 10\n      }\n    }\n  },\n\n  \"animations\": {\n    \"bullet_spin\": {\n      \"frames\": [\n        {\"rect\": [0, 64, 32, 32]},\n        {\"rect\": [32, 64, 32, 32]},\n        {\"rect\": [64, 64, 32, 32]},\n        {\"rect\": [96, 64, 32, 32]}\n      ],\n      \"center\": [16, 16],\n      \"frame_duration\": 0.1,\n      \"loop\": true\n    },\n\n    \"bullet_pulse\": {\n      \"strip\": {\n        \"x\": 0,\n        \"y\": 128,\n        \"width\": 32,\n        \"height\": 32,\n        \"count\": 8,\n        \"direction\": \"horizontal\",\n        \"spacing\": 0\n      },\n      \"center\": [16, 16],\n      \"frame_duration\": 0.1,\n      \"loop\": true\n    }\n  }\n}\n</code></pre>"},{"location":"TEXTURE_ASSET_SYSTEM/#_4","title":"\u52a8\u753b\u5b9a\u4e49\u65b9\u5f0f","text":""},{"location":"TEXTURE_ASSET_SYSTEM/#1","title":"\u65b9\u5f0f1: \u663e\u5f0f\u5e27\u5217\u8868","text":"<p>\u9002\u5408\u4e0d\u89c4\u5219\u6392\u5217\u7684\u5e27\uff1a</p> <pre><code>\"animation_name\": {\n  \"frames\": [\n    {\"rect\": [0, 0, 32, 32]},\n    {\"rect\": [32, 0, 32, 32]},\n    {\"rect\": [64, 0, 32, 32]}\n  ],\n  \"frame_duration\": 0.1,\n  \"loop\": true\n}\n</code></pre>"},{"location":"TEXTURE_ASSET_SYSTEM/#2-strip","title":"\u65b9\u5f0f2: \u8fde\u7eed\u5e27\u5e26 (Strip)","text":"<p>\u9002\u5408\u89c4\u5219\u6392\u5217\u7684\u52a8\u753b\u5e27\uff1a</p> <pre><code>\"animation_name\": {\n  \"strip\": {\n    \"x\": 0,           // \u8d77\u59cbX\n    \"y\": 0,           // \u8d77\u59cbY\n    \"width\": 32,      // \u5e27\u5bbd\u5ea6\n    \"height\": 32,     // \u5e27\u9ad8\u5ea6\n    \"count\": 8,       // \u5e27\u6570\u91cf\n    \"direction\": \"horizontal\",  // horizontal \u6216 vertical\n    \"spacing\": 0      // \u5e27\u95f4\u8ddd\uff08\u53ef\u9009\uff09\n  },\n  \"frame_duration\": 0.1,\n  \"loop\": true\n}\n</code></pre>"},{"location":"TEXTURE_ASSET_SYSTEM/#_5","title":"\u4f7f\u7528\u793a\u4f8b","text":""},{"location":"TEXTURE_ASSET_SYSTEM/#_6","title":"\u57fa\u672c\u4f7f\u7528","text":"<pre><code>from src.resource.texture_asset import TextureAssetManager\n\n# \u521b\u5efa\u7ba1\u7406\u5668\nmanager = TextureAssetManager(\"assets\")\n\n# \u52a0\u8f7d\u914d\u7f6e\nmanager.load_atlas_config(\"images/bullet/bullet_atlas.json\")\n\n# \u83b7\u53d6\u7cbe\u7075\nsprite = manager.get_sprite(\"bullet_red\")\nprint(f\"\u7cbe\u7075\u5927\u5c0f: {sprite.width}x{sprite.height}\")\n\n# \u83b7\u53d6\u7cbe\u7075Surface\nsurface = manager.get_sprite_surface(\"bullet_red\")\n\n# \u83b7\u53d6UV\u5750\u6807\uff08\u7528\u4e8eGPU\u6e32\u67d3\uff09\nuv = manager.get_sprite_uv(\"bullet_red\")\nprint(f\"UV: {uv}\")  # (u_left, v_top, u_right, v_bottom)\n</code></pre>"},{"location":"TEXTURE_ASSET_SYSTEM/#_7","title":"\u4f7f\u7528\u52a8\u753b","text":"<pre><code># \u83b7\u53d6\u52a8\u753b\nanim = manager.get_animation(\"bullet_spin\")\n\n# \u6e38\u620f\u5faa\u73af\u4e2d\ntime_elapsed = 0.0\nwhile running:\n    dt = clock.tick(60) / 1000.0\n    time_elapsed += dt\n\n    # \u83b7\u53d6\u5f53\u524d\u5e27\u7d22\u5f15\n    frame_idx = anim.get_frame_index_at_time(time_elapsed)\n\n    # \u83b7\u53d6\u5f53\u524d\u5e27UV\uff08\u7528\u4e8eGPU\u6e32\u67d3\uff09\n    uv = manager.get_animation_frame_uv(\"bullet_spin\", time_elapsed)\n</code></pre>"},{"location":"TEXTURE_ASSET_SYSTEM/#_8","title":"\u517c\u5bb9\u65e7\u683c\u5f0f","text":"<pre><code># \u52a0\u8f7d\u65e7\u683c\u5f0f\u914d\u7f6e\nmanager.load_legacy_config(\"images/bullet1.json\")\n</code></pre>"},{"location":"TEXTURE_ASSET_SYSTEM/#_9","title":"\u5168\u5c40\u5b9e\u4f8b","text":"<pre><code>from src.resource.texture_asset import (\n    init_texture_asset_manager,\n    get_texture_asset_manager\n)\n\n# \u521d\u59cb\u5316\uff08\u901a\u5e38\u5728\u6e38\u620f\u542f\u52a8\u65f6\uff09\ninit_texture_asset_manager(\"assets\")\n\n# \u5728\u5176\u4ed6\u5730\u65b9\u83b7\u53d6\nmanager = get_texture_asset_manager()\n</code></pre>"},{"location":"TEXTURE_ASSET_SYSTEM/#_10","title":"\u7cbe\u7075\u547d\u540d\u89c4\u8303","text":"<ul> <li>\u7cbe\u7075\u53ef\u4ee5\u901a\u8fc7\u77ed\u540d\u79f0\u8bbf\u95ee: <code>manager.get_sprite(\"bullet_red\")</code></li> <li>\u4e5f\u53ef\u4ee5\u901a\u8fc7\u5b8c\u6574\u540d\u79f0\u8bbf\u95ee: <code>manager.get_sprite(\"atlas_name.bullet_red\")</code></li> <li>\u5f53\u591a\u4e2a\u56fe\u96c6\u6709\u540c\u540d\u7cbe\u7075\u65f6\uff0c\u4f7f\u7528\u5b8c\u6574\u540d\u79f0\u907f\u514d\u51b2\u7a81</li> </ul>"},{"location":"TEXTURE_ASSET_SYSTEM/#_11","title":"\u6027\u80fd\u4f18\u5316","text":"<ol> <li>Surface\u7f13\u5b58: <code>get_sprite_surface()</code> \u81ea\u52a8\u7f13\u5b58\u88c1\u526a\u540e\u7684Surface</li> <li>\u6309\u9700\u52a0\u8f7d: \u53ea\u52a0\u8f7d\u5b9e\u9645\u4f7f\u7528\u7684\u56fe\u96c6</li> <li>\u5378\u8f7d\u529f\u80fd: <code>unload_atlas(name)</code> \u91ca\u653e\u4e0d\u9700\u8981\u7684\u8d44\u6e90</li> </ol>"},{"location":"TEXTURE_ASSET_SYSTEM/#_12","title":"\u4e0e\u73b0\u6709\u7cfb\u7edf\u96c6\u6210","text":"<p>\u65b0\u7684 <code>TextureAssetManager</code> \u53ef\u4ee5\u4e0e\u73b0\u6709\u7684 <code>SpriteManager</code> \u5e76\u884c\u4f7f\u7528\uff1a</p> <pre><code># \u9010\u6b65\u8fc1\u79fb\nold_manager = SpriteManager()\nnew_manager = TextureAssetManager()\n\n# \u65b0\u8d44\u4ea7\u4f7f\u7528\u65b0\u7cfb\u7edf\nnew_manager.load_atlas_config(\"images/new_bullet_atlas.json\")\n\n# \u65e7\u8d44\u4ea7\u7ee7\u7eed\u4f7f\u7528\u65e7\u7cfb\u7edf\u6216\u8f6c\u6362\nnew_manager.load_legacy_config(\"images/bullet1.json\")\n</code></pre>"},{"location":"TEXTURE_ASSET_SYSTEM/#_13","title":"\u56fe\u96c6\u5236\u4f5c\u5efa\u8bae","text":"<ol> <li>\u6309\u7c7b\u578b\u5206\u56fe\u96c6: \u5b50\u5f39\u3001\u654c\u4eba\u3001\u9053\u5177\u7b49\u5206\u5f00</li> <li>\u5408\u7406\u7684\u5e27\u5c3a\u5bf8: \u7edf\u4e00\u5c3a\u5bf8\u4fbf\u4e8e\u6279\u91cf\u5904\u7406</li> <li>\u7559\u767d\u8fb9\u8ddd: \u907f\u514d\u6e32\u67d3\u65f6\u8fb9\u7f18\u91c7\u6837\u95ee\u9898</li> <li>2\u7684\u5e42\u6b21\u5c3a\u5bf8: GPU\u4f18\u5316\uff08\u53ef\u9009\uff09</li> </ol>"},{"location":"TEXTURE_ASSET_SYSTEM/#_14","title":"\u6587\u4ef6\u7ed3\u6784\u793a\u4f8b","text":"<pre><code>assets/\n\u251c\u2500\u2500 images/\n\u2502   \u251c\u2500\u2500 bullet/\n\u2502   \u2502   \u251c\u2500\u2500 bullet_atlas.png      # \u7eb9\u7406\u56fe\u96c6\n\u2502   \u2502   \u2514\u2500\u2500 bullet_atlas.json     # \u914d\u7f6e\u6587\u4ef6\n\u2502   \u251c\u2500\u2500 enemy/\n\u2502   \u2502   \u251c\u2500\u2500 enemy_atlas.png\n\u2502   \u2502   \u2514\u2500\u2500 enemy_atlas.json\n\u2502   \u2514\u2500\u2500 item/\n\u2502       \u251c\u2500\u2500 item.png\n\u2502       \u2514\u2500\u2500 item.json\n</code></pre>"},{"location":"architecture/","title":"\u67b6\u6784\u6982\u89c8","text":""},{"location":"architecture/#_2","title":"\u5206\u5c42\u7ed3\u6784","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502                        \u5165\u53e3 main.py                          \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502   src.core   \u2502 src.resource \u2502  src.game    \u2502    src.ui      \u2502\n\u2502  \u914d\u7f6e / \u78b0\u649e  \u2502  \u7eb9\u7406 / \u7cbe\u7075  \u2502  \u6e38\u620f\u903b\u8f91     \u2502  HUD / \u83dc\u5355    \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                              src.render                      \u2502\n\u2502                             \u6e32\u67d3\u7ba1\u7ebf                          \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502                        game_content/                          \u2502\n\u2502                    \u5173\u5361\u5185\u5bb9\uff08\u5f39\u5e55\u811a\u672c\uff09                         \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>\u5f15\u64ce\u548c\u5185\u5bb9\u901a\u8fc7 <code>StageContext</code> \u6865\u63a5\u2014\u2014\u5185\u5bb9\u811a\u672c\u53ea\u80fd\u901a\u8fc7 <code>ctx</code> \u8c03\u7528\u5f15\u64ce\u80fd\u529b\uff0c\u4e0d\u80fd\u76f4\u63a5 import \u5f15\u64ce\u5185\u90e8\u6a21\u5757\u3002</p>"},{"location":"architecture/#_3","title":"\u6a21\u5757\u8bf4\u660e","text":""},{"location":"architecture/#srccore","title":"src/core \u2014 \u57fa\u7840\u8bbe\u65bd","text":"\u6a21\u5757 \u804c\u8d23 <code>config.py</code> \u6e38\u620f\u914d\u7f6e\u5e38\u91cf\uff08\u5206\u8fa8\u7387\u3001\u6e38\u620f\u533a\u57df\u3001\u5e27\u7387\uff09 <code>collision.py</code> \u78b0\u649e\u68c0\u6d4b\uff08Numba JIT \u52a0\u901f\uff0c\u652f\u6301\u5224\u5b9a\u70b9\u548c\u64e6\u5f39\uff09 <code>interfaces.py</code> \u6838\u5fc3\u63a5\u53e3\u5b9a\u4e49 <code>sprite_registry.py</code> \u5168\u5c40\u7cbe\u7075\u6ce8\u518c\u8868"},{"location":"architecture/#srcresource","title":"src/resource \u2014 \u8d44\u6e90\u7ba1\u7406","text":"\u6a21\u5757 \u804c\u8d23 <code>texture_asset.py</code> \u7eb9\u7406\u56fe\u96c6\u52a0\u8f7d\u3001\u7cbe\u7075\u5b9a\u4e49\u3001UV \u5750\u6807\u8ba1\u7b97 <code>unified_texture.py</code> \u7edf\u4e00\u7eb9\u7406\u7ba1\u7406\u5668\uff08\u8de8\u56fe\u96c6\u67e5\u627e\u7cbe\u7075\uff09 <code>sprite/</code> \u7cbe\u7075\u7ba1\u7406 <code>asset_manager.py</code> \u8d44\u4ea7\u52a0\u8f7d\u548c\u7f13\u5b58"},{"location":"architecture/#srcgame","title":"src/game \u2014 \u6e38\u620f\u903b\u8f91","text":"\u6a21\u5757 \u804c\u8d23 <code>bullet/optimized_pool.py</code> \u9ad8\u6027\u80fd\u5b50\u5f39\u6c60\uff08\u7ed3\u6784\u5316 NumPy \u6570\u7ec4 + Numba\uff09 <code>player/</code> \u73a9\u5bb6\u7cfb\u7edf\uff08\u79fb\u52a8\u3001\u5c04\u51fb\u3001\u52a8\u753b\u3001\u5b50\u673a\uff09 <code>stage/</code> \u5173\u5361\u7cfb\u7edf\u6838\u5fc3\u2014\u2014\u4e0b\u9762\u5355\u72ec\u8bf4 <code>boss/</code> Boss \u7ba1\u7406\u5668 <code>laser.py</code> \u6fc0\u5149\u7cfb\u7edf\uff08\u76f4\u7ebf / \u66f2\u7ebf\uff0c\u6c60\u5316\u7ba1\u7406\uff09 <code>item.py</code> \u9053\u5177\u7cfb\u7edf <code>audio.py</code> \u97f3\u9891\u7cfb\u7edf\uff08\u53cc\u5c42\uff1a\u5168\u5c40 + \u5173\u5361\u79c1\u6709\uff09 <code>background_render/</code> 3D \u80cc\u666f\u6e32\u67d3\uff08\u900f\u89c6\u6295\u5f71\u3001\u96fe\u6548\uff09"},{"location":"architecture/#srcgamestage","title":"src/game/stage \u2014 \u5173\u5361\u7cfb\u7edf\uff08\u6838\u5fc3\uff09","text":"<p>\u8fd9\u662f\u5185\u5bb9\u5f00\u53d1\u8005\u6700\u9700\u8981\u7406\u89e3\u7684\u90e8\u5206\uff1a</p> \u6a21\u5757 \u804c\u8d23 <code>stage_base.py</code> <code>StageScript</code> \u57fa\u7c7b\u2014\u2014\u5173\u5361\u4e3b\u811a\u672c\u7ee7\u627f\u5b83 <code>context.py</code> <code>StageContext</code>\u2014\u2014\u5f15\u64ce\u4e0e\u5185\u5bb9\u7684\u6865\u6881 <code>spellcard.py</code> <code>SpellCard</code> / <code>NonSpell</code> \u57fa\u7c7b <code>wave_base.py</code> <code>Wave</code> \u57fa\u7c7b <code>enemy_script.py</code> <code>EnemyScript</code> \u57fa\u7c7b <code>boss_base.py</code> <code>BossBase</code>\u2014\u2014\u7ba1\u7406\u7b26\u5361\u9636\u6bb5\u5e8f\u5217 <code>preset_enemy.py</code> \u9884\u8bbe\u654c\u4eba\u7cfb\u7edf\uff08JSON \u914d\u7f6e\u9a71\u52a8\uff09 <code>dialog_manager.py</code> \u5bf9\u8bdd\u7ba1\u7406 <code>practice.py</code> \u7ec3\u4e60\u6a21\u5f0f"},{"location":"architecture/#srcrender","title":"src/render \u2014 \u6e32\u67d3","text":"\u6a21\u5757 \u804c\u8d23 <code>renderer.py</code> \u4e3b\u6e32\u67d3\u5668\uff08\u534f\u8c03\u6240\u6709\u5b50\u6e32\u67d3\u5668\uff09 <code>optimized_bullet_renderer.py</code> \u5b50\u5f39\u6279\u91cf\u5b9e\u4f8b\u5316\u6e32\u67d3 <code>laser_renderer.py</code> \u6fc0\u5149\u6e32\u67d3\uff08\u76f4\u7ebf/\u66f2\u7ebf\u51e0\u4f55\u4f53\u6784\u5efa\uff09 <code>player_renderer.py</code> \u73a9\u5bb6\u7cbe\u7075\u6e32\u67d3 <code>item_renderer.py</code> \u9053\u5177\u6e32\u67d3"},{"location":"architecture/#srcui","title":"src/ui \u2014 \u754c\u9762","text":"\u6a21\u5757 \u804c\u8d23 <code>hud.py</code> HUD\uff08\u6b8b\u673a\u3001\u7b26\u5361\u3001\u5206\u6570\u3001Power\uff09 <code>bitmap_font.py</code> \u4f4d\u56fe\u5b57\u4f53\u6e32\u67d3 <code>dialog_gl_renderer.py</code> \u5bf9\u8bdd\u6846 OpenGL \u6e32\u67d3 <code>main_menu_renderer.py</code> \u4e3b\u83dc\u5355 <code>loading_renderer.py</code> \u52a0\u8f7d\u753b\u9762"},{"location":"architecture/#_4","title":"\u6570\u636e\u6d41","text":""},{"location":"architecture/#_5","title":"\u4e00\u5e27\u7684\u6267\u884c\u987a\u5e8f","text":"<pre><code>\u8f93\u5165\u5904\u7406 \u2192 \u73a9\u5bb6\u66f4\u65b0 \u2192 \u5173\u5361\u534f\u7a0b\u63a8\u8fdb \u2192 \u5b50\u5f39\u66f4\u65b0 \u2192 \u6fc0\u5149\u66f4\u65b0 \u2192 \u78b0\u649e\u68c0\u6d4b \u2192 \u9053\u5177\u66f4\u65b0 \u2192 \u6e32\u67d3\n</code></pre>"},{"location":"architecture/#_6","title":"\u5173\u5361\u7cfb\u7edf\u5185\u90e8","text":"<pre><code>StageScript.run()\n  \u2502\n  \u251c\u2500\u2500 run_wave(WaveClass)        \u2192 \u5b9e\u4f8b\u5316 Wave\uff0c\u6267\u884c\u5176 run() \u534f\u7a0b\n  \u2502\n  \u251c\u2500\u2500 play_dialogue([...])       \u2192 \u963b\u585e\u5f0f\u5bf9\u8bdd\uff0c\u5b8c\u6210\u540e\u7ee7\u7eed\n  \u2502\n  \u2514\u2500\u2500 run_boss(BossDef)          \u2192 \u8fdb\u5165 Boss \u6218\n        \u2502\n        \u2514\u2500\u2500 \u6309\u987a\u5e8f\u6267\u884c phases:\n              \u251c\u2500\u2500 NonSpell.run()   \u2192 \u975e\u7b26\u5f39\u5e55\u5faa\u73af\n              \u2514\u2500\u2500 SpellCard.run()  \u2192 \u7b26\u5361\u5f39\u5e55\u5faa\u73af\n</code></pre> <p>\u6bcf\u4e2a\u534f\u7a0b\uff08<code>run()</code>\uff09\u5185\u90e8\u901a\u8fc7 <code>await self.wait(N)</code> \u63a7\u5236\u65f6\u95f4\uff0c\u5f15\u64ce\u6bcf\u5e27\u63a8\u8fdb\u4e00\u6b65\u3002</p>"},{"location":"architecture/#_7","title":"\u5b50\u5f39\u751f\u547d\u5468\u671f","text":"<pre><code>\u811a\u672c\u8c03\u7528 self.fire() \u2192 StageContext \u2192 BulletPool.spawn()\n                                          \u2502\n                                    \u7ed3\u6784\u5316 NumPy \u6570\u7ec4\n                                    (x, y, speed, angle, ...)\n                                          \u2502\n                              \u6bcf\u5e27 Numba JIT \u6279\u91cf\u66f4\u65b0\u4f4d\u7f6e\n                                          \u2502\n                              \u51fa\u754c / \u78b0\u649e \u2192 \u6807\u8bb0\u4e3a dead \u2192 \u56de\u6536\u69fd\u4f4d\n</code></pre>"},{"location":"architecture/#stagecontext","title":"StageContext\uff1a\u5f15\u64ce\u4e0e\u5185\u5bb9\u7684\u6865\u6881","text":"<p>\u5185\u5bb9\u811a\u672c\uff08SpellCard\u3001Wave\u3001EnemyScript\uff09\u4e0d\u76f4\u63a5\u64cd\u4f5c BulletPool \u6216 Player\u3002 \u5b83\u4eec\u901a\u8fc7 <code>self.fire()</code> / <code>self.fire_circle()</code> \u7b49\u65b9\u6cd5\uff0c\u6700\u7ec8\u59d4\u6258\u7ed9 <code>StageContext</code>\uff0c\u7531 Context \u8c03\u7528\u5f15\u64ce\u5185\u90e8 API\u3002</p> <pre><code>\u5185\u5bb9\u811a\u672c                    StageContext                     \u5f15\u64ce\n\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500                 \u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500                    \u2500\u2500\u2500\u2500\u2500\u2500\nself.fire(...)         \u2192   ctx.create_bullet(...)      \u2192   BulletPool.spawn()\nself.fire_circle(...)  \u2192   ctx.create_bullet() \u00d7 N     \u2192   BulletPool.spawn() \u00d7 N\nself.play_se(...)      \u2192   ctx.audio_manager.play_se() \u2192   AudioManager\nself.clear_bullets()   \u2192   ctx.clear_bullets()         \u2192   BulletPool.clear()\nself.boss.move_to(...) \u2192   BossProxy.move_to()         \u2192   \u534f\u7a0b\u9a71\u52a8\u7684\u5e73\u6ed1\u79fb\u52a8\n</code></pre> <p>\u8fd9\u6837\u505a\u7684\u597d\u5904\uff1a</p> <ul> <li>\u5185\u5bb9\u811a\u672c\u4e0d\u4f9d\u8d56\u5f15\u64ce\u5b9e\u73b0\u7ec6\u8282</li> <li>\u5f15\u64ce\u5185\u90e8\u91cd\u6784\u4e0d\u5f71\u54cd\u5df2\u6709\u5173\u5361</li> <li>\u53ef\u4ee5\u5bf9 Context \u505a mock \u8fdb\u884c\u5355\u5143\u6d4b\u8bd5</li> </ul>"},{"location":"architecture/#_8","title":"\u6e32\u67d3\u7ba1\u7ebf","text":"<p>\u6e32\u67d3\u6309\u5c42\u7ea7\u4ece\u540e\u5230\u524d\uff1a</p> <pre><code>\u80cc\u666f\u5c42 \u2192 \u654c\u4eba\u5c42 \u2192 \u654c\u5f39\u5c42 \u2192 \u6fc0\u5149\u5c42 \u2192 \u81ea\u673a\u5f39\u5c42 \u2192 \u81ea\u673a\u5c42 \u2192 \u9053\u5177\u5c42 \u2192 UI \u5c42 \u2192 \u5bf9\u8bdd\u5c42\n</code></pre> <p>\u5b50\u5f39\u6e32\u67d3\u4f7f\u7528 OpenGL \u5b9e\u4f8b\u5316\u7ed8\u5236\uff08instanced rendering\uff09\uff0c\u4e00\u6b21 draw call \u7ed8\u5236\u6240\u6709\u540c\u7c7b\u578b\u5b50\u5f39\u3002</p>"},{"location":"architecture/#_9","title":"\u97f3\u9891\u7cfb\u7edf","text":"<p>\u53cc\u5c42\u67e5\u627e\u673a\u5236\uff1a</p> <pre><code>play_se(\"shoot\")\n    \u2502\n    \u251c\u2500\u2500 \u5148\u627e StageAudioBank\uff08\u5173\u5361\u79c1\u6709\uff0c\u53ef\u9009\uff09\n    \u2502     \u2514\u2500\u2500 game_content/stages/stageN/audio/se/\n    \u2502\n    \u2514\u2500\u2500 \u518d\u627e GameAudioBank\uff08\u5168\u5c40\uff09\n          \u2514\u2500\u2500 assets/audio/se/\n</code></pre> <p>\u5173\u5361\u79c1\u6709\u97f3\u6548\u53ef\u4ee5\u8986\u76d6\u5168\u5c40\u540c\u540d\u97f3\u6548\u3002BGM \u540c\u7406\u3002</p>"},{"location":"architecture/#_10","title":"\u6fc0\u5149\u7cfb\u7edf","text":"<p>\u4e24\u79cd\u6fc0\u5149\u7c7b\u578b\uff1a</p> \u7c7b\u578b \u8bf4\u660e \u76f4\u7ebf\u6fc0\u5149 <code>Laser</code> \u4e09\u6bb5\u5f0f\uff08\u5934/\u8eab/\u5c3e\uff09\uff0c\u652f\u6301\u5c55\u5f00\u2192\u6301\u7eed\u2192\u6536\u7f29\u52a8\u753b \u66f2\u7ebf\u6fc0\u5149 <code>BentLaser</code> \u6cbf\u8def\u5f84\u5f2f\u66f2\uff0c\u8bb0\u5f55\u5386\u53f2\u4f4d\u7f6e\u5f62\u6210\u8f68\u8ff9 <p>\u901a\u8fc7 <code>LaserPool</code> \u7edf\u4e00\u7ba1\u7406\uff0c\u6e32\u67d3\u7531 <code>LaserRenderer</code> \u5904\u7406\uff0c\u652f\u6301 16 \u79cd\u9884\u8bbe\u989c\u8272\u3002</p>"},{"location":"getting-started/","title":"\u5feb\u901f\u5f00\u59cb","text":""},{"location":"getting-started/#_2","title":"\u73af\u5883\u8981\u6c42","text":"<ul> <li>Python 3.10+</li> <li>\u652f\u6301 OpenGL 3.3+ \u7684\u663e\u5361</li> </ul>"},{"location":"getting-started/#_3","title":"\u5b89\u88c5\u4f9d\u8d56","text":"<pre><code>pip install pygame-ce moderngl numpy numba pillow\n</code></pre> <p>\u7f16\u8f91\u5668\u5de5\u5177\u989d\u5916\u9700\u8981\uff1a</p> <pre><code>pip install PyQt5\n</code></pre>"},{"location":"getting-started/#_4","title":"\u8fd0\u884c\u6e38\u620f","text":"<pre><code>python main.py\n</code></pre>"},{"location":"getting-started/#_5","title":"\u9879\u76ee\u7ed3\u6784","text":"<pre><code>pystg/\n\u251c\u2500\u2500 main.py                  # \u6e38\u620f\u5165\u53e3\n\u2502\n\u251c\u2500\u2500 src/                     # \u5f15\u64ce\u4ee3\u7801\uff08\u4e0d\u8981\u52a8\uff0c\u9664\u975e\u4f60\u5728\u6539\u5f15\u64ce\uff09\n\u2502   \u251c\u2500\u2500 core/                # \u914d\u7f6e\u3001\u78b0\u649e\u68c0\u6d4b\u3001\u63a5\u53e3\u5b9a\u4e49\n\u2502   \u251c\u2500\u2500 game/                # \u6e38\u620f\u903b\u8f91\n\u2502   \u2502   \u251c\u2500\u2500 bullet/          # \u5b50\u5f39\u6c60\uff08Numba \u52a0\u901f\uff09\n\u2502   \u2502   \u251c\u2500\u2500 player/          # \u73a9\u5bb6\u7cfb\u7edf\n\u2502   \u2502   \u251c\u2500\u2500 stage/           # \u5173\u5361\u7cfb\u7edf\u6838\u5fc3\uff08\u57fa\u7c7b\u90fd\u5728\u8fd9\u91cc\uff09\n\u2502   \u2502   \u251c\u2500\u2500 boss/            # Boss \u7ba1\u7406\n\u2502   \u2502   \u251c\u2500\u2500 laser.py         # \u6fc0\u5149\u7cfb\u7edf\n\u2502   \u2502   \u251c\u2500\u2500 item.py          # \u9053\u5177\u7cfb\u7edf\n\u2502   \u2502   \u2514\u2500\u2500 audio.py         # \u97f3\u9891\u7cfb\u7edf\n\u2502   \u251c\u2500\u2500 render/              # \u6e32\u67d3\u7ba1\u7ebf\n\u2502   \u251c\u2500\u2500 resource/            # \u7eb9\u7406\u548c\u7cbe\u7075\u7ba1\u7406\n\u2502   \u2514\u2500\u2500 ui/                  # HUD\u3001\u83dc\u5355\u3001\u5bf9\u8bdd\u6846\u6e32\u67d3\n\u2502\n\u251c\u2500\u2500 game_content/            # \u5173\u5361\u5185\u5bb9\uff08\u5199\u5f39\u5e55\u5728\u8fd9\u91cc\uff09\n\u2502   \u2514\u2500\u2500 stages/\n\u2502       \u251c\u2500\u2500 stage1/          # \u7b2c 1 \u9762\uff08\u5b8c\u6574\u793a\u4f8b\uff09\n\u2502       \u251c\u2500\u2500 stage2/          # \u7b2c 2 \u9762\uff08\u9aa8\u67b6\uff09\n\u2502       \u2514\u2500\u2500 stage3/          # \u7b2c 3 \u9762\uff08\u9aa8\u67b6\uff09\n\u2502\n\u251c\u2500\u2500 assets/                  # \u6e38\u620f\u8d44\u6e90\n\u2502   \u251c\u2500\u2500 images/              # \u7eb9\u7406\u56fe\u96c6\uff08\u5b50\u5f39\u3001\u6fc0\u5149\u3001\u654c\u4eba\u3001\u9053\u5177\u7b49\uff09\n\u2502   \u251c\u2500\u2500 audio/               # \u5168\u5c40\u97f3\u6548\u548c BGM\n\u2502   \u251c\u2500\u2500 fonts/               # \u5b57\u4f53\n\u2502   \u251c\u2500\u2500 players/             # \u81ea\u673a\u914d\u7f6e\n\u2502   \u251c\u2500\u2500 configs/             # \u654c\u4eba\u9884\u8bbe\u7b49\u914d\u7f6e\n\u2502   \u2514\u2500\u2500 bullet_aliases.json  # \u5f39\u5e55\u7c7b\u578b\u2192\u7cbe\u7075\u6620\u5c04\u8868\n\u2502\n\u251c\u2500\u2500 tools/                   # PyQt5 \u7f16\u8f91\u5668\u5de5\u5177\n\u2502   \u251c\u2500\u2500 editor_launcher.py   # \u7edf\u4e00\u542f\u52a8\u5668\n\u2502   \u251c\u2500\u2500 bullet/              # \u5f39\u5e55\u522b\u540d\u7ba1\u7406\u5668\n\u2502   \u251c\u2500\u2500 asset/               # \u7eb9\u7406\u8d44\u4ea7\u7f16\u8f91\u5668\n\u2502   \u251c\u2500\u2500 player/              # \u81ea\u673a\u7f16\u8f91\u5668\n\u2502   \u2514\u2500\u2500 ...\n\u2502\n\u2514\u2500\u2500 levels/                  # \u5173\u5361\u52a0\u8f7d\u811a\u672c\n</code></pre>"},{"location":"getting-started/#_6","title":"\u6838\u5fc3\u6982\u5ff5","text":"<p>pystg \u628a\u5f15\u64ce\u548c\u5185\u5bb9\u5f7b\u5e95\u5206\u5f00\uff1a</p> <ul> <li><code>src/</code> \u662f\u5f15\u64ce\uff0c\u63d0\u4f9b\u5b50\u5f39\u6c60\u3001\u6e32\u67d3\u3001\u78b0\u649e\u7b49\u5e95\u5c42\u80fd\u529b</li> <li><code>game_content/</code> \u662f\u5185\u5bb9\uff0c\u53ea\u63cf\u8ff0\u300c\u53d1\u751f\u4ec0\u4e48\u300d\u2014\u2014\u5f39\u5e55\u600e\u4e48\u98de\u3001\u654c\u4eba\u600e\u4e48\u52a8\u3001Boss \u51fa\u4ec0\u4e48\u62db</li> </ul> <p>\u4f60\u5199\u5f39\u5e55\u811a\u672c\u65f6\uff0c\u53ea\u9700\u8981\u548c\u51e0\u4e2a\u57fa\u7c7b\u6253\u4ea4\u9053\uff1a</p> <pre><code>from src.game.stage.spellcard import SpellCard, NonSpell   # \u7b26\u5361 / \u975e\u7b26\nfrom src.game.stage.wave_base import Wave                   # \u9053\u4e2d\u6ce2\u6b21\nfrom src.game.stage.enemy_script import EnemyScript         # \u654c\u4eba\u811a\u672c\n</code></pre> <p>\u6240\u6709\u5f39\u5e55\u903b\u8f91\u901a\u8fc7 Python \u534f\u7a0b\uff08<code>async/await</code>\uff09\u7f16\u5199\uff0c<code>await self.wait(N)</code> \u6682\u505c N \u5e27\uff1a</p> <pre><code>class MySpell(SpellCard):\n    name = \"\u706b\u7b26\u300cExample\u300d\"\n    hp = 1000\n    time_limit = 45\n\n    async def run(self):\n        angle = 0\n        while True:\n            self.fire_circle(count=12, speed=2.0, start_angle=angle, color=\"red\")\n            angle += 10\n            await self.wait(15)\n</code></pre> <p>\u8be6\u7ec6\u7684\u811a\u672c\u7f16\u5199\u65b9\u6cd5\u89c1 \u5f39\u5e55\u811a\u672c\u5f00\u53d1\u6307\u5357\u3002</p>"},{"location":"getting-started/#_7","title":"\u4e00\u4e2a\u5173\u5361\u957f\u4ec0\u4e48\u6837","text":"<p>\u6bcf\u4e2a\u5173\u5361\u662f <code>game_content/stages/</code> \u4e0b\u7684\u4e00\u4e2a\u6587\u4ef6\u5939\uff1a</p> <pre><code>stage1/\n\u251c\u2500\u2500 __init__.py\n\u251c\u2500\u2500 stage_script.py          # \u5173\u5361\u4e3b\u811a\u672c\uff08\u5b9a\u4e49\u6d41\u7a0b\uff09\n\u251c\u2500\u2500 waves/                   # \u9053\u4e2d\u6ce2\u6b21\n\u2502   \u251c\u2500\u2500 opening_wave.py\n\u2502   \u2514\u2500\u2500 fairy_wave.py\n\u251c\u2500\u2500 spellcards/              # Boss \u7b26\u5361\n\u2502   \u251c\u2500\u2500 nonspell_1.py\n\u2502   \u251c\u2500\u2500 spell_1.py\n\u2502   \u2514\u2500\u2500 spell_2.py\n\u251c\u2500\u2500 enemies/                 # \u654c\u4eba\u5b9a\u4e49\n\u2502   \u2514\u2500\u2500 fairy.py\n\u251c\u2500\u2500 dialogue/                # \u5bf9\u8bdd\u811a\u672c\n\u2502   \u2514\u2500\u2500 boss_dialogue.py\n\u2514\u2500\u2500 audio/                   # \u5173\u5361\u79c1\u6709\u97f3\u9891\uff08\u53ef\u9009\uff09\n    \u251c\u2500\u2500 se/\n    \u2514\u2500\u2500 music/\n</code></pre> <p><code>stage_script.py</code> \u63a7\u5236\u6574\u4e2a\u5173\u5361\u7684\u6d41\u7a0b\uff1a</p> <pre><code>class Stage1(StageScript):\n    id = \"stage1\"\n    name = \"Stage 1\"\n    bgm = \"00.wav\"\n    boss_bgm = \"01.wav\"\n\n    async def run(self):\n        await self.run_wave(OpeningWave)     # \u9053\u4e2d\u6ce2\u6b21\n        await self.run_wave(FairyWave)\n\n        await self.play_dialogue([           # Boss \u524d\u5bf9\u8bdd\n            (\"Hinanawi_Tenshi\", \"left\", \"\u51c6\u5907\u597d\u4e86\u5417\uff1f\"),\n            (\"Reiuji_Utsuho\", \"right\", \"\u6765\u5427\uff01\"),\n        ])\n\n        await self.run_boss(self.boss)       # Boss \u6218\n</code></pre>"},{"location":"getting-started/#_8","title":"\u4e0b\u4e00\u6b65","text":"<ul> <li>\u5199\u5f39\u5e55 \u2192 \u5f39\u5e55\u811a\u672c\u5f00\u53d1\u6307\u5357</li> <li>\u7528\u9884\u8bbe\u5feb\u901f\u51fa\u6742\u5175 \u2192 \u654c\u4eba\u9884\u8bbe\u7cfb\u7edf</li> <li>\u7528\u7f16\u8f91\u5668\u7ba1\u7406\u8d44\u6e90 \u2192 \u7f16\u8f91\u5668\u5de5\u5177</li> <li>\u4e86\u89e3\u5f15\u64ce\u5185\u90e8 \u2192 \u67b6\u6784\u6982\u89c8</li> </ul>"}]}